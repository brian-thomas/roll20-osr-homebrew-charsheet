<input name="attr_version" type="hidden" value="1.0"/>
<input class="monster_confirm_flag" name="attr_monster_confirm_flag" type="hidden"/>
<input class="mancer_confirm_flag" name="attr_mancer_confirm_flag" type="hidden"/>
<input class="licensedsheet" name="attr_licensedsheet" type="hidden"/>
<div class="licensecontainer compendium-drop-target monsters" data-licensedsheet="attr_licensedsheet">

  <span class="small-font">NPC</span>
  <input type="checkbox" class="sheet-is_npc" name="attr_npc" value="1" checked="True"/>
  <div class="sheet-section-npc">
     <!-- COMPENDIUM DROP CATCHERS -->
    <input type="hidden" name="attr_drop_category" accept="Category">
    <input type="hidden" name="attr_drop_name" accept="Name">
    <input type="hidden" name="attr_drop_weight" accept="Weight">
    <input type="hidden" name="attr_drop_properties" accept="Properties">
    <input type="hidden" name="attr_drop_modifiers" accept="Modifiers">
    <input type="hidden" name="attr_drop_content" accept="Content">
    <input type="hidden" name="attr_drop_itemtype" accept="Item Type">
    <input type="hidden" name="attr_drop_damage" accept="Damage">
    <input type="hidden" name="attr_drop_damagetype" accept="Damage Type">
    <input type="hidden" name="attr_drop_range" accept="Range">
    <input type="hidden" name="attr_drop_ac" accept="AC">

    <input type="hidden" name="attr_drop_speed" accept="Speed">
    <input type="hidden" name="attr_drop_str" accept="STR">
    <input type="hidden" name="attr_drop_dex" accept="DEX">
    <input type="hidden" name="attr_drop_con" accept="CON">
    <input type="hidden" name="attr_drop_int" accept="INT">
    <input type="hidden" name="attr_drop_wis" accept="WIS">
    <input type="hidden" name="attr_drop_cha" accept="CHA">
    <input type="hidden" name="attr_drop_vulnerabilities" accept="Vulnerabilities">
    <input type="hidden" name="attr_drop_resistances" accept="Resistances">
    <input type="hidden" name="attr_drop_immunities" accept="Immunities">
    <input type="hidden" name="attr_drop_condition_immunities" accept="Condition Immunities">
    <input type="hidden" name="attr_drop_languages" accept="Languages">
    <input type="hidden" name="attr_drop_challenge_rating" accept="Challenge Rating">

    <input type="hidden" name="attr_drop_size" accept="Size">
    <input type="hidden" name="attr_drop_type" accept="Type">
    <input type="hidden" name="attr_drop_alignment" accept="Alignment">
    <input type="hidden" name="attr_drop_hp" accept="HP">
    <input type="hidden" name="attr_drop_saving_throws" accept="Saving Throws">
    <input type="hidden" name="attr_drop_senses" accept="Senses">
    <input type="hidden" name="attr_drop_passive_perception" accept="Passive Perception">
    <input type="hidden" name="attr_drop_skills" accept="Skills">
    <input type="hidden" name="attr_drop_token_size" accept="Token Size">
    <!-- END COMPENDIUM DROP CATCHERS -->

    <div class="block padding npc">
      <input type="text" class="align-left npc-name" name="attr_character_name"/>
      <div class="sheet-block">
        <input type="text" name="attr_npc_type" class="sheet-npc-text sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Type"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Movement: </span>
        <input type="text" name="attr_npc_speed" class="sheet-npc-text sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Speed"/>
      </div>
      <div class="sheet-block">
        <input type="text" name="attr_npc_senses" class="sheet-npc-text sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Senses"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Languages: </span>
        <input type="text" name="attr_known_lang" class="sheet-npc-text sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Languages"/>
      </div>

      <div class="sheet-flex padding thick-border">
        <div class="block">
          <div class="thin-border padding limit-to-half-width">
            <h4 class="bottom-line">Combat</h4>
            <div class="flex-between">
              <div class="block">
                <div class="sheet-flex-inline">
                  <select class="sheet-info-name-med-sm" name="attr_level">
                    <option selected="selected" value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                  </select>
                </div>
                <div class="block padding center">
                  <span class="ability-check-label">Hit</span>
                  <span class="ability-check-label">Dice</span>
                </div>
              </div>
              <div class="block padding center">
                <input class="ability-check-value" name="attr_hp" type="number" value="0"/>
                <span class="ability-check-label">HP</span>
              </div>
              <div class="block padding center">
                <input class="ability-check-value" name="attr_npc_ac" type="number" value="10"/>
                <span class="ability-check-label">AC</span>
              </div>
              <div class="block padding center">
                <div class="sheet-block sheet-padding sheet-center">
                  <input name="attr_init_extra" type="number" hidden="true" value="0"/>
                  <input class="sheet-npc-ability-value-wide" name="attr_initiative" type="number" value="0"/>
                  <button type="roll" class="sheet-npc-ability-button" name="roll_initiative"
                          value="&{template:roll_check} {{title=Initiative}} {{subheader=@{character_name}}} {{initiative=1}} {{rollname=Initiative}} {{roll=[[ 1d20 + @{initiative} + @{init_extra} [Initiative Mod] &{tracker} ]]}}">
                          Init.
                  </button>
                </div>
              </div>
            </div>
          </div>
          <br/>

          <div class="block thin-border padding limit-to-half-width">
            <h4 class="bottom-line">Attributes</h4>
            <div class="flex">
              <div class="block center">
                <span class="bold-font">STR</span>
                <input class="npc-ability-value" name="attr_strength" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_fortitude"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Fortitude Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{fortitude} + @{fort_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{fortitude}]] + [[@{fort_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Fort.</span>
                </button>
                <input class="npc-ability-check" name="attr_fortitude" type="number" value="0"/>
              </div>

              <div class="block center">
                <span class="bold-font">DEX</span>
                <input class="npc-ability-value" name="attr_dexterity" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_dodge"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dodge Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{dodge} + @{dodge_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dodge}]] + [[@{dodge_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Dodge</span>
                </button>
                <input class="npc-ability-check" name="attr_dodge" type="number" value="0"/>
              </div>

              <div class="block center">
                <span class="bold-font">CON</span>
                <input class="npc-ability-value" name="attr_constitution" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_health"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Health Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{health} +@{health_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{health}]] + [[@{health_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Health</span>
                </button>
                <input class="npc-ability-check" name="attr_health" type="number" value="0"/>
              </div>

              <div class="block center">
                <span class="bold-font">INT</span>
                <input class="npc-ability-value" name="attr_intelligence" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_perception"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Perception Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{perception} + @{per_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{perception}]] + [[@{per_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Per.</span>
                </button>
                <input class="npc-ability-check" name="attr_perception" type="number" value="0"/>
              </div>

              <div class="block center">
                <span class="bold-font">WIS</span>
                <input class="npc-ability-value" name="attr_wisdom" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_willpower"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Willpower Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{willpower} +@{will_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{willpower}]] +[[@{will_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Will</span>
                </button>
                <input class="npc-ability-check" name="attr_willpower" type="number" value="0"/>
              </div>

              <div class="block center">
                <span class="bold-font">CHA</span>
                <input class="npc-ability-value" name="attr_charisma" type="number" value="10"/>
                <button class="blank-roll-button narrow-button" type="roll" name="roll_ego"
                        value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Ego Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{ego} + @{ego_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{ego}]] +[[@{ego_bonus}]] ]]}}">
                        <span class="bold-font npc-text">Ego</span>
                </button>
                <input class="npc-ability-check" name="attr_ego" type="number" value="0"/>
                <input name="attr_ego_bonus" type="number" value="0" hidden="True"/>
              </div>
            </div>
          </div> <!-- end attribs and saves -->
          <br/>

          <div class="block thin-border padding limit-to-half-width">
             <h4 class="bottom-line">Skills</h4>
             <div class="npc-traitcontainer">
               <fieldset class="repeating_skills">
                 <div class="sheet-block sheet-thin-border sheet-side-padding">
                   <div class="sheet-align-right">
                     <input type="text" name="attr_skillname" class="sheet-bottom-line sheet-skillname"/>
                     <input type="number" name="attr_skillvalue" class="sheet-bold-font" value="1"/>
                     <input type="number" name="attr_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                     <button class="sheet-skill-button" type="roll" name="roll_skill"
                             value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{skillname} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{skillvalue} +@{skill_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{skillvalue}]] +[[@{skill_bonus}]] ]]}}"></button>
                   </div>
                 </div>
              </fieldset>
             </div>
          </div>
          <br/>

          <div class="block thin-border padding limit-to-half-width">
            <h4 class="bottom-line">Traits</h4>
             <div class="npc-traitcontainer">
               <fieldset class="repeating_npctrait">
                 <div class="sheet-block sheet-side-padding bottom-line align-left">
                   <img class="small-image" src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                   <input type="checkbox" class="sheet-is_edit_trait" value="1"/>
                   <div class="section-npc-edit-trait">
                     <div class="flex fill-width">
                       <span class="bold-font">Name:</span>
                       <input type="text" name="attr_trait_name" class="align-left"/>
                     </div>
                     <div class="block">
                       <span class="bold-font">Desc:</span>
                       <!--input type="textarea" name="attr_trait_desc" class="npc-trait-textarea"/-->
                       <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_trait_desc" data-i18n-placeholder="description"></textarea>
                     </div>
                   </div>
                   <div class="section-npc-show-trait">
                     <div class="flex fill-width">
                       <label class="npc-trait-name info5"><span name="attr_trait_name">Trait Name</span></label>
                     </div>
                     <label class="npc-text-sm info5"><span name="attr_trait_desc">Description Here</span></label>
                   </div>
                 </div>
               </fieldset>
             </div>
          </div>
        </div> <!-- LHS -->

        <div class="block">
        <div class="block thin-border limit-to-half-width">
          <h4 class="bottom-line">Actions</h4>
          <div class="npc-traitcontainer">
            <fieldset class="repeating_npcactions">
              <div class="sheet-block sheet-side-padding bottom-line align-left">

                <button type="action" name="act_edit_npc_action" class="npc-edit-button align-right">
                  <img src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                </button>

                <input type="checkbox" class="sheet-show-npc-action-editor" name="attr_show_action_editor" value="1" checked="True"/>
                <div class="sheet-section-npc-action-editor sheet-block">
                  <!-- TODO: implement checkbox toggle in sheethelper attack /non attack here, which then reveals, or not, the attack options -->
                  <div class="sheet-flex">
                    <input type="text" class="npc-action-text" name="attr_action_name" data-i18n-placeholder="name"/>
                  </div>
                  <div class="sheet-flex">
                    <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_action_desc" data-i18n-placeholder="description"></textarea>
                  </div>
                  <span>is an attack action?</span>
                  <input type="checkbox" class="sheet-is-npc-attack-action" name="attr_action_is_an_attack" value="1" checked="True"/>
                  <div class="sheet-section-npc-action-attack-options">
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Type</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_type" data-i18n-placeholder="Attack Type (Weapon|Spell)"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Target Area</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_target" data-i18n-placeholder="Attack Targets, ex. 'One target'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Range</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_range" data-i18n-placeholder="Attack Range, ex '5 ft. reach'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack To Hit</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_tohit" data-i18n-placeholder="Attack To Hit Bonus"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damage" data-i18n-placeholder="Attack Damage Dieroll, ex '1d6+1'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage Type</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damagetype" data-i18n-placeholder="Attack Damage Type, ex 'slashing'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage2</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damage2" data-i18n-placeholder="Attack Damage2 Dieroll, ex '1d6+1'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage Type2</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damagetype2" data-i18n-placeholder="Attack Damage2 Type, ex 'slashing'"/>
                    </div>
                    <!-- TODO: upon edit update these fields -->
                    <input type="text" name="attr_action_attack_desc1" hidden="true"/>
                    <input type="text" name="attr_action_attack_desc2" hidden="true"/>
                  </div>
                </div>

                <input type="checkbox" class="sheet-npc-show-attack" name="attr_action_show_attack" value="1" hidden="True" checked="True"/>
                <div class="sheet-section-npc-show-attack flex">
                  <button type="roll" name="roll_npc_action" class="npc-trait-name blank-roll-button info5"
                     value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{action_name} Attack}} {{subheader=@{character_name}}} {{attack=0}} {{attack=[[ 1d20 + [[@{action_attack_tohit}]] ]]}} {{critical=[[19 + @{action_attack_tohit}]]}} {{fumble=[[2+@{action_attack_tohit}]] }} {{damage=[[@{action_attack_damage}]]}} {{damagetype=@{action_attack_damagetype}}} {{critdamage=[[@{action_attack_damage} + @{action_attack_damage} ]]}} }}">
                     <span name="attr_action_name">Action Name</span>
                  </button>
                  <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc1"/></label>
                  <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc2"/></label>
                </div>
                <div class="section-npc-show-non-attack flex">
                  <label class="info5 npc-trait-name info5"><span name="attr_action_name">Action Name</span></label>
                </div>
                <label class="info5 npc-text"><span name="attr_action_desc" class="npc-text-sm">Description Here</span></label>
              </div>
            </fieldset>
          </div>
        </div>
        <br/>

        <div class="block thin-border padding limit-to-half-width">
          <h4 class="bottom-line">Legendary Actions</h4>
          <div class="npc-traitcontainer">
            <fieldset class="repeating_npcactions-l">
              <div class="sheet-block sheet-side-padding bottom-line align-left">

                <button type="action" name="act_edit_npc_action" class="npc-edit-button align-right">
                  <img src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                </button>

                <input type="checkbox" class="sheet-show-npc-action-editor" name="attr_show_action_editor" value="1" checked="True"/>
                <div class="sheet-section-npc-action-editor sheet-block">
                  <!-- TODO: implement checkbox toggle in sheethelper attack /non attack here, which then reveals, or not, the attack options -->
                  <div class="sheet-flex">
                    <input type="text" class="npc-action-text" name="attr_action_name" data-i18n-placeholder="name"/>
                  </div>
                  <div class="sheet-flex">
                    <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_action_desc" data-i18n-placeholder="description"></textarea>
                  </div>
                  <span>is an attack action?</span>
                  <input type="checkbox" class="sheet-is-npc-attack-action" name="attr_action_is_an_attack" value="1" checked="True"/>
                  <div class="sheet-section-npc-action-attack-options">
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Type</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_type" data-i18n-placeholder="Attack Type (Weapon|Spell)"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Target Area</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_target" data-i18n-placeholder="Attack Targets, ex. 'One target'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Range</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_range" data-i18n-placeholder="Attack Range, ex '5 ft. reach'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack To Hit</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_tohit" data-i18n-placeholder="Attack To Hit Bonus"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damage" data-i18n-placeholder="Attack Damage Dieroll, ex '1d6+1'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage Type</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damagetype" data-i18n-placeholder="Attack Damage Type, ex 'slashing'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage2</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damage2" data-i18n-placeholder="Attack Damage2 Dieroll, ex '1d6+1'"/>
                    </div>
                    <div class="flex">
                      <span class="bold-font npc-action-text">Attack Damage Type2</span>
                      <input type="text" class="npc-action-text" name="attr_action_attack_damagetype2" data-i18n-placeholder="Attack Damage2 Type, ex 'slashing'"/>
                    </div>
                    <!-- TODO: upon edit update these fields -->
                    <input type="text" name="attr_action_attack_desc1" hidden="true"/>
                    <input type="text" name="attr_action_attack_desc2" hidden="true"/>
                  </div>
                </div>

                <input type="checkbox" class="sheet-npc-show-attack" name="attr_action_show_attack" value="1" hidden="True" checked="True"/>
                <div class="sheet-section-npc-show-attack flex">
                  <button type="roll" name="roll_npc_action" class="npc-trait-name blank-roll-button info5"
                     value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{action_name} Attack}} {{subheader=@{character_name}}} {{attack=0}} {{attack=[[ 1d20 + [[@{action_attack_tohit}]] ]]}} {{critical=[[19 + @{action_attack_tohit}]]}} {{fumble=[[2+@{action_attack_tohit}]] }} {{damage=[[@{action_attack_damage}]]}} {{damagetype=@{action_attack_damagetype}}} {{critdamage=[[@{action_attack_damage} + @{action_attack_damage} ]]}} }}">
                     <span name="attr_action_name">Legendary Action Name</span>
                  </button>
                  <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc1"/></label>
                  <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc2"/></label>
                </div>
                <div class="section-npc-show-non-attack flex">
                  <label class="info5 npc-trait-name info5"><span name="attr_action_name">Legendary Action Name</span></label>
                </div>
                <label class="info5 npc-text"><span name="attr_action_desc" class="npc-text-sm">Description Here</span></label>
              </div>
            </fieldset>
          </div>
        </div>
        <br/>

        <div class="block thin-border padding limit-to-half-width">
           <h4 class="bottom-line">Reactions</h4>
           <div class="npc-traitcontainer">
             <fieldset class="repeating_npcreaction">
               <div class="sheet-block sheet-side-padding bottom-line align-left">
                 <input type="checkbox" class="sheet-is_edit_trait" value="1"/>
                 <img class="small-image" src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                 <div class="section-npc-edit-trait">
                   <div class="flex fill-width">
                     <span class="bold-font">Name:</span>
                     <input type="text" name="attr_react_name" class="align-left" data-i18n-placeholder="reaction name"/>
                   </div>
                   <div class="block">
                     <span class="bold-font">Desc:</span>
                     <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_react_desc" data-i18n-placeholder="description"></textarea>
                   </div>
                 </div>
                 <div class="section-npc-show-trait">
                   <div class="flex fill-width">
                     <label class="npc-trait-name info5"><span name="attr_react_name">Reaction Name</span></label>
                   </div>
                   <label class="npc-text-sm info5"><span name="attr_react_desc"/>Description Here</label>
                 </div>
               </div>
             </fieldset>
           </div>
        </div>


      </div> <!-- action/reaction block -->

     </div> <!-- thick border -->
   </div> <!-- block -->

   <div class="block thick-border padding">
      <h3>Spellcasting</h3>
      <div class="sheet-flex-between">
        <div class="sheet-flex">
          <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
            <span>Spellcasting Type</span>
          </div>
          <div class="sheet-ability-column-modifier sheet-flex-between">
            <select class="attack-param-long" name="attr_spellcasting_type">
              <option selected="selected" value="none">--</option>
              <option value="Arcane">Arcane</option>
              <option value="Divine">Divine</option>
            </select>
          </div>
        </div>
        <div class="sheet-flex">
          <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
            <span>Spellcasting Modifier</span>
          </div>
          <div class="sheet-ability-column-modifier sheet-flex-between">
            <div class="sheet-thin-border sheet-flex sheet-side-padding">
              <input class="ability-value" name="attr_spellcasting_mod" type="number" value="0"/>
            </div>
          </div>
        </div>
        <div class="sheet-flex">
          <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
            <span>Spell Save DC</span>
          </div>
          <div class="sheet-ability-column-modifier sheet-flex-between">
            <div class="sheet-thin-border sheet-flex sheet-side-padding">
              <input class="ability-value" name="attr_spellcasting_dc" type="number" value="0"/>
            </div>
          </div>
        </div>
      </div>

      <h4 class="bottom-line">Spells</h4>
      <div class="npc-traitcontainer sheet-spells">
       <button type="action" name="act_spellrest">Regain All Spellslots</button>
        <div class="sheet-spells-per-level sheet-flex">
          <div class="sheet-flex">
            <span class="sheet-italic-font sheet-big-font heet-side-padding">Slots / Level</span>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">1st: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl1_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box sheet-inactive-color" name="attr_lvl1_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl1_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">2nd: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl2_slots_expended" value="0"/>
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl2_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl2_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">3rd: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl3_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl3_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl3_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">4th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl4_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl4_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl4_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">5th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl5_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl5_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl5_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">6th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl6_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl6_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl6_slots_total"/>
          </div>
              <div class="sheet-flex">
              <span class="sheet-med-font">7th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl7_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl7_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl7_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">8th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl8_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl8_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl8_slots_total"/>
          </div>
          <div class="sheet-flex">
              <span class="sheet-med-font">9th: </span>
              <input type="number" class="sheet-spellslot-box" name="attr_lvl9_slots_expended" value="0" />
              /
              <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl9_slots_total" value="0" hidden="true"/>
              <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl9_slots_total"/>
          </div>
        </div>

        <div class="sheet-spell-filters sheet-flex center">
         <span class="sheet-bold-font">Filter:</span>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="all" checked/>
             <span data-i18n="all"></span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="1"/>
             <span>1</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="2"/>
             <span>2</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="3"/>
             <span>3</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="4"/>
             <span>4</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="5"/>
             <span>5</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="6"/>
             <span>6</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="7"/>
             <span>7</span>
         </label>
         <label class="sheet-filter-button">
             <input type="radio" name="attr_spells_filter" value="8"/>
             <span>8</span>
         </label>
         <label class="sheet-filter-button">
           <input type="radio" name="attr_spells_filter" value="9"/>
           <span>9</span>
         </label>
       </div>

       <fieldset class="repeating_spells">
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="1" checked="True"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="2"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="3"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="4"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="5"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="6"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="7"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="8"/>
          <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="9"/>
          <div class="sheet-spellcontainer sheet-side-padding">
            <input type="text" name="attr_spellname" class="sheet-bottom-line sheet-spell-name" data-i18n-placeholder="name"/>
            <span class="sheet-left-pad"> Level:</span>
            <select class="sheet-info-name-sm sheet-align-right" name="attr_spelllevel">
               <option value="0">0</option>
               <option selected="selected" value="1">1</option>
               <option value="2">2</option>
               <option value="3">3</option>
               <option value="4">4</option>
               <option value="5">5</option>
               <option value="6">6</option>
               <option value="7">7</option>
               <option value="8">8</option>
               <option value="9">9</option>
            </select>
            <span class="sheet-left-pad">Dice:</span>
            <input type="text" class="sheet-info1 sheet-align-right sheet-spell-dice" name="attr_spell_dice" value="">
            <div class="sheet-flex save-col center centered-label">
                <button class="sheet-cast-button sheet-orange-border" type="roll" name="roll_cast_spell"
                        value="@{wtype}&{template:spell} {{name=@{character_name}}} {{innate=}} {{memorized=1}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{level= @{spelllevel}}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{description=@{spelldescription}}}"></button>
                <span class="small-font centered-label">Cast</span>
            </div>
            <textarea spellcheck="false" name="attr_spelldescription" class="sheet-spell-description" data-i18n-placeholder="description"></textarea>
          </div>
        </fieldset>
      </div>
   </div>
   </br>

   <div class="thin-border block padding">
     <h3>Notes</h3>
     <textarea class="sheet-npc-notes" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
   </div>

  </div> <!-- NPC End -->

  <input type="checkbox" class="sheet-pc_header_enabled" name="attr_pc_header_enabled" value="1" hidden="True"/>
  <div class="sheet-section-pc">

    <!-- Used by OGL Companion API Script -->
    <input type="text" name="attr_wtype" value="" hidden="true"/>
    <input type="text" name="attr_whispertoggle" value="" hidden="true"/>

    <div class="sheet-header-left sheet-thin-border">

      <div class="sheet-inline-flex sheet-bottom-padding">
        <span class="sheet-bold-font med-font centered-label">Name:</span>
        <input type="text" class="sheet-align-left sheet-info-name-long right-pad" name="attr_character_name"/>
        <input type="checkbox" class="sheet-move-rate-stop" name="attr_move_rate_stop" value="0" hidden="true" checked="true"/>
        <input type="checkbox" class="sheet-move-rate-heavy-enc" name="attr_move_rate_heavy_enc" value="0" hidden="true" checked="true"/>
        <input type="checkbox" class="sheet-move-rate-med-enc" name="attr_move_rate_med_enc" value="0" hidden="true" checked="true"/>
        <input type="checkbox" class="sheet-move-rate-light-enc" name="attr_move_rate_light_enc" value="0" hidden="true" checked="true"/>
        <span class="sheet-bold-font centered-label left-pad right-pad move-rate-light-enc-notify move-rate-med-enc-notify move-rate-heavy-enc-notify move-rate-stop-notify">Movement Rate:</span>
        <input type="number" name="attr_movement_rate" class="sheet-inactive-color right-pad" value="40" readonly="true"/>
        <span class="bold-font big-font centred-label left-pad right-pad">/</span>
        <input type="number" name="attr_base_movement_rate" class="sheet-inactive-color" value="40" readonly="true"/>
      </div>

      <div class="sheet-inline-flex">
        <select class="sheet-info-name" name="attr_class">
           <option selected="selected" value="none">--</option>
           <option value="fighter">Fighter</option>
           <option value="cleric">Cleric</option>
           <option value="specialist">Specialist</option>
           <option value="wizard">Wizard</option>
         </select>
         <select class="sheet-info-name-sm" name="attr_level">
           <option selected="selected" value="0">0</option>
           <option value="1">1</option>
           <option value="2">2</option>
           <option value="3">3</option>
           <option value="4">4</option>
           <option value="5">5</option>
           <option value="6">6</option>
           <option value="7">7</option>
           <option value="8">8</option>
           <option value="9">9</option>
           <option value="10">10</option>
           <option value="11">11</option>
           <option value="12">12</option>
           <option value="13">13</option>
           <option value="14">14</option>
           <option value="15">15</option>
           <option value="16">16</option>
           <option value="17">17</option>
           <option value="18">18</option>
           <option value="19">19</option>
           <option value="20">20</option>
         </select>
         <input type="text" class="sheet-align-right sheet-info-name-med" name="attr_xp" value="0"/>
         <input type="checkbox" class="sheet-next-level-up" name="attr_next_level_up" value="0" hidden="true" checked="true"/>
         <input type="text" class="sheet-align-right inactive-color sheet-next-level-notify sheet-info-name-med" name="attr_next_level_xp" value="1" readonly="true"/>
         <input type="checkbox" class="sheet-is_multiclass" name="attr_is_multiclass" value="1"/>
         <span class="ability-check-label">Multiclass</span>
       </div>

       <div class="sheet-inline-flex sheet-bottom-padding">
         <span class="sheet-info-name">Class</span>
         <span class="sheet-info-name-sm">Level</span>
         <span class="sheet-info-name-med">XP</span>
         <span class="sheet-info-name-med">Next Level XP</span>
       </div>

       <input type="checkbox" class="sheet-multiclass_enabled" name="attr_multiclass_enabled" value="1" hidden="true"/>
       <div class="section-multiclass">
         <div class="sheet-inline-flex">
           <select class="sheet-info-name" name="attr_class2">
             <option selected="selected" value="none">--</option>
             <option value="fighter">Fighter</option>
             <option value="cleric">Cleric</option>
             <option value="specialist">Specialist</option>
             <option value="wizard">Wizard</option>
           </select>
           <select class="sheet-info-name" name="attr_level2">
             <option value="0" selected="selected">--</option>
             <option value="1">1</option>
             <option value="2">2</option>
             <option value="3">3</option>
             <option value="4">4</option>
             <option value="5">5</option>
             <option value="6">6</option>
             <option value="7">7</option>
             <option value="8">8</option>
             <option value="9">9</option>
             <option value="10">10</option>
             <option value="11">11</option>
             <option value="12">12</option>
             <option value="13">13</option>
             <option value="14">14</option>
             <option value="15">15</option>
             <option value="16">16</option>
             <option value="17">17</option>
             <option value="18">18</option>
             <option value="19">19</option>
             <option value="20">20</option>
           </select>
         </div>
         <div class="sheet-inline-flex">
           <span class="sheet-info-name">Class</span>
           <span class="sheet-info-name">Level</span>
           <span class="sheet-info-name">&nbsp;</span>
         </div>
       </div>

       <div class="sheet-block">
         <div class="sheet-inline-flex">
           <select class="sheet-info-name" name="attr_alignment">
              <option selectekd="selected" value="Neutral">Neutral</option>
              <option value="Lawful">Lawful</option>
              <option value="Chaotic">Chaotic</option>
           </select>
           <select class="sheet-info-name" name="attr_race">
              <option selected="selected" value="Human">Human</option>
              <option value="Dwarf">Dwarf</option>
              <option value="Elven">Elven</option>
              <option value="Halfling">Halfling</option>
           </select>
           <input type="text" class="sheet-info-name" name="attr_background"/>
         </div>
         <div class="sheet-inline-flex">
           <span class="sheet-info-name">Alignment</span>
           <span class="sheet-info-name">Race</span>
           <span class="sheet-info-name">Background</span>
         </div>
      </div>
    </div>

    <div class="sheet-header-right sheet-noborder">
      <input type="checkbox" class="sheet-pc-logo-enabled" name="attr_pc_logo_enabled" value="1" hidden="true"/>
      <div class="section-pc-logo">
        <img src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/osr_logo.png" class="sheet-logo">
      </div>
    </div>

    <div class="sheet-inline">
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab1" value="1" checked="checked" />
      <span class="sheet-tab sheet-tab1">Core Stats</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab2" value="2" />
      <span class="sheet-tab sheet-tab2">Combat</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab6" value="6" />
      <span class="sheet-tab sheet-tab6">Attacks</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab3" value="3" />
      <span class="sheet-tab sheet-tab3">Magic</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab4" value="4" />
      <span class="sheet-tab sheet-tab4">Inventory</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab5" value="5" />
      <span class="sheet-tab sheet-tab5">Notes</span>
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab99" value="99" />
      <span class="sheet-tab sheet-tab99">Show All</span>

      <div class="section-core">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-bottom-padding sheet-flex-between">
          <div class="sheet-col-left">
            <div class="sheet-flex-between">
              <div class="sheet-col-left-left sheet-thick-border">
                <h3>Abilities</h3>
                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Strength</span>
                    <input class="ability-value" name="attr_strength" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_strength_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_strength_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Melee AB, Athletics, Open Doors, Encumbrance, Fortitude</span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_str_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=STR Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{strength_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{strength_mod}]]}}"></button>
                  </div>
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Dexterity</span>
                    <input class="ability-value" name="attr_dexterity" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_dexterity_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_dexterity_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Ranged AB, Dodge, AC, Initiative, Stealth</span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_dex_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=DEX Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{dexterity_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dexterity_mod}]] ]]}}"></button>
                  </div>
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Constitution</span>
                    <input class="ability-value" name="attr_constitution" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_constitution_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_constitution_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Health, Hit Points</span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_con_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CON Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{constitution_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{constitution_mod}]] ]]}}"></button>

                  </div>
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Intelligence</span>
                    <input class="ability-value" name="attr_intelligence" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_intelligence_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_intelligence_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Perception, Languages, Search, Magic Spell Casting, Skills </span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_int_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=INT Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{intelligence_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{intelligence_mod}]] ]]}}"></button>
                  </div>
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Wisdom</span>
                    <input class="ability-value" name="attr_wisdom" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_wisdom_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_wisdom_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Willpower, Cleric Powers</span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_wis_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=WIS Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{wisdom_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{wisdom_mod}]] ]]}}"></button>
                  </div>
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span>Charisma</span>
                    <input class="ability-value" name="attr_charisma" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_charisma_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <input name="attr_charisma_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                    <span class="noborder left-pad">Ego, Retainer Recruitment, Loyalty, Reaction, Social Skill</span>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_cha_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CHA Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{charisma_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{charisma_mod}]] ]]}}"></button>
                  </div>
                </div>
              </div>

              <div class="sheet-col-left-right sheet-save-col sheet-thick-border-no-pad">
                <h3>Checks</h3>
                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Fortitude</span>
                    <input class="ability-check-value inactive-color" name="attr_fortitude" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_fort_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_fortitude"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Fortitude Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{fortitude} + @{fort_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{fortitude}]] + [[@{fort_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>
                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Dodge</span>
                    <input class="ability-check-value inactive-color" name="attr_dodge" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_dodge_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_dodge"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dodge Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{dodge} + @{dodge_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dodge}]] + [[@{dodge_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>

                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Health</span>
                    <input class="ability-check-value inactive-color" name="attr_health" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_health_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_health"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Health Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{health} +@{health_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{health}]] + [[@{health_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>

                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Perception</span>
                    <input class="ability-check-value inactive-color" name="attr_perception" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_per_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_perception"
                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Perception Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{perception} + @{per_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{perception}]] + [[@{per_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>

                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Willpower</span>
                    <input class="ability-check-value inactive-color" name="attr_willpower" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_will_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_willpower"
                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Willpower Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{willpower} +@{will_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{willpower}]] +[[@{will_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>

                <div class="sheet-flex-between">
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-label">Ego</span>
                    <input class="ability-check-value inactive-color" name="attr_ego" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-value">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_ego_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_ego"
                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Ego Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{ego} +@{ego_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{ego}]] +[[@{ego_bonus}]] ]]}}"></button>
                    </button>
                  </div>
                </div>


              </div>
            </div>


          </div>

          <div class="sheet-col-right">
            <div class="sheet-noborder">
              <div class="sheet-thick-border">
                <h3>Skills</h3>
                <div class="sheet-bold-font center">
                  <span class="med-small-font">Points Available:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_skill_points" value="0" readonly="true"/>
                  </span>
                  <input type="checkbox" class="sheet-skill-points-overspent" name="attr_skill_points_overspent" value="0" hidden="true" checked="true"/>
                  <input type="checkbox" class="sheet-skill-points-underspent" name="attr_skill_points_underspent" value="0" hidden="true" checked="true"/>
                  <span class="sheet-skill-points-overspend-notify sheet-skill-points-underspent-notify med-small-font">Points Spent:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_skill_points_used" value="0" readonly="true"/>
                  </span>
                  <input type="checkbox" class="sheet-max-skill-value-exceeded" name="attr_max_skill_value_exceeded" value="0" hidden="true" checked="true"/>
                  <span class="sheet-max-skill-value-exceeded-notify med-small-font">Max Skill Value:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_max_skill_value_allowed" value="0" readonly="true"/>
                  </span>
                </div>
                <div class="sheet-block">
                  <div class="sheet-block">
                    <div class="sheet-thin-border sheet-bottom-padding">
                      <h4>Skills</h4>
                      <div class="sheet-flex-between">
                        <div class="sheet-block sheet-side-padding">

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Arcana</span>
                              <input type="number" name="attr_arcana_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_arcana_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_arcana"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Arcana Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{arcana_skill} + @{arcana_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{arcana_skill}]] +[[@{arcana_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Architect</span>
                              <input type="number" name="attr_architect_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_architect_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_architect"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Architect Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{architect_skill} + @{architect_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{architect_skill}]] + [[@{architect_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Armory</span>
                              <input type="number" name="attr_armory_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_armory_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_armory"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Armory Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{armory_skill} + @{armory_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{armory_skill}]] + [[@{armory_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Athletics</span>
                              <input type="hidden" name="attr_athletics_skill_mod" value="0"/>
                              <input type="number" name="attr_athletics_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_athletics_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_athletics"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Athletics Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{athletics_skill} + (@{athletics_bonus} bonus) + (@{athletics_skill_mod} STR/DEX mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{athletics_skill} + @{athletics_bonus} + @{athletics_skill_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Bushcraft</span>
                              <input type="number" name="attr_bushcraft_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_bushcraft_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_bushcraft"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Bushcraft Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{bushcraft_skill} +@{bushcraft_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{bushcraft_skill}]] + [[@{bushcraft_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Languages</span>
                              <input type="number" name="attr_languages_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_languages_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_languagues"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Languages Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{languages_skill} + (@{languages_bonus} bonus) + (@{intelligence_mod} INT mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{languages_skill} + @{languages_bonus} + @{intelligence_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Open&nbsp;Doors</span>
                              <input type="number" name="attr_open_door_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_open_door_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_opendoor"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Open Doors Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{open_door_skill} + @{open_door_bonus} bonus +(@{strength_mod} STR mod) }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{open_door_skill} + @{open_door_bonus} @{strength_mod}]] ]]}}"></button>
                            </div>
                          </div>
                        </div>

                        <div class="sheet-block sheet-side-padding">
                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Search</span>
                              <input type="number" name="attr_search_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_search_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_search"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Search Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{search_skill} + @{search_bonus} bonus + (@{intelligence_mod} INT mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{search_skill} + @{search_bonus} +@{intelligence_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Sleight of Hand</span>
                              <input type="number" name="attr_sleight_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_sleight_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_sleight"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Sleight of Hand Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{sleight_skill} +@{sleight_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{sleight_skill}]] +@{sleight_bonus}]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-left">
                              <span class="sheet-bold-font">&nbsp;&nbsp;&nbsp; Sneak Attack</span>
                              <input type="number" name="attr_sneak_attack_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_sneak_attack_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
    		                      <span>&nbsp;&nbsp;</span>
    		                      <span>&nbsp;&nbsp;</span>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Stealth</span>
                              <input type="number" name="attr_stealth_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_stealth_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_stealth"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Stealth Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{stealth_skill} + @{stealth_bonus} bonus + (@{dexterity_mod} DEX mod) }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{stealth_skill} + @{stealth_bonus} +@{dexterity_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <input type="text" class="sheet-primary-skill-name" name="attr_social_skill_name" value="Social (rename)"/>
                              <input type="number" name="attr_social_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_social_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_stealth"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{social_skill_name} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{social_skill} + @{social_skill_bonus} bonus + (@{charisma_mod} CHA mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{social_skill} + @{social_skill_bonus} + @{charisma_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Theology</span>
                              <input type="number" name="attr_theology_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_theology_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_theology"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Theology Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{theology_skill} + @{theology_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{theology_skill}]] + [[@{theology_bonus}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Tinker</span>
                              <input type="number" name="attr_tinker_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_tinker_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_tinker"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Tinker Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{tinker_skill} +@{tinker_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{tinker_skill}]] +[[@{tinker_bonus}]] ]]}}"></button>
                            </div>
                          </div>

                        </div>
                      </div>

                    </div>
                  </div>

                  <div class="sheet-thin-border">
                    <h4>Additional Skills</h4>
                    <fieldset class="repeating_skills">
                      <div class="sheet-block sheet-thin-border sheet-side-padding">
                        <div class="sheet-align-right">
                          <input type="text" name="attr_skillname" class="sheet-bottom-line sheet-skillname"/>
                          <input type="number" name="attr_skillvalue" class="sheet-bold-font" value="1"/>
                          <input type="number" name="attr_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                          <button class="sheet-skill-button" type="roll" name="roll_skill"
                                  value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{skillname} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{skillvalue} +@{skill_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{skillvalue}]] +[[@{skill_bonus}]] ]]}}"></button>
                        </div>
                      </div>
                   </fieldset>
                 </div>
               </div>
             </div>

             <div class="sheet-inline">
               <div class="sheet-thick-border">
                 <h3>Languages</h3>
                 <div class="center">
                    <label class="italic-font centered-label"><span name="attr_max_languages_allowed"/></label>
                    &nbsp;
                 </div>
                 <div class="sheet-flex-between">
                   <div class="sheet-col-right">
                     <h4>Known Languages</h4>
                     <textarea class="sheet-tiny-textarea" spellcheck="false" name="attr_known_lang" data-i18n-placeholder="known_lang"></textarea>
                   </div>
                   <div class="sheet-col-left">
                     <h4>Not Known Languages</h4>
                     <textarea class="sheet-tiny-textarea" spellcheck="false" name="attr_not_known_lang" data-i18n-placeholder="not_known_lang"></textarea>
                   </div>
                 </div>
               </div>
             </div>

            </div>
          </div>
        </div>
      </div>

      <div class="sheet-section-combat">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border-no-pad">
          <h3>Combat</h3>

          <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_cmbt_opts_used" value="0" hidden="true"/>
          <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_cmbt_styles_used" value="0" hidden="true"/>

          <div class="sheet-flex center">
            <input type="checkbox" class="sheet-max-cstyle-copts-value-exceeded" name="attr_max_cstyle_copts_value_exceeded" value="0" hidden="true" checked="true"/>
            <span class="max-cstyle-copts-value-exceeded-notify med-font italic-font">Total Combat Styles and Options Allowed:
              <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_max_cmbt_styles_and_opts_allowed" value="0" readonly="true"/>
            </span>
            <input type="checkbox" class="sheet-cstyle-copts-value-underspent" name="attr_cstyle_copts_value_underspent" value="0" hidden="true" checked="true"/>
            <span class="sheet-cstyle-copts-value-underspent-notify med-font italic-font">Combat Styles and Options Selected:
              <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_cmbt_styles_and_opts_used" value="[[@cmbt_opts_used + @cmbt_styles_used]]" readonly="true"/>
            </span>
          </div>

          <div class="sheet-thin-border bottom-padding">
            <h4>Combat Stats</h4>
            <div class="sheet-flex left-pad bottom-padding">

              <div class="sheet-ability-column-value">
                <div class="sheet-thin-border sheet-flex left-pad">
      	           <button type="roll" class="sheet-initiative" name="roll_initiative"
      			               value="&{template:roll_check} {{title=Initiative}} {{subheader=@{character_name}}} {{initiative=1}} {{rollname=Initiative}} {{roll=[[ 1d20 + @{initiative} + @{init_extra} [Initiative Mod] &{tracker} ]]}}">Roll Init.</button>
                  <input name="attr_init_extra" type="number" hidden="true" value="0"/>
                  <input class="ability-check-value-wide inactive-color" name="attr_initiative" type="number" step="0.01" value="0" readonly="true"/>
                </div>
                <span class="ability-check-label">Initiative Bonus</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_ac" type="number" value="10" readonly="true"/>
                <span class="ability-check-label">AC</span>
              </div>
              <div class="sheet-ability-column-value">
                <div class="sheet-flex sheet-thin-border sheet-right-pad">
                  <input class="ability-check-value" name="attr_hp" type="number" value="1"/>
                  /
                  <input class="ability-check-value" name="attr_hp_max" type="number" value="1"/>
                </div>
                <span class="ability-check-label">HP / Max HP</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_melee_ab" type="number" value="0" readonly="true"/>
                <input name="attr_melee_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Melee AB</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_ranged_ab" type="number" value="0" readonly="true"/>
                <input name="attr_ranged_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Ranged AB</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_unarmed_ab" type="number" value="0" readonly="true"/>
                <input name="attr_unarmed_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Unarmed AB</span>
              </div>

              <!-- HIT DICE, TODO -->
              <input name="attr_hit_dice" type="number" value="1" hidden="true"/>
              <input name="attr_hit_dice_max" type="number" value="1" hidden="true"/>
            </div>
          </div>

          &nbsp;
          <div class="sheet-thin-border bottom-padding">
            <h4>Combat Styles</h4>

            <div class="sheet-flex bottom-padding">
              <span class="sheet-cstyle-name">Style Name</span>
              <span class="sheet-cstyle-wprof">Style Weapon Proficiencies</span>
              <span class="sheet-cstyle-opts">Allowed Combat Options</span>
            </div>

            <fieldset class="repeating_cmbt-styles">
              <div class="sheet-inline-flex">
                <input type="text" name="attr_cmbt_style_name" class="cstyle-name" value="" data-i18n-placeholder="Cmbt Style Name"/>
                <input type="text" name="attr_cmbt_style_profs" class="cstyle-wprof" value="" data-i18n-placeholder="Style attacks, comma separated, 3 max"/>
                <input type="text" name="attr_cmbt_style_opts" class="cstyle-opts" value="" data-i18n-placeholder="Allowed style combat opts, comma sep., 3 max"/>
              </div>
            </fieldset>
          </div>

          <span class="sheet-spacer">&nbsp;</span>

          <div class="sheet-thin-border bottom-padding">
            <div class="sheet-bottom-padding">
              <h4>Combat Options</h4>
            </div>
            <div class="sheet-flex-between">
              <div class="sheet-inline sheet-side-padding">
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_stnd_attack" value="1" checked="checked" readonly="true"/>
                  <span class="ability-check-label">Stnd</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+0 AC+0)</span>
                </div>
                <div class="sheet-bottom-padding">
                  <div class="sheet-flex">
                    &nbsp;&nbsp;
                    <span class="ability-check-label">Parry</span>
                  </div>
                  <div class="sheet-flex">
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <span><input type="radio" class="inactive-color" name="attr_parry_attack" value="0" checked="checked" readonly="true"/>AC+2</span>
                    <span><input type="radio" class="inactive-color" name="attr_parry_attack" value="1" readonly="true"/>AC+4</span>
                  </div>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_charge_attack" value="1" readonly="true"/>
                  <span class="ability-check-label">Charge</span>
                  <div class="sheet-block">
                    <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+2, 2x dam, must move full move to target.</span>
                    <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;Braced targets may cause 2x dam to attacker.)</span>
                  </div>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_press_attack" value="1" readonly="true"/>
                  <span class="ability-check-label">Press</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+2 AC-4, force 1 step retreat)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_defensive_attack" value="1" readonly="true"/>
                  <span class="ability-check-label">Defensive</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB-4 AC+2)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_berserk_attack" value="1"/>
                  <span class="ability-check-label sheet-flex-between">Berserk</span>
                  <div class="sheet-block">
                    <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB +3+Fghtr/4, Dam +3+Fghtr/4, No retreating,</span>
                    <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;Will to Stop, AC-2)</span>
                  </div>
                </div>
              </div>

              <div class="sheet-inline sheet-side-padding">
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_cleave_attack" value="1"/>
                  <span class="ability-check-label">Cleave</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB/2 -&gt; Dam, Attack adj foe on kill, AC-4)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_disarm_attack" value="1"/>
                  <span class="ability-check-label">Disarm</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Target STR save or drop attack, AB-4, AC-4)</span>
                </div>

                <input type="checkbox" class="sheet-cleave_attack_enabled2" name="attr_cleave_attack_enabled2" value="1" hidden="true"/>
                <div class="sheet-section-great_cleave sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_great_cleave_attack" value="1"/>
                  <span class="ability-check-label">Great Cleave</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB -&gt; Dam, Attack adj foe on kill, AC-4)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_feint_attack" value="1"/>
                  <span class="ability-check-label">Aim/Feint</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(+4 AB, -4 Init)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_lightning_attack" value="1"/>
                  <span class="ability-check-label">Lightning Strike</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(-4 AB, +4 Init)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_rapid_strike_attack1" value="1"/>
                  <input type="checkbox" name="attr_rapid_strike_attack2" value="1"/>
                  <span class="ability-check-label">Rapid Strike</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Xtra Melee Attk, AC-4)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_rapid_shot_attack1" value="1"/>
                  <input type="checkbox" name="attr_rapid_shot_attack2" value="1"/>
                  <span class="ability-check-label">Rapid Shot</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Xtra Ranged Attk, AC-4)</span>
                </div>
              </div>

              <div class="sheet-inline sheet-side-padding">
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_shield_bash_attack" value="1"/>
                  <span class="ability-check-label">Shield Bash</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(May make a 2nd attack w/ shield.)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_strong_attack" value="1"/>
                  <span class="ability-check-label">Strong</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Dam x2, AB-4, AC-4)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_stun_attack" value="1"/>
                  <span class="ability-check-label">Stun</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB-4, AC-4, target STR save vs dam or stun)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_two_attack_attack" value="1"/>
                  <span class="ability-check-label">Two Weapon Attack</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(2nd Attk w/ small offhand weapon or AC+1)</span>
                </div>
                <input type="checkbox" class="sheet-two_attack_attack_enabled"  name="attr_two_attack_attack_enabled" value="1" hidden="true"/>
                <div class="sheet-section-two_attack_master sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_two_attack_master_attack" value="1"/>
                  <span class="ability-check-label">Two Weapon Master</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(2nd Attk with offhand weapon or AC+2)</span>
                </div>
                <div class="sheet-thin-border sheet-flex-between">
                  <input type="checkbox" name="attr_sneak_attack_checkbox" value="1" readonly="true"/>
                  <span class="ability-check-label centered-label right-pad">Sneak Attack</span>
                  <span class="sheet-italic-font centered-label right-pad">Extra Dam. Dice</span>
                  <input class="sheet-inactive-color sheet-ability-check-sm-value" name="attr_sneak_attack_dice" type="number" value="0" readonly="true"/>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="sheet-section-attacks"> <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border">
          <h3>Attacks</h3>
          <div class="sheet-flex">
            <input type="checkbox" class="sheet-berserk_attack_enabled" name="attr_berserk_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-charge_attack_enabled" name="attr_charge_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-cleave_attack_enabled" name="attr_cleave_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-defense_attack_enabled" name="attr_defense_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-disarm_attack_enabled" name="attr_disarm_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-great_cleave_attack_enabled" name="attr_great_cleave_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-feint_attack_enabled" name="attr_feint_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-press_attack_enabled" name="attr_press_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-lightning_attack_enabled" name="attr_lightning_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-sneak_attack_enabled" name="attr_sneak_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-strong_attack_enabled" name="attr_strong_attack_enabled" value="1" hidden="true"/>
            <input type="checkbox" class="sheet-stun_attack_enabled" name="attr_stun_attack_enabled" value="1" hidden="true"/>
            <input type="number" name="attr_berserk_attack_mod" value="2" hidden="true"/>

            <span class="sheet-attack-param-name sheet-rotate sheet-bold-font sheet-italic-font left-pad right-pad">Notches</span>
            <span class="sheet-attack-param-name sheet-rotate sheet-bold-font sheet-italic-font left-pad right-pad">Prof.</span>
            <span class="sheet-attack-name sheet-bold-font">Name</span>
            <span class="sheet-attack-param-name sheet-bold-font">Add. Bonus</span>
            <span class="sheet-attack-param-long-name sheet-bold-font">Attk Type</span>
            <span class="sheet-attack-param-name sheet-bold-font">Attk Bonus</span>
            <span class="sheet-attack-param-select-name sheet-bold-font">Damage</span>
            <span class="sheet-attack-param-long-name sheet-bold-font">Dam. Type</span>
            <span class="sheet-attack-param-name sheet-bold-font">Dam Bonus</span>

            <span class="sheet-attack-param-attk-name sheet-bold-font">Stnd. Attack</span>

            <div class="sheet-charge_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Charge Attack</span>
            </div>

            <div class="sheet-press_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Press Attack</span>
            </div>

            <div class="sheet-defense_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Defns. Attack</span>
            </div>

            <div class="sheet-berserk_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Berserk Attack</span>
            </div>

            <div class="sheet-cleave_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Cleave Attack</span>
            </div>

            <div class="sheet-disarm_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Disarm Attack</span>
            </div>

            <div class="sheet-great_cleave_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Great Cleave Attack</span>
            </div>

            <div class="sheet-feint_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Aim/Feint Attack</span>
            </div>

            <div class="sheet-lightning_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Lightning Strike</span>
            </div>

            <div class="sheet-strong_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Strong Attack</span>
            </div>

            <div class="sheet-stun_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Stun Attack</span>
            </div>

            <div class="sheet-sneak_attack_section">
              <span class="sheet-attack-param-attk-name sheet-bold-font">Sneak Attack</span>
            </div>

          </div>

          <fieldset class="repeating_attacks">
            <div class="sheet-inline-flex">
              <input type="checkbox" class="sheet-attack_berserk_attack_enabled" name="attr_attack_berserk_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_charge_attack_enabled" name="attr_attack_charge_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_cleave_attack_enabled" name="attr_attack_cleave_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_defense_attack_enabled" name="attr_attack_defense_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_disarm_attack_enabled" name="attr_attack_disarm_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_great_cleave_attack_enabled" name="attr_attack_great_cleave_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_feint_attack_enabled" name="attr_attack_feint_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_press_attack_enabled" name="attr_attack_press_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_lightning_attack_enabled" name="attr_attack_lightning_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_strong_attack_enabled" name="attr_attack_strong_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_stun_attack_enabled" name="attr_attack_stun_attack_enabled" value="1" hidden="true"/>
              <input type="checkbox" class="sheet-attack_sneak_attack_enabled" name="attr_attack_sneak_attack_enabled" value="1" hidden="true"/>

              <input name="attr_attack_sneak_attack_bonus" value="@{sneak_attack_skill} + @{attack_bonus} - @{attack_notches}" hidden="true"/>
              <input name="attr_attack_sneak_attack_dam" value="0" hidden="true"/>

              <select class="sheet-attack-notches" name="attr_attack_notches">
                <option selected="selected" value="0">--</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>

              <input type="checkbox" class="sheet-attack-notches" name="attr_has_attack_proficiency" value="1"/>
              <input type="text" name="attr_attack_name" class="attack-name" data-i18n-placeholder="attack name"/>
              <input type="number" name="attr_attack_bonus" class="attack-param sheet-purple-border" value="0"/>

      	      <select class="attack-param-long" name="attr_attack_attk_type">
      	        <option selected="selected" value="melee">Melee</option>
      	        <option value="ranged">Ranged</option>
      	        <option value="unarmed">Unarmed</option>
      	        <option value="spell">Spell</option>
      	      </select>

              <input type="number" name="attr_attack_attack_bonus" value="0" class="attack-param bold-font inactive-color" readonly="true"/>

              <input type="text" name="attr_attack_dam_die" class="attack-param" data-i18n-placeholder="1d6"/>

              <input name="attr_attack_dam" value="0" hidden="true"/>

      	      <select class="attack-param-long" name="attr_attack_dam_type">
                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                <option value="Piercing">Pierce</option>
                <option value="Slashing">Slash</option>
                <option value="Acid">Acid</option>
                <option value="Cold">Cold</option>
                <option value="Fire">Fire</option>
                <option value="Force">Force</option>
                <option value="Lightning">Lightning</option>
                <option value="Necrotic">Necrotic</option>
                <option value="Poison">Poison</option>
                <option value="Psychic">Psychic</option>
                <option value="Radiant">Radiant</option>
                <option value="Thunder">Thunder</option>
      	      </select>

              <!--
              <select class="sheet-attack-param" name="attr_attack_dam_die2">
                <option selected="selected" value="0"></option>
                <option value="1d2">1d2</option>
                <option value="1d4">1d4</option>
                <option value="1d6">1d6</option>
                <option value="1d8">1d8</option>
                <option value="1d10">1d10</option>
                <option value="1d12">1d12</option>
                <option value="2d4">2d4</option>
                <option value="2d6">2d6</option>
                <option value="2d8">2d8</option>
    	          <option value="2d10">2d10</option>
                <option value="2d12">2d12</option>
                <option value="3d6">3d6</option>
                <option value="3d8">3d8</option>
                <option value="3d10">3d10</option>
                <option value="3d12">3d12</option>
                <option value="2d20">2d20</option>
              </select>
              <input name="attr_attack_dam2" value="0" hidden="true"/>
              -->

              <input type="number" name="attr_attack_dam_bonus" class="attack-param bold-font inactive-color" value="[[@{strength_mod}+@{attack_bonus}]]" disabled="true"/>

              <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_standard_attack"
                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} Attack}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] ]]}} {{critical=[[19 + @{attack_attack_bonus}]]}} {{fumble=[[2+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + [[@{attack_dam_bonus}]] ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }}"></button>

              <div class="sheet-attack_charge_attack_section">
                <input type="checkbox" class="sheet-attack-charge-attack-button-show" name="attr_attack_charge_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-charge-attack-button-enabled">
                  <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_charge_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Charge Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] +2 ]]}} {{critical=[[21 + @{attack_attack_bonus}]]}} {{fumble=[[4+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] +2 [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} [Dam] }} {{special=Must move full move to attack. Braced opponents w/ long attacks immediately counterattack.}}"></button>
                </div>
                <div class="sheet-attack-charge-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_press_attack_section">
                <input type="checkbox" class="sheet-attack-press-attack-button-show" name="attr_attack_press_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-press-attack-button-enabled">
                  <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_press_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Press Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] + 2 ]]}} {{critical=[[21 + @{attack_attack_bonus}]]}} {{fumble=[[4+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] + 2 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }} {{special=Force 1 step retreat on hit. -4 AC next round.}}"></button>
                </div>
                <div class="sheet-attack-press-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_defense_attack_section">
                <input type="checkbox" class="sheet-attack-defense-attack-button-show" name="attr_attack_defense_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-defense-attack-button-enabled">
                  <button class="sheet-attack-button sheet-red-border" type="roll" name="roll_defense_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Defensive Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] - 4]]}} {{critical=[[15 + @{attack_attack_bonus}]]}} {{fumble=[[-2+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] -4 [Attack], @{attack_dam} + @{attack_dam_bonus} [Damage] }} {{special=+2 AC next round.}}"></button>
                </div>
                <div class="sheet-attack-defense-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_berserk_attack_section">
                <input type="checkbox" class="sheet-attack-berserk-attack-button-show" name="attr_attack_berserk_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-berserk-attack-button-enabled">
                  <button class="sheet-attack-button sheet-yellow-border" type="roll" name="roll_berserk_attack"
    	                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Berserk Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] + [[@{berserk_attack_mod}]] ]]}} {{critical=[[19 + @{attack_attack_bonus} + [[@{berserk_attack_mod}]] ]]}} {{fumble=[[2+@{attack_attack_bonus} + [[@{berserk_attack_mod}]] ]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} ]]}}   {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} ]]}}  {{math=1d20 + [[@{attack_attack_bonus}]] + @{berserk_attack_mod} [Attk], @{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} [Dam] }} {{special=Will vs DC 12 to stop. No Retreat. AC-2 for next rnd.}}"></button>
                </div>
                <div class="sheet-attack-berserk-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_cleave_attack_section">
                <input type="checkbox" class="sheet-attack-cleave-attack-button-show" name="attr_attack_cleave_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-cleave-attack-button-enabled">
                  <button class="sheet-attack-button sheet-blue-border" type="roll" name="roll_cleave_attack"
    	                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Cleave Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_bonus}]] ]]}} {{critical=[[19 + @{attack_bonus}]]}} {{fumble=[[2+@{attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_attack_bonus}/2 ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_attack_bonus}/2 ]]}} {{math=1d20 + [[@{attack_bonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} + [[@{attack_attack_bonus}/2]] [Dam] }} {{special=-4 AC for next round}}"></button>
                </div>
                <div class="sheet-attack-cleave-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_disarm_attack_section">
                <input type="checkbox" class="sheet-attack-disarm-attack-button-show" name="attr_attack_disarm_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-disarm-attack-button-enabled">
                  <button class="sheet-attack-button sheet-blue-border" type="roll" name="roll_disarm_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Disarm Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] - 4 ]]}} {{critical=[[15 + @{attack_attack_bonus}]]}} {{fumble=[[-2+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] - 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }} {{special=Target STR save vs damage or drop attack. -4 AC next round.}}"></button>
                </div>
                <div class="sheet-attack-disarm-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_great_cleave_attack_section">
                <input type="checkbox" class="sheet-attack-great-cleave-attack-button-show" name="attr_attack_great_cleave_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-great-cleave-attack-button-enabled">
                  <button class="sheet-attack-button sheet-blue-border" type="roll" name="roll_great_cleave_attack"
    	                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Great Cleave Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_bonus}]] ]]}} {{critical=[[19 + @{attack_bonus}]]}} {{fumble=[[2+@{attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_attack_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_attack_bonus} ]]}} {{math=1d20 + [[@{attack_bonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_attack_bonus} [Dam] }} {{special=-4 AC for next round}}"></button>
                </div>
                <div class="sheet-attack-great-cleave-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_feint_attack_section">
                <input type="checkbox" class="sheet-attack-feint-attack-button-show" name="attr_attack_feint_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-feint-attack-button-enabled">
                  <button class="sheet-attack-button sheet-blue-border" type="roll" name="roll_feint_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Aim/Feint Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] + 4 ]]}} {{critical=[[23 + @{attack_attack_bonus}]]}} {{fumble=[[6+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] + 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }} {{special=Attack occurs at -4 Initiative.}}"></button>
                </div>
                <div class="sheet-attack-feint-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_lightning_attack_section">
                <input type="checkbox" class="sheet-attack-lightning-attack-button-show" name="attr_attack_lightning_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-lightning-attack-button-enabled">
                  <button class="sheet-attack-button sheet-yellow-border" type="roll" name="roll_lightning_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Lightning Strike</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] - 4 ]]}} {{critical=[[15 + @{attack_attack_bonus}]]}} {{fumble=[[-2+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] - 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }} {{special=Attack earlier, Init +4. AB-4.}}"></button>
                </div>
                <div class="sheet-attack-lightning-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_strong_attack_section">
                <input type="checkbox" class="sheet-attack-strong-attack-button-show" name="attr_attack_strong_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-strong-attack-button-enabled">
                  <button class="sheet-attack-button sheet-green-border" type="roll" name="roll_strong_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b> Strong Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] -4 ]]}} {{critical=[[13 + @{attack_attack_bonus}]]}} {{fumble=[[-4+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] -4 [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} [Dam] }} {{special=-4 AC for next round}}"></button>
                </div>
                <div class="sheet-attack-strong-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_stun_attack_section">
                <input type="checkbox" class="sheet-attack-stun-attack-button-show" name="attr_attack_stun_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-stun-attack-button-enabled">
                  <button class="sheet-attack-button sheet-orange-border" type="roll" name="roll_stun_attack"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Stun Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_attack_bonus}]] -4 ]]}} {{critical=[[15 + @{attack_attack_bonus}]]}} {{fumble=[[-2+@{attack_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{attack_attack_bonus}]] -4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{attack_dam_type} Damage] }} {{special=Target STR save vs damage or stun 1d3-1 rnds. -4 AC next round.}}"></button>
                </div>
                <div class="sheet-attack-stun-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

              <div class="sheet-attack_sneak_attack_section">
                <input type="checkbox" class="sheet-attack-sneak-attack-button-show" name="attr_attack_sneak_attack_button_show" value="1" hidden="true" checked="checked"/>
                <div class="sheet-attack-sneak-attack-button-enabled">
                  <button class="sheet-attack-button sheet-orange-border" type="roll" name="roll_sneak_attack"
    	                    value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{attack_name} <b>Sneak Attack</b>}} {{subheader=@{character_name}}} {{attack=1}} {{attack=[[ 1d20 + [[@{attack_sneak_attack_bonus}]] ]]}} {{critical=[[19 + @{attack_sneak_attack_bonus}]]}} {{fumble=[[2+@{attack_sneak_attack_bonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_sneak_attack_dam}]]}} {{damagetype=@{attack_dam_type}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_sneak_attack_dam} + @{attack_sneak_attack_dam} ]]}} {{math=1d20 + @{attack_sneak_attack_bonus} [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_sneak_attack_dam} [Dam] }}"></button>
                </div>
                <div class="sheet-attack-sneak-attack-button-disabled">
                  <button class="sheet-attack-button nod20 inactive-color" type="roll" name="roll_disabled_attack" value="" disabled="true">X</button>
                </div>
              </div>

            </div>
          </fieldset>
        </div>
      </div>

      <div class="sheet-section-magic">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border">
        <h3>Magic</h3>
          <div class="sheet-thin-border">
            <h4>Spellcasting</h4>
            <div class="sheet-flex-between">
              <div class="sheet-flex-between sheet-center">
                <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                   <span>Spellcasting Type</span>
                </div>
                <input class="ability-value sheet-inactive-color sheet-align-left info4" name="attr_spellcasting_type" type="text" value="None" readonly="true"/>
              </div>

              <div class="sheet-flex">
                <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                  <span>Spellcasting Modifier</span>
                </div>
                <div class="sheet-ability-column-modifier sheet-flex-between">
                  <div class="sheet-thin-border sheet-flex sheet-side-padding">
                    <span><h2>+</h2></span>
                    <input class="ability-value sheet-inactive-color" name="attr_spellcasting_mod" type="number" value="0" readonly="true"/>
                  </div>
                </div>
              </div>
              <div class="sheet-flex">
                <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                  <span>Spell Save DC</span>
                </div>
                <div class="sheet-ability-column-modifier sheet-flex-between">
                  <div class="sheet-thin-border sheet-flex sheet-side-padding">
                    <input class="ability-value sheet-inactive-color" name="attr_spellcasting_dc" type="number" value="0" readonly="true"/>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <span class="sheet-spacer">&nbsp;</span>

          <div class="sheet-thin-border sheet-bottom-padding">
            <h4>Powers</h4>
            <input type="checkbox" name="attr_has_cleric_powers" class="sheet-has-cleric-powers" value="1" hidden="True">
            <div class="sheet-show-cleric-powers">
              <div class="sheet-flex-between">
                <div class="sheet-flex-between sheet-thin-border sheet-padding">
                  <span class="sheet-bold-font">Turn Undead</span>
                  <div class="sheet-col-left sheet-inline">
                    <input type="checkbox" name="attr_turn_undead1" value="1"/>
                    <input type="checkbox" name="attr_turn_undead2" value="1"/>
                    <input type="checkbox" name="attr_turn_undead3" value="1"/>
                    <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                  </div>
                  <div class="sheet-col-right">
                    <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_turn_undead_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Turn Undead Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                  </div>
                </div>
                <div class="sheet-flex-between sheet-padding sheet-thin-border">
                  <span class="sheet-bold-font">Dispel Magic</span>
                  <div class="sheet-col-left sheet-inline">
                    <input type="checkbox" name="attr_dispel_magic1" value="1"/>
                    <input type="checkbox" name="attr_dispel_magic2" value="1"/>
                    <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                  </div>
                  <div class="sheet-col-right">
                    <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_dispel_magic_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dispel Magic Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                  </div>
                </div>
                <div class="sheet-flex-between sheet-padding sheet-thin-border">
                  <div class="sheet-col-left sheet-inline">
                    <span class="sheet-bold-font">Dispel Evil</span>
                    <input type="checkbox" name="attr_dispel_evil" value="1"/>
                    &nbsp;
                    <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                  </div>
                  <div class="sheet-col-right">
                    <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_dispel_evil_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dispel Evil Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <span class="sheet-spacer">&nbsp;</span>

          <div class="sheet-thin-border sheet-spells">
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="all" checked/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="1"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="2"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="3"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="4"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="5"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="6"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="7"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="8"/>
            <input type="checkbox" name="attr_spells_filter" class="sheet-spellfilter" value="9"/>
            <h4>Spellbook</h4>

            <input type="checkbox" name="attr_can_cast_magic" class="sheet-can-cast-magic" value="1" hidden="True">
            <div class="sheet-show-spellbook">
              <div class="sheet-spells-per-level sheet-flex">
                <div class="sheet-flex">
                  <span class="sheet-italic-font sheet-big-font heet-side-padding">Slots / Level</span>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">1st: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl1_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box sheet-inactive-color" name="attr_lvl1_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl1_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">2nd: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl2_slots_expended" value="0"/>
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl2_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl2_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">3rd: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl3_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl3_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl3_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">4th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl4_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl4_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl4_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">5th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl5_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl5_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl5_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">6th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl6_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl6_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl6_slots_total"/>
                </div>
                    <div class="sheet-flex">
                    <span class="sheet-med-font">7th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl7_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl7_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl7_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">8th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl8_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl8_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl8_slots_total"/>
                </div>
                <div class="sheet-flex">
                    <span class="sheet-med-font">9th: </span>
                    <input type="number" class="sheet-spellslot-box" name="attr_lvl9_slots_expended" value="0" />
                    /
                    <input type="number" class="sheet-spellslot-box inactive-color" name="attr_lvl9_slots_total" value="0" hidden="true"/>
                    <span class="sheet-spellslot-box bold-font spellslot-value sheet-inactive-color" name="attr_lvl9_slots_total"/>
                </div>
              </div>

              <div class="sheet-spell-filters sheet-flex center">
               <span class="sheet-bold-font">Filter:</span>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="all" checked/>
                   <span data-i18n="all"></span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="1"/>
                   <span>1</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="2"/>
                   <span>2</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="3"/>
                   <span>3</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="4"/>
                   <span>4</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="5"/>
                   <span>5</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="6"/>
                   <span>6</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="7"/>
                   <span>7</span>
               </label>
               <label class="sheet-filter-button">
                   <input type="radio" name="attr_spells_filter" value="8"/>
                   <span>8</span>
               </label>
               <label class="sheet-filter-button">
                 <input type="radio" name="attr_spells_filter" value="9"/>
                 <span>9</span>
               </label>
             </div>

             <fieldset class="repeating_spells">
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="1" checked="True"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="2"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="3"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="4"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="5"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="6"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="7"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="8"/>
               <input type="checkbox" name="attr_spelllevel" class="sheet-hidden-spell-level" value="9"/>
               <div class="sheet-spellcontainer sheet-side-padding">
                 <input type="text" name="attr_spellname" class="sheet-bottom-line sheet-spell-name" data-i18n-placeholder="name"/>
                 <span class="sheet-left-pad"> Level:</span>
                 <select class="sheet-info-name-sm sheet-align-right" name="attr_spelllevel">
                   <option selected="selected" value="1">1</option>
                   <option value="2">2</option>
                   <option value="3">3</option>
                   <option value="4">4</option>
                   <option value="5">5</option>
                   <option value="6">6</option>
                   <option value="7">7</option>
                   <option value="8">8</option>
                   <option value="9">9</option>
                 </select>
                 <input name="attr_adhoc_dc" value="0" hidden="true"/>
                 <span class="sheet-left-pad">Dice:</span>
                 <input type="text" class="sheet-info1 sheet-align-right sheet-spell-dice" name="attr_spell_dice" value="">
                 <input type="checkbox" name="attr_is_dice_spell" class="sheet-is-dice-spell" value="1" hidden="True">
                 <div class="sheet-dice-spell">
                   <div class="sheet-flex save-col center centered-label">
                     <button class="sheet-cast-button sheet-orange-border" type="roll" name="roll_cast_spell"
                             value="@{wtype}&{template:spell} {{name=@{character_name}}} {{innate=}} {{memorized=1}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{level= @{spelllevel}}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{spell_dice_enabled=1}} {{roll1=[[@{spell_dice}]]}} {{description=@{spelldescription}}}"></button>
                      <span class="small-font centered-label">Cast</span>
                   </div>
                 </div>
                 <div class="sheet-no-dice-spell">
                   <div class="sheet-flex save-col center centered-label">
                     <button class="sheet-cast-button sheet-orange-border" type="roll" name="roll_cast_spell"
                             value="@{wtype}&{template:spell} {{name=@{character_name}}} {{innate=}} {{memorized=1}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{level= @{spelllevel}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{description=@{spelldescription} }}"></button>
                      <span class="small-font centered-label">Cast</span>
                   </div>
                </div>
                 <input type="checkbox" name="attr_is_adhoc_dice_spell" class="sheet-is-adhoc-dice-spell" value="1" hidden="True">
                 <div class="sheet-adhoc-dice-spell">
                   <div class="sheet-flex save-col center centered-label">
                     <button class="sheet-cast-button nod20 sheet-red-border" type="roll" name="roll_cast_adhoc_spell"
                             value="@{wtype}&{template:spell} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{spell_dice_enabled=1}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]] }} {{critical=[[19]]}} {{fumble=[[2]]}} {{roll1=[[@{spell_dice}]]}} {{description=@{spelldescription}}}">
                             <span name="attr_adhoc_dc"/></button>
                      <span class="small-font centered-label">Adhoc</span>
                   </div>
                 </div>
                 <input type="checkbox" name="attr_is_adhoc_no_dice_spell" class="sheet-adhoc-not-dice-spell" value="1" hidden="True">
                 <div class="sheet-adhoc-no-dice-spell">
                   <div class="sheet-flex save-col center centered-label">
                     <button class="sheet-cast-button nod20 sheet-red-border" type="roll" name="roll_cast_adhoc_spell"
                             value="@{wtype}&{template:spell} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
                             <span name="attr_adhoc_dc"/></button>
                     <span class="small-font centered-label">Adhoc</span>
                   </div>
                 </div>
                 <textarea spellcheck="false" name="attr_spelldescription" class="sheet-spell-description" data-i18n-placeholder="description"></textarea>
               </div>
             </fieldset>
           </div>
         </div>
       </div>
     </div>

     <div class="sheet-section-inventory">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-block">
          <div class="sheet-flex-between sheet-bottom-padding">
            <div class="sheet-thin-border sheet-padding">
              <span class="sheet-bold-font sheet-left-pad">Encumbrance Points:</span>
              <input type="number" name="attr_encumbrance_points" class="sheet-inactive-color" value="0" readonly="true"/>
              <span class="sheet-bold-font">Encumbrance Modifier:</span>
              <input type="number" name="attr_encumbrance_mod" class="sheet-inactive-color" value="0" readonly="true"/>
              <span class="sheet-bold-font sheet-big-font">Encumbrance: </span>
              <input type="number" name="attr_encumbrance" class="sheet-inactive-color sheet-right-pad" value="0" readonly="true"/>
            </div>
          </div>
          <div class="sheet-thick-border">
          <h3>Inventory</h3>
            <div class="sheet-block">
              <div class="sheet-thin-border sheet-padding">
                <h4 class="sheet-bold-font">Worn Items</h4>
                <div class="sheet-flex-between">
                  <div class="table sheet-fill-width">
                    <div class="table-row sheet-inline-flex">
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font sheet-worn-item">Armor:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <select name="attr_armor" class="sheet-worn-name">
                          <option selected="selected" value="none">Clothing / 0 Slots</option>
                          <option value="padded">Padded / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="leather">Leather / 1 Slot / +3 AC max DEX bonus</option>
                          <option value="studded_leather">Std. Leather / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="scale">Scale / 1 Enc. Pts. / 1 Slot / +0 AC max DEX bonus</option>
                          <option value="chainshirt">Chain Shirt / 1 Enc. Pts. / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="chain">Chain / 1 Enc. Pts. / 1 Slot / +1 AC max DEX bonus</option>
                          <option value="half_plate">Half Plate/ 1 Enc. Pts. / 2 Slots / -1 Dex Mod penalty</option>
                          <option value="plate">Plate / 2 Enc. Pts. / 2 Slots / -2 Dex Mod penalty</option>
                        </select>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <div class="sheet-flex">
                          <input type="number" class="center sheet-purple-border" name="attr_armor_bonus" value="0"/>
                          <div class="sheet-block">
                            <select class="sheet-attack-notches" name="attr_armor_notches">
                              <option selected="selected" value="0">--</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                            </select>
                            <span class="sheet-italic-font">Notches</span>
                          </div>
                        </div>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Head/Neck:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_head" data-i18n-placeholder="head or neck"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Body/Belt:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_body" data-i18n-placeholder="body or belt"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">R Ring:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_rring" data-i18n-placeholder="right ring"/>
                      </div>
                    </div>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Shield:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <select name="attr_shield" class="sheet-worn-name">
                          <option selected="selected" value="none">None</option>
                          <option value="small_shield">Small Shield / 1 Slot</option>
                          <option value="large_shield">Large Shield / 2 Slots</option>
                          <option value="tower_shield">Tower Shield / 2 Slots/ 1 Enc</option>
                        </select>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <div class="sheet-flex">
                          <input type="number" class="center sheet-purple-border" name="attr_shield_bonus" value="0"/>
                          <div class="sheet-block">
                            <select class="sheet-attack-notches" name="attr_shield_notches">
                              <option selected="selected" value="0">--</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                            </select>
                            <span class="sheet-italic-font">Notches</span>
                          </div>
                        </div>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Legs/Feet:&nbsp;&nbsp;</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_feet" data-i18n-placeholder="legs or feet"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Hand/Arm:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_gloves" data-i18n-placeholder="gloves or arms"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">L Ring:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_lring" data-i18n-placeholder="left ring"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="sheet-flex-between">
              <div class="sheet-col-left-inv">

                <div class="sheet-thin-border sheet-padding">
                  <h3>Ready Items</h3>
                  <div class="table sheet-fill-width">
                    <input class="sheet-dex-show-slots" name="attr_dex-show-slots" type="hidden" value="18"/>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-header-cell sheet-item-name"><span>Item Name</span></div>
                      <div class="table-cell sheet-table-header-cell sheet-item-dex">Min Dex.</div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-cell"><input name="attr_islot3-1" type="text" class="sheet-item-name" value="" data-i18n-placeholder="Primary Hand"/></div>
                      <div class="table-cell sheet-table-cell"><input type="number" value="3" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                    </div>
                    <div class="sheet-dex4slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot4-1" type="text" class="sheet-item-name" data-i18n-placeholder="Off Hand"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="4" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex4slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot4-2" type="text" class="sheet-item-name sheet-inactive-color" data-i18n-placeholder="Off Hand" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="4" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-dex6slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-1" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-2" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-3" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex6slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex9slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex9slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex13slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex13slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex16slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex16slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex18slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex18slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                  </div>
                </div>
              </div>
              <div class="sheet-col-right-inv">
                <div class="sheet-thin-border sheet-bottom-padding">
                  <h3>Purse (Coins/Gems)</h3>
                  <textarea class="sheet-sm-textarea" spellcheck="false" name="attr_purse_items" data-i18n-placeholder="coins_gems"></textarea>
                </div>
                <div class="sheet-padding"></div>
                <div class="sheet-flex-between">
                  <div class="sheet-col-right sheet-padding">
                    <div class="sheet-thin-border sheet-padding">
                      <div class="table sheet-fill-width">
                        <div class="table-row sheet-flex-simple">
                          <div class="table-cell sheet-table-header-cell"><span>Container 1 </span></div>
                          <div class="table-cell sheet-table-header-cell">
                            <select name="attr_container_1_type" class="sheet-info5">
                              <option selected="selected" value="none">None</option>
                              <option value="sack">Sack</option>
                              <option value="small_pack">Small Pack</option>
                              <option value="large_pack">Large Pack - 1 Enc. Pt.</option>
                            </select>
                          </div>
                        </div>
                        <input class="sheet-cont1-show-slots" name="attr_cont1_show_slots" type="hidden" value="none"/>
                        <div class="table-row sheet-table-sep-row"></div>
                        <div class="sheet-sack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-1" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-2" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-3" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-sack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                        <div class="sheet-sm-pack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-4" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-5" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-sm-pack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                        <div class="sheet-lrg-pack-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-6" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-7" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-8" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-9" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-10" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-lrg-pack-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="sheet-padding"></div>
                  <div class="sheet-col-left sheet-padding">
                    <div class="sheet-block">
                      <div class="sheet-thin-border sheet-padding">
                        <div class="table sheet-fill-width">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-header-cell"><span>Container 2 </span></div>
                            <div class="table-cell sheet-table-header-cell">
                              <select name="attr_container_2_type" class="sheet-info5">
                                <option selected="selected" value="none">None</option>
                                <option value="sack">Sack</option>
                                <option value="small_pack">Small Pack - 1 Enc. Pt.</option>
                              </select>
                            </div>
                          </div>
                          <input class="sheet-cont2-show-slots" name="attr_cont2_show_slots" type="hidden" value="none"/>
                          <div class="table-row sheet-table-sep-row"></div>
                          <div class="sheet-sack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-1" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-2" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-3" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                          <div class="sheet-sm-pack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-4" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-5" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sm-pack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                          <div class="table-row sheet-table-sep-row"></div>
                        </div>
                      </div>
                      <div class="sheet-padding"></div>
                      <div class="sheet-thin-border sheet-padding">
                        <div class="table sheet-fill-width">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-header-cell"><span>Container 3 </span></div>
                            <div class="table-cell sheet-table-header-cell">
                              <select name="attr_container_3_type" class="sheet-info5">
                                <option selected="selected" value="none">None</option>
                                <option value="sack">Sack - 1 Enc. Pt.</option>
                              </select>
                            </div>
                          </div>
                          <input class="sheet-cont3-show-slots" name="attr_cont3_show_slots" type="hidden" value="none"/>
                          <div class="table-row sheet-table-sep-row"></div>
                          <div class="sheet-sack3-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-1" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-2" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-3" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sack3-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="sheet-padding"></div>
                <div class="sheet-thin-border sheet-bottom-padding">
                  <h3>Non-Encumbering Items</h3>
                  <textarea class="sheet-med-textarea" spellcheck="false" name="attr_non_encumber_items" data-i18n-placeholder="non_encumber_items"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="sheet-section-notes">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border">
          <h3>Notes</h3>
          <textarea class="sheet-lrg-textarea" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Templates -->
<rolltemplate class="sheet-rolltemplate-spell">
  <div class="sheet-rt-card">
    <div class="sheet-rt-header sheet-spell">
      <div class="sheet-rt-title">{{title}}</div>
      {{#subheader}}
      <div class="sheet-rt-subheader">{{subheader}}{{#subheaderright}} &bullet; {{subheaderright}}{{/subheaderright}}</div>
      {{/subheader}} {{#subheader2}}
      <div class="sheet-rt-subheader">{{subheader2}}{{#subheaderright2}} &bullet; {{subheaderright2}}{{/subheaderright2}}</div>
      {{/subheader2}}
    </div>

    <div class="sheet-main-content">

        <div class="sheet-row">
          {{#adhoc}}
          <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Adhoc Casting</div>
          <div class="sheet-col-5-12 sheet-padr sheet-rt-value">DC: {{dc}}</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Adhoc casting roll: {{adhoc}}</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> </div>

          {{#rollBetween() adhoc fumble critical}}

            {{#rollGreater() adhoc dc}}
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><b>Casting success.</b></div>
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell takes effect normally.</div>
            {{/rollGreater() adhoc dc}}

            {{#^rollGreater() adhoc dc}}
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><b>Casting failure.</b></div>
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Roll Adhoc casting failure result.</div>
            {{/^rollGreater() adhoc dc}}

          {{/rollBetween() adhoc fumble critical}}

          {{#rollWasCrit() adhoc}}
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Critical!</h3></i> &dash; automatic casting success.</div>
          {{/rollWasCrit() adhoc}}

          {{#rollWasFumble() adhoc}}
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Fumble!</h3></i> &dash; automatic spell failure.</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Roll adhoc casting blowback result.</div>
          {{/rollWasFumble() adhoc}}

          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> </div>

          {{/adhoc}}

          {{#memorized}}
          <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Casting memorized spell.</div>
          {{/memorized}}

        </div>

        <div class="sheet-row">

              {{#memorized}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Save DC: {{spell_save_dc}}</div>

              {{#spell_dice_enabled}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Dice Roll: {{roll1}}</div>
              {{/spell_dice_enabled}}
              {{/memorized}}

              {{#adhoc}}
              {{#rollWasCrit() adhoc}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Save DC: {{spell_save_dc}}</div>
              {{/rollWasCrit() adhoc}}

              {{#rollBetween() adhoc fumble critical}}
              {{#rollGreater() adhoc dc}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Save DC: {{spell_save_dc}}</div>
              {{/rollGreater() adhoc dc}}
              {{/rollBetween() adhoc fumble critical}}

              {{#spell_dice_enabled}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Dice Roll: {{roll1}}</div>
              {{/spell_dice_enabled}}

              {{/adhoc}}

               {{#noadvroll}}
               <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{roll1}}</div>
               {{/noadvroll}}
        </div>

        <!--
        {{#math}}
        <div class="sheet-row">
                 <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Math</div>
                 <div class="sheet-col-7-12 sheet-padr sheet-rt-value sheet-no-roll-highlight">{{math}}</div>
        </div>
        {{/math}}
        -->

        {{#special}}
        <div class="sheet-row">
                 <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Special</div>
                 <div class="sheet-col-7-12 sheet-padr sheet-rt-value sheet-no-roll-highlight">{{special}}</div>
        </div>
        {{/special}}

        {{#description}}
        <div class="sheet-row">{{description}}</div>
        {{/description}}

    </div>
  </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-roll_check">
  <div class="sheet-rt-card">
	  <div class="sheet-rt-header{{#attack}} sheet-attack{{/attack}}{{#skill}} sheet-skill{{/skill}} {{#initiative}} sheet-initiative{{/initiative}}{{#ability}} sheet-ability{{/ability}}{{#save}} sheet-save{{/save}}{{#deathsave}} sheet-deathsave{{/deathsave}}">
      <div class="sheet-rt-title">{{title}}</div>
      {{#subheader}}
      <div class="sheet-rt-subheader">{{subheader}}{{#subheaderright}} &bullet; {{subheaderright}}{{/subheaderright}}</div>
      {{/subheader}} {{#subheader2}}
      <div class="sheet-rt-subheader">{{subheader2}}{{#subheaderright2}} &bullet; {{subheaderright2}}{{/subheaderright2}}</div>
      {{/subheader2}}
    </div>
    {{#emote}}
    <p class="sheet-rt-emote">{{character_name}} {{emote}}</p>
    {{/emote}}
    <div class="sheet-main-content">
        {{#attack}}
        <div class="sheet-row">
                <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Attack</div>
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{attack}} vs AC</div>
                {{#rollWasCrit() attack}}
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Critical Hit!</h3></i></div>
                {{/rollWasCrit() attack}}
                {{#rollWasFumble() attack}}
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Fumble!</h3></i></div>
                {{/rollWasFumble() attack}}
        </div>
        {{/attack}}
        {{#damage}}
        <div class="sheet-row">
                <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Damage</div>

                {{#rollBetween() attack fumble critical}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> {{damage}} ({{damagetype}})</div>
                  {{#damage2}}
                    <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> {{damage2}} ({{damagetype2}})</div>
                  {{/damage2}}
                {{/rollBetween() attack fumble critical}}

                {{#rollWasCrit() attack}}
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{critdamage}} ({{damagetype}})</div>
                  {{#damage2}}
                    {{#critdamage2}}
                      <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{critdamage2}} ({{damagetype2}})</div>
                    {{/critdamage2}}
                  {{/damage2}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Roll Critical Hit Effect</div>
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Notch Target Armor</div>
                {{/rollWasCrit() attack}}

                {{#rollWasFumble() attack}}
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Roll Fumble Effect</div>
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Notch Weapon</div>
                {{/rollWasFumble() attack}}
        </div>
        {{/damage}}

        {{#roll}}
        <div class="sheet-row">
                <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">{{rollname}}</div>
                <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{roll}}{{#rolladv}} | {{rolladv}}{{/rolladv}}</div>
        </div>
        {{/roll}}

        <div class="sheet-row">
               {{#noadvroll}}
               <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{roll1}}</div>
               {{/noadvroll}}
        </div>

        <!--
        {{#math}}
        <div class="sheet-row">
                 <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Math</div>
                 <div class="sheet-col-7-12 sheet-padr sheet-rt-value sheet-no-roll-highlight">{{math}}</div>
        </div>
        {{/math}}
        -->

        {{#special}}
        <div class="sheet-row">
                 <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Special</div>
                 <div class="sheet-col-7-12 sheet-padr sheet-rt-value sheet-no-roll-highlight">{{special}}</div>
        </div>
        {{/special}}

        <div class="sheet-row">{{description}}</div>
        <!--
        <div class="sheet-col-1 sheet-padl sheet-padr sheet-rt-key-wide">{{freetextname}}</div>
        <div class="sheet-col-1 sheet-padl sheet-padr sheet-rt-value">{{freetext}}</div>
        -->

    </div>
  </div>
</rolltemplate>

<!-- Sheet Workers -->
<script type="text/worker">

  // container update
  on(`change:container_1_type change:container_2_type change:container_3_type`, () => {
    getAttrs(['container_1_type', 'container_2_type', 'container_3_type'], v=> {
       setAttrs( {cont1_show_slots: v.container_1_type,
                  cont2_show_slots: v.container_2_type,
                  cont3_show_slots: v.container_3_type});
    });
  });

  // Ability modifiers
  const raceMods = { Human: "", Dwarf: "constitution", Halfling: "dexterity", Elven : "charisma:intelligence:dexterity" };
  const abilityNames = ['charisma', 'constitution', 'dexterity', 'intelligence', 'strength', 'wisdom'];
  const bonusNames = [ 'strength_bonus', 'dexterity_bonus', 'constitution_bonus', 'intelligence_bonus', 'wisdom_bonus', 'charisma_bonus' ];
  const armor_dex_mod_penalty = {'none': 0, 'padded': 0, 'leather': 0, 'studded_leather': 0, 'scale': 0, 'chain': 0, 'chainshirt':0, 'half_plate': -1, 'plate': -2};
  abilityNames.forEach( ability => {
    on(`sheet:opened change:class change:class2 change:race change:level change:level2 change:armor change:${ability} change:${ability}_bonus`, () => {
          getAttrs([ability, ...bonusNames, 'armor', 'class', 'class2', 'race', 'level', 'level2', 'skill_points'], v => {
              const setting = {};

              const ability_bonus_name = `${ability}_bonus`;
              const ability_bonus = parseInt(v[ability_bonus_name]) || 0;
              const score = (parseInt(v[ability]) || 10) + ability_bonus;
              const statrank = [1,3,5,8,11,14,17,19,21,23,25,27,29,31].findIndex(rank => score <= rank);

              const level = parseInt(v.level) || 0;
              const level2 = parseInt(v.level2) || 0;
              const race = v.race.trim();
              const c_class = v.class.trim();
              const c_class2 = v.class2.trim();

              const ability_mod = `${ability}_mod`;
              setting[ability_mod] = (statrank === -1 ? 4 : statrank -4) + ((raceMods[race] || '').indexOf(ability) !== -1 ? 1 : 0);

              // HACK! penalize elven characters for wisdom and constitution
              if (race === 'Elven') {
                if (ability_mod === 'wisdom_mod' || ability_mod === 'constitution_mod') {
                  setting[ability_mod] = parseInt(setting[ability_mod])-1;
                }
              }
              // nuther set of hacks, Armor and Halfings get +2 Dex mod
              if (ability_mod === 'dexterity_mod') {
                 if (race === 'Halfling') {
                  setting[ability_mod] = parseInt(setting[ability_mod])+1;
                }
                // modify for armor we are wearing
                setting[ability_mod] = parseInt(setting[ability_mod])+armor_dex_mod_penalty[v.armor];
              }

              // intelligence based stuff
              if (ability === 'intelligence') {
                const base_int_mod = setting[ability_mod];
                var skill_int_mod = base_int_mod;
                if (skill_int_mod < -1) {
                  skill_int_mod = -1; // preserve at least 1 skill point / level
                }

                // skill points
                // starting race skills; elves dont get any skill points to start
                // BUT everyone gets 1 skill point for their background profession, so 1/6 for Elves/Non-Elves
                var base_race_start_skills = (race === 'Elven' ? 1 : 6) + skill_int_mod;
                if (base_race_start_skills < 0) {
                  // prevent negative totals
                  base_race_start_skills = 0;
                }

                // class skills
                const base_start_class_skills = level > 0 ? (c_class === 'specialist' ?  10 : 5) : 0; // set by the first class chosen at 1st level

                // class skills for levels beyond 1st
                const class1_skill_points = level > 1 ? ((skill_int_mod + 2) * (level - 1)) : 0;
                const class2_skill_points = (skill_int_mod + 2) * level2;

                var class_skill_points = class1_skill_points + class2_skill_points;
                // always give 1 skill point per level
                //if (class_skill_points < (level + level2)) {
                //    class_skill_points = level+level2;
                //}

                setting["skill_points"] = base_start_class_skills + base_race_start_skills + class_skill_points;

                // arcane spellcasting
                if (c_class === 'wizard') {
                  setting["spellcasting_mod"] = base_int_mod + 1 + parseInt(level/2);
                  setting["spellcasting_dc"] = base_int_mod + 10 + parseInt(level/2);
                }
                else
                if (c_class2 === 'wizard') {
                  setting["spellcasting_mod"] = base_int_mod + 1 + parseInt(level2/2);
                  setting["spellcasting_dc"] = base_int_mod + 10 + parseInt(level2/2);
                }
                else
                if (race === 'Elven') {
                  setting["spellcasting_mod"] = base_int_mod + 1;
                  setting["spellcasting_dc"] = base_int_mod + 11;
                }

              }

              if (ability === 'wisdom') {

                const base_wis_mod = setting[ability_mod];

                // divine spell casting
                if (c_class === 'cleric') {
                  setting["spellcasting_mod"] = base_wis_mod + 1 + parseInt(level/2);
                  setting["spellcasting_dc"] = base_wis_mod + 10 + parseInt(level/2);
                }
                else
                if (c_class2 === 'cleric') {
                  setting["spellcasting_mod"] = base_wis_mod + 1 + parseInt(level2/2);
                  setting["spellcasting_dc"] = base_wis_mod + 10 + parseInt(level2/2);
                }

              }

              // do dex-based stuff
              if (ability === 'dexterity') {
                const base_dex_mod = setting[ability_mod];
                const base_dex_f = parseFloat(v[ability]) * 0.01;

                setting["initiative"] = base_dex_mod;
                setting["init_extra"] = base_dex_f;
                setting["ranged_base_ab"] = base_dex_mod;

                var ranged_ab = base_dex_mod + 1 + (c_class === 'fighter' ? parseInt((level+1)/2) : (c_class2 === 'fighter' ? parseInt((level2+1)/2) : 0));
                // halflings get +2 ranged AB
                setting["ranged_ab"] = ranged_ab + (race === 'Halfling' ? 1 : 0);

                // for ready inventory slots
                setting["dex-show-slots"] = score;
              }

              if (ability === 'strength') {
                const base_str_mod = setting[ability_mod]
                setting["melee_base_ab"] = base_str_mod;
                setting["melee_ab"] = base_str_mod + 1 + (c_class === 'fighter' ? parseInt((level+1)/2) : (c_class2 === 'fighter' ? parseInt((level2+1)/2) : 0));
                setting["encumbrance_mod"] = base_str_mod + (race === 'Dwarf' ? 1 : 0);
              }

              setAttrs(setting);
            });
        });
      });

  // determine which attribute contributes the bonus for Athletics skill
  // also set unarmed AB here too
  on(`change:strength_mod change:dexterity_mod change:strength_bonus change:dexterity_bonus change:melee_ab change:ranged_ab`, () => {
    getAttrs(['strength_mod', 'dexterity_mod', 'athletics_skill_mod', 'melee_ab', 'melee_base_ab', 'ranged_ab', 'ranged_base_ab', 'unarmed_ab', 'unarmed_base_ab'], v => {
      const str_mod = parseInt(v.strength_mod);
      const dex_mod = parseInt(v.dexterity_mod);
      const melee_ab = parseInt(v.melee_ab);
      const melee_base_ab = parseInt(v.melee_base_ab);
      const ranged_ab = parseInt(v.ranged_ab);
      const ranged_base_ab = parseInt(v.ranged_base_ab);

      settings = {}
      if (str_mod > dex_mod) {
        settings["athletics_skill_mod"] = str_mod;
        settings["unarmed_ab"] = melee_ab;
        settings["unarmed_base_ab"] = melee_base_ab;
      } else {
        settings["athletics_skill_mod"] = dex_mod;
        settings["unarmed_ab"] = ranged_ab;
        settings["unarmed_base_ab"] = ranged_base_ab;
      }

      setAttrs(settings);
    });
  });

  // update ability modifiers
  const abilityCheck = { strength_mod: "fortitude", dexterity_mod: "dodge", constitution_mod: "health", intelligence_mod: "perception", wisdom_mod: "willpower", charisma_mod: "ego" };
  ['charisma_mod', 'constitution_mod', 'dexterity_mod', 'intelligence_mod', 'strength_mod', 'wisdom_mod', 'charisma_mod'].forEach(ability_mod => {
    on(`sheet:opened change:level change:level2 change:${ability_mod}`, () => {
      getAttrs([ability_mod, 'level', 'level2'], v => {
        const setting = {};
        const score = parseInt(v[ability_mod]) || 0;
        const level = parseInt(v.level) || 1;
        const level2 = parseInt(v.level2) || 0;

        const checkName = abilityCheck[ability_mod];
        setting[checkName] = score + parseInt((level+level2)/2);

        // set max languages here as well
        if (ability_mod === 'intelligence_mod') {
          setting['max_languages_allowed'] = 'Max ' + (score + 1 > 0 ? score + 1: 1) + ' languages allowed.';
        }

        setAttrs(setting);
      });
    });
  });

  // Calculate armor class
  const armor_ac_value = {'none': 0, 'padded': 1, 'leather': 2, 'studded_leather': 3, 'chainshirt':4, 'scale': 5, 'chain': 6, 'half_plate': 7, 'plate': 8};
  const max_armor_ac_dex_bonus = {'none': 10, 'padded': 2, 'leather': 3, 'studded_leather': 2, 'scale': 1, 'chain': 1, 'chainshirt':2, 'half_plate': 0, 'plate': 0};
  const shield_ac_value = {'none': 0, 'small_shield': 1, 'large_shield': 2, 'tower_shield': 3};
  on(`sheet:opened change:armor change:shield change:dexterity_mod change:armor_bonus change:armor_notches change:shield_bonus change:shield_notches`, () => {
    getAttrs(['armor', 'shield', 'armor_bonus', 'armor_notches', 'shield_bonus', 'shield_notches', 'dexterity_mod'], v => {
      var armor_class = 10;
      var dex_bonus = parseInt(v.dexterity_mod);
      var max_dex_bonus = parseInt(max_armor_ac_dex_bonus[v.armor]);
      if (dex_bonus > max_dex_bonus) {
        armor_class += max_dex_bonus;
      } else {
        armor_class += dex_bonus;
      }
      armor_class += parseInt(armor_ac_value[v.armor]) + parseInt(shield_ac_value[v.shield]) - parseInt(v.armor_notches) - parseInt(v.shield_notches)
      armor_class += parseInt(v.armor_bonus) + parseInt(v.shield_bonus);
      setAttrs({ac : armor_class});
    });
  });

  // Spell Slots
  const arcane_spell_slots1 = [0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8];
  const arcane_spell_slots2 = [0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7];
  const arcane_spell_slots3 = [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6];
  const arcane_spell_slots4 = [0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6];
  const arcane_spell_slots5 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5];
  const arcane_spell_slots6 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4];
  const arcane_spell_slots7 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4];
  const arcane_spell_slots8 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3];
  const arcane_spell_slots9 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2];

  const divine_spell_slots1 = [0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 8];
  const divine_spell_slots2 = [0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 7];
  const divine_spell_slots3 = [0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 7];
  const divine_spell_slots4 = [0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 6];
  const divine_spell_slots5 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5];
  const divine_spell_slots6 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 5];
  const divine_spell_slots7 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4];

  function get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, level2) {

    if (is_wizard)
    {
      console.log("get_spellslots called for wizard");
      const l = (c_class === 'wizard' ? level : level2);
      return [arcane_spell_slots1[l], arcane_spell_slots2[l], arcane_spell_slots3[l],
              arcane_spell_slots4[l], arcane_spell_slots5[l], arcane_spell_slots6[l],
              arcane_spell_slots7[l], arcane_spell_slots8[l], arcane_spell_slots9[l]
             ];
    }
    else
    if (is_elf)
    {
      return [ 1 + parseInt((level + level2)/4), 0, 0, 0, 0, 0, 0, 0, 0 ];
    }
    else
    if (is_cleric)
    {
      const l = (c_class === 'cleric' ? level : level2);
      return [divine_spell_slots1[l], divine_spell_slots2[l], divine_spell_slots3[l],
              divine_spell_slots4[l], divine_spell_slots5[l], divine_spell_slots6[l],
              divine_spell_slots7[l], 0, 0
             ];
    }

    console.log("get_spellslots called - NO class");
    // Not a spell caster, reset spell slots
    return [0,0,0,0,0,0,0,0,0];

;
  }

  // General Class/Level stuff
  on(`sheet:opened change:class change:class2 change:level change:level2 change:race change:xp`, () => {
    getAttrs(['class', 'class2', 'level', 'level2', 'alignment', 'race', 'xp'], v => {
      const c_align = v.alignment.trim();
      const c_class = v.class.trim();
      const c_class2 = v.class2.trim();
      const c_race = v.race.trim();
      const level = parseInt(v.level) || 0;
      const level2 = parseInt(v.level2) || 0;
      const xp = parseInt(v.xp) || 0;

      const is_cleric = (c_class === 'cleric' || c_class2 === 'cleric');
      const is_fighter = (c_class === 'fighter' || c_class2 === 'fighter');
      const is_specialist = (c_class === 'specialist' || c_class2 === 'specialist');
      const is_wizard = (c_class === 'wizard' || c_class2 === 'wizard');

      const is_elf = (c_race === 'Elven');

      const setting = {};

      // calculate next level xp
      const next_level_xp = level < 1 ? 100 : level > 8 ? 128000 * (level + level2 - 7) : 1000 * (2**(level + level2 - 1));
      setting['next_level_xp'] = next_level_xp;
      setting['next_level_up'] = next_level_xp <= xp ? 0 : 1;

      // hitdice - TODO : not quite right
      // setting['hit_dice'] = level + level2;
      setting['hit_dice_max'] = level + level2;

      // deal with sneak attack stuff
      setting['sneak_attack_enabled'] = (c_class === 'specialist' ? 1 : (c_class2 === 'specialist' ? 1: 0));
      setting['sneak_attack_checkbox'] = (c_class === 'specialist' ? 1 : (c_class2 === 'specialist' ? 1: 0));
      setting['sneak_attack_dice'] = (c_class === 'specialist' ?  1 + parseInt((level-1)/2): (c_class2 === 'specialist' ?  1 + parseInt((level2-1)/2): 0));

      spellslots = get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, level2);
      setting["lvl1_slots_total"] = spellslots[0];
      setting["lvl2_slots_total"] = spellslots[1];
      setting["lvl3_slots_total"] = spellslots[2];
      setting["lvl4_slots_total"] = spellslots[3];
      setting["lvl5_slots_total"] = spellslots[4];
      setting["lvl6_slots_total"] = spellslots[5];
      setting["lvl7_slots_total"] = spellslots[6];
      setting["lvl8_slots_total"] = spellslots[7];
      setting["lvl9_slots_total"] = spellslots[8];

      if (is_wizard)
      {
        const wizard_level = (c_class === 'wizard' ? level : level2);
        setting["spellcasting_type"] = "Arcane";
        setting["alignment"] = "Chaotic";
      }
      else
      if (is_elf)
      {
        setting["spellcasting_type"] = "Arcane";
        setting["alignment"] = "Chaotic";
      }
      else
      if (is_cleric)
      {
        const cleric_level = (c_class === 'cleric' ? level : level2);
        setting["spellcasting_type"] = "Divine";
        setting["alignment"] = "Lawful";
      }
      else
      {
        setting["spellcasting_type"] = "None";
        setting["spellcasting_mod"] = 0;
        setting["spellcasting_dc"] = 0;
        setting["alignment"] = c_align;
      }

      setting["has_cleric_powers"] = is_cleric;
      setting["can_cast_magic"] = is_wizard || is_cleric || is_elf;

      // Check that we have not gimped low level slots
      // for elf multiclassed w/ wizard
      if (is_elf && is_wizard) {
        const wizard_level = (c_class === 'wizard' ? level : level2);
        var elf_slots1 = 1 + parseInt((level + level2)/4);
        if (arcane_spell_slots1[wizard_level] < elf_slots1) {
           setting["lvl1_slots_total"] = elf_slots1;
        }
        else {
           setting["lvl1_slots_total"] = arcane_spell_slots1[wizard_level];
        }
      }

      setting['max_cmbt_styles_and_opts_allowed'] = 2;

      setting['berserk_attack_mod'] = 0;
      setting['charge_attack'] = is_fighter ? 1 : 0;
      setting['press_attack'] = is_fighter ? 1 : 0;
      setting['defensive_attack'] = is_fighter ? 1 : 0;
      setting['parry_attack'] = is_fighter ? 1 : 0;

      if (is_fighter) {
        const fighter_level = (c_class === 'fighter' ? level : level2);
        setting['berserk_attack_mod'] = 3 + parseInt(fighter_level/4)
        setting['max_cmbt_styles_and_opts_allowed'] = 6 + parseInt(fighter_level/2);
      }

      setAttrs(setting);
    });
  });

  function set_npc_spellslots (c_class) {

    console.log("Set npcspellslots called");

    getAttrs(['level', 'race' ], v => {

      //const c_class = v.class.trim();
      const c_race = v.race.trim();
      const level = parseInt(v.level) || 0;

      const is_cleric = (c_class === 'cleric');
      const is_wizard = (c_class === 'wizard');
      const is_elf = (c_race === 'Elven');

      var spellslots = get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, 0);

      const setting = {};
      setting["lvl1_slots_total"] = spellslots[0];
      setting["lvl2_slots_total"] = spellslots[1];
      setting["lvl3_slots_total"] = spellslots[2];
      setting["lvl4_slots_total"] = spellslots[3];
      setting["lvl5_slots_total"] = spellslots[4];
      setting["lvl6_slots_total"] = spellslots[5];
      setting["lvl7_slots_total"] = spellslots[6];
      setting["lvl8_slots_total"] = spellslots[7];
      setting["lvl9_slots_total"] = spellslots[8];

      setAttrs(setting);

    });

  }

  function npc_spellrest () {
    console.log("npc spellrest called");

    getAttrs(['class', 'lvl1_slots_total', 'lvl2_slots_total', 'lvl3_slots_total', 'lvl4_slots_total', 'lvl5_slots_total',
              'lvl6_slots_total', 'lvl7_slots_total', 'lvl8_slots_total', 'lvl9_slots_total' ], v => {

      //failsafe
      const c_class = v.class.trim();
      set_npc_spellslots(c_class);

      settings={};
      settings["lvl1_slots_expended"] = parseInt(v.lvl1_slots_total) || 0;
      settings["lvl2_slots_expended"] = parseInt(v.lvl2_slots_total) || 0;
      settings["lvl3_slots_expended"] = parseInt(v.lvl3_slots_total) || 0;
      settings["lvl4_slots_expended"] = parseInt(v.lvl4_slots_total) || 0;
      settings["lvl5_slots_expended"] = parseInt(v.lvl5_slots_total) || 0;
      settings["lvl6_slots_expended"] = parseInt(v.lvl6_slots_total) || 0;
      settings["lvl7_slots_expended"] = parseInt(v.lvl7_slots_total) || 0;
      settings["lvl8_slots_expended"] = parseInt(v.lvl8_slots_total) || 0;
      settings["lvl9_slots_expended"] = parseInt(v.lvl9_slots_total) || 0;

      setAttrs(settings);
    });
  }

  on("clicked:spellrest", () => { npc_spellrest(); });

  // Checks for Skills, are they overspent? Have they underspent? Exceeded max bonus for a skill?
  const coreSkills = ['arcana_skill', 'architect_skill', 'armory_skill', 'athletics_skill', 'bushcraft_skill',
                      'languages_skill', 'open_door_skill', 'search_skill', 'sleight_skill', 'sneak_attack_skill',
                      'stealth_skill', 'social_skill', 'theology_skill', 'tinker_skill'];

  coreSkills.forEach(core_skill => {
    on(`change:${core_skill} change:level change:level2 change:intelligence_mod change:repeating_skills remove:repeating_skills`, () => {
      // find total skill points spent
       var skill_point_total = 0;
       var max_skill_value = 0;

       getSectionIDs('repeating_skills', function (ids) {

         // gather up other_skills from repeating_skills
         const other_skills = [];
         ids.forEach(id => {
           other_skills.push('repeating_skills_' + id + '_skillvalue');
         });

         // find skills value total
         getAttrs([...coreSkills, ...other_skills], v => {
            skill_point_total = Object.values(v).reduce((m, w) => (m + (parseInt(w) || 0)), 0);
            max_skill_value = Object.values(v).reduce((m, w) => (m > (parseInt(w) || 0) ? m : (parseInt(w) || 0)), 0);
            // cache values
            setAttrs({skill_points_used: skill_point_total});
         });

         // Now lets check on our spending of skill points
         // did we 1) overspend the total allowed? 2) exceed the maxium value for a skill?
         getAttrs(['skill_points', 'level', 'level2', 'intelligence_mod'], v => {
           var skill_points_available = parseInt(v['skill_points']);
           var level = parseInt(v['level']) || 0;
           var level2 = parseInt(v['level2']) || 0;
           var intelligence_mod = parseInt(v['intelligence_mod']) || 0;

           // maximum skill value is betweeen 2 and 10 + int mod as modified by total level
           // check for max value being exceeded
           var max_value_allowed = 2 + level + level2 + intelligence_mod;
           if (max_value_allowed < 2) { max_value_allowed = 2; }
           if (max_value_allowed > 10 + intelligence_mod) { max_value_allowed = 10 + intelligence_mod; }
           const max_value_exceeded = max_skill_value > max_value_allowed ? 0 : 1;

           // check if we exceeded the sum of spending
           const skill_underspent = skill_point_total < skill_points_available ? 0 : 1;
           const skill_overspent = skill_point_total > skill_points_available ? 0 : 1;

           // update
           setAttrs({ skill_points_underspent: skill_underspent, skill_points_overspent: skill_overspent,
             max_skill_value_allowed: max_value_allowed, max_skill_value_exceeded: max_value_exceeded});
         });

       });

    });
  });

  // Keep spells up to date
  on(`change:repeating_spells change:arcana_skill change:arcana_bonus change:class change:class2 change:spell_dice` , function () {
    getSectionIDs('repeating_spells', function (ids) {
      const fieldnames = [];
      ids.forEach(id => {
        fieldnames.push('repeating_spells_' + id + '_spelllevel');
        fieldnames.push('repeating_spells_' + id + '_spell_dice');
      });
      getAttrs([...fieldnames, 'class', 'class2', 'arcana_skill', 'arcana_bonus', 'spellcasting_mod'], function (values) {
        const c_class = values.class.trim();
        const c_class2 = values.class2.trim();
        const arcana_skill = parseInt(values.arcana_skill) || 0;
        const arcana_bonus = parseInt(values.arcana_bonus) || 0;
        const spellcasting_mod = parseInt(values.spellcasting_mod) || 0;

        const arcana_adj = parseInt((arcana_skill + arcana_bonus) / 4);
        const is_wizard = (c_class === 'wizard' || c_class2 === 'wizard') ? 1 : 0;

        settings = {};
        ids.forEach(id => {

          const spelllevel = parseInt(values['repeating_spells_' + id + '_spelllevel']) || 0;
          const spell_dice = values['repeating_spells_' + id + '_spell_dice'];
          const is_dice_enabled = (spell_dice === "") ? 0 : 1;
          var adhoc_dc = 10 + spelllevel - spellcasting_mod - arcana_adj;

          if (adhoc_dc < 2) { adhoc_dc = 2; } // never lower than 2

          settings['repeating_spells_' + id + '_is_adhoc_dice_spell'] = is_wizard && is_dice_enabled;
          settings['repeating_spells_' + id + '_is_adhoc_no_dice_spell'] = is_wizard && !is_dice_enabled;
          settings['repeating_spells_' + id + '_adhoc_dc'] = adhoc_dc;
          settings['repeating_spells_' + id + '_is_dice_spell'] = is_dice_enabled;

        });
        setAttrs(settings);
      });
    });
  });

  // npc actions
  on(`change:repeating_npcactions remove:repeating_npcactions` , function () {
    console.log("NPC Actions update called");
    getSectionIDs('repeating_npcactions', function (ids) {
      const fieldnames = [];
      ids.forEach(id => {
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_desc1');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_desc2');
        fieldnames.push('repeating_npcactions_' + id + '_action_is_an_attack');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_type');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_tohit');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_range');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damage');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damage2');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damagetype');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damagetype2');
      });
      getAttrs([...fieldnames], function (v) {
        settings = {};
        ids.forEach(id => {
          const is_attack = parseInt(v['repeating_npcactions_' + id + '_action_is_an_attack']) || 0;

          // set whether its an attack action or not
          settings['repeating_npcactions_'+id+'_action_show_attack'] = is_attack;

          if (is_attack == 1) {
             const to_hit = v['repeating_npcactions_' + id + '_action_attack_tohit'];
             const range = v['repeating_npcactions_' + id + '_action_attack_range'];
             const attack_type = v['repeating_npcactions_' + id + '_action_attack_type'];
             const damage = v['repeating_npcactions_' + id + '_action_attack_damage'];
             const damagetype = v['repeating_npcactions_' + id + '_action_attack_damagetype'];

             settings['repeating_npcactions_'+id+'_action_attack_desc1'] = attack_type + " " + range + ".";
             settings['repeating_npcactions_'+id+'_action_attack_desc2'] = "Hit: +" + to_hit + ' (' + damage + ') ' + damagetype + '.';
          }


        });
        setAttrs(settings);
      });
    });
  });

  // Keep attacks up to date
  const combatOpts = ['charge_attack', 'press_attack', 'defensive_attack', 'berserk_attack', 'cleave_attack', 'disarm_attack', 'feint_attack',
                      'great_cleave_attack', 'lightning_attack', 'rapid_strike_attack1', 'rapid_strike_attack2', 'rapid_shot_attack1', 'rapid_shot_attack2',
                      'shield_bash_attack', 'strong_attack', 'stun_attack', 'two_attack_attack', 'two_attack_master_attack' ];

  combatOpts.forEach(combat_opt => {
    on(`change:${combat_opt} change:sneak_attack_dice change:repeating_attacks change:c_class change:c_class2 change:level change:level2` , function () {
      getSectionIDs('repeating_attacks', function (ids) {
        const fieldnames = [];
        ids.forEach(id => {
              fieldnames.push('repeating_attacks_' + id + '_attack_sneak_attack_dam');
              fieldnames.push('repeating_attacks_' + id + '_attack_dam_die');
              fieldnames.push('repeating_attacks_' + id + '_attack_dam_type');
              fieldnames.push('repeating_attacks_' + id + '_attack_attk_type');
              fieldnames.push('repeating_attacks_' + id + '_attack_bonus');
              fieldnames.push('repeating_attacks_' + id + '_attack_notches');
              fieldnames.push('repeating_attacks_' + id + '_has_attack_proficiency');
          });

          getAttrs([...fieldnames, ...combatOpts, 'melee_ab', 'melee_base_ab', 'unarmed_ab', 'unarmed_base_ab', 'ranged_ab', 'ranged_base_ab', 'spellcasting_mod', 'sneak_attack_dice'], function (values) {
              var output = {};

              const melee_ab = parseInt(values.melee_ab) || 0;
              const melee_base_ab = parseInt(values.melee_base_ab) || 0;
              const ranged_ab = parseInt(values.ranged_ab) || 0;
              const ranged_base_ab = parseInt(values.ranged_base_ab) || 0;
              const unarmed_ab = parseInt(values.unarmed_ab) || 0;
              const unarmed_base_ab = parseInt(values.unarmed_base_ab) || 0;

              const spellcasting_mod = parseInt(values.spellcasting_mod) || 0;

              const sneak_dice = parseInt(values.sneak_attack_dice) || 0;
              const berserk_attack = parseInt(values.berserk_attack) || 0;
              const cleave_attack = parseInt(values.cleave_attack) || 0;
              const defensive_attack = parseInt(values.defensive_attack) || 0;
              const disarm_attack = parseInt(values.disarm_attack) || 0;
              const feint_attack = parseInt(values.feint_attack) || 0;
              const great_cleave_attack = parseInt(values.great_cleave_attack) || 0;
              const lightning_attack = parseInt(values.lightning_attack) || 0;

              const charge_attack = parseInt(values.charge_attack) || 0;
              const press_attack = parseInt(values.press_attack) || 0;
              const rapid_strike_attack1 = parseInt(values.rapid_strike_attack1) || 0;
              const rapid_strike_attack2 = parseInt(values.rapid_strike_attack2) || 0;
              const rapid_shot_attack1 = parseInt(values.rapid_shot_attack1) || 0;
              const rapid_shot_attack2 = parseInt(values.rapid_shot_attack2) || 0;
              const shield_bash_attack = parseInt(values.shield_bash_attack) || 0;
              const strong_attack = parseInt(values.strong_attack) || 0;
              const stun_attack = parseInt(values.stun_attack) || 0;
              const two_attack_attack = parseInt(values.two_attack_attack) || 0;
              const two_attack_master_attack = parseInt(values.two_attack_master_attack) || 0;

              // record state so we know if we should render buttons for these special combat options
              // or not
              output['berserk_attack_enabled'] = berserk_attack;
              output['charge_attack_enabled'] = charge_attack;
              output['cleave_attack_enabled'] = cleave_attack && !great_cleave_attack;
              output['cleave_attack_enabled2'] = cleave_attack;
              output['defense_attack_enabled'] = defensive_attack;
              output['disarm_attack_enabled'] = disarm_attack;
              output['great_cleave_attack_enabled'] = great_cleave_attack && cleave_attack;
              output['feint_attack_enabled'] = feint_attack;
              output['lightning_attack_enabled'] = lightning_attack;
              output['press_attack_enabled'] = press_attack;
              output['strong_attack_enabled'] = strong_attack;
              output['stun_attack_enabled'] = stun_attack;
              output['two_attack_attack_enabled'] = two_attack_attack;
              output['two_attack_master_attack_enabled'] = two_attack_master_attack;


              // starts w/ 2 because everyone gets standard attack and some kind of parry_attack
              output['cmbt_opts_used'] = 2 + press_attack + charge_attack + defensive_attack
                                   + berserk_attack + cleave_attack + great_cleave_attack + disarm_attack + feint_attack + lightning_attack
                                   + rapid_shot_attack1 + rapid_shot_attack2 + rapid_strike_attack1 + rapid_strike_attack2
                                   + shield_bash_attack + strong_attack + stun_attack + two_attack_attack + two_attack_master_attack;

              ids.forEach(id => {

                  const attack_dam_die = values['repeating_attacks_' + id + '_attack_dam_die'];
                  const attack_dam_type = values['repeating_attacks_' + id + '_attack_dam_type'];
                  const attack_notches = parseInt(values['repeating_attacks_' + id + '_attack_notches']);
                  const attack_attk_type = values['repeating_attacks_' + id + '_attack_attk_type'];
                  const attack_bonus = parseInt(values['repeating_attacks_' + id + '_attack_bonus']);
                  const attack_proficiency = parseInt(values['repeating_attacks_' + id + '_has_attack_proficiency']) || 0;

                  const is_ranged = (attack_attk_type === 'ranged' || 0);
                  const is_spell = (attack_attk_type === 'spell' || 0);
                  const is_proficient = attack_proficiency > 0 ? 1 : 0;

                  // weapn attack bonus depends on attack_proficiency and type of attack
                  // TODO: attack_proficiency
                  var attack_attk_type_ab = melee_ab;
                  var attack_attk_type_base_ab = melee_base_ab;

                  if (attack_attk_type === 'unarmed') {
                    attack_attk_type_ab = unarmed_ab;
                    attack_attk_type_base_ab = unarmed_base_ab;
                  }

                  if (is_ranged) {
                    attack_attk_type_ab = ranged_ab;
                    attack_attk_type_base_ab = ranged_base_ab;
                  }

                  if (is_spell) {
                    attack_attk_type_ab = spellcasting_mod;
                    attack_attk_type_base_ab = 0;
                  }

                  // based on proficiency we get AB for attack
                  var attack_attack_bonus = attack_bonus - attack_notches;
                  if (is_proficient) {
                    attack_attack_bonus += attack_attk_type_ab;
                  } else {
                    attack_attack_bonus += attack_attk_type_base_ab;
                  }

                  const num_dam_die = parseInt(attack_dam_die.substring(0,1));
                  const attack_dam_die_type = parseInt(attack_dam_die.substring(2)) - (2 * (attack_notches));

                  // safety for low die attacks with lots of notches
                  if (attack_dam_die_type < 0) {
                    attack_dam_die_type = 0;
                  }

                  // final calculations
                  const sneak_dam = (sneak_dice * num_dam_die ) + 'd' + attack_dam_die_type;
                  const attack_dam = num_dam_die + 'd' + attack_dam_die_type;

                  // apply new properties to attack
                  output['repeating_attacks_' + id + '_attack_berserk_attack_enabled'] = berserk_attack;
                  output['repeating_attacks_' + id + '_attack_charge_attack_enabled'] = charge_attack;
                  output['repeating_attacks_' + id + '_attack_cleave_attack_enabled'] = cleave_attack && !great_cleave_attack;
                  output['repeating_attacks_' + id + '_attack_defense_attack_enabled'] = defensive_attack;
                  output['repeating_attacks_' + id + '_attack_disarm_attack_enabled'] = disarm_attack;
                  output['repeating_attacks_' + id + '_attack_feint_attack_enabled'] = feint_attack;
                  output['repeating_attacks_' + id + '_attack_great_cleave_attack_enabled'] = great_cleave_attack && cleave_attack;
                  output['repeating_attacks_' + id + '_attack_lightning_attack_enabled'] = lightning_attack;
                  output['repeating_attacks_' + id + '_attack_press_attack_enabled'] = press_attack;
                  output['repeating_attacks_' + id + '_attack_strong_attack_enabled'] = strong_attack;
                  output['repeating_attacks_' + id + '_attack_stun_attack_enabled'] = stun_attack;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_dam'] = sneak_dam;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_enabled'] = sneak_dice > 0 ? 1 : 0;

                  output['repeating_attacks_' + id + '_attack_attack_bonus'] = attack_attack_bonus;
                  output['repeating_attacks_' + id + '_attack_dam'] = attack_dam;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_enabled'] = sneak_dice > 0 ? 1 : 0;


                  // even though we have the attack option, we still may not be able to use it because of the
                  // type of attack we have in hand and/or we lack proficiency

                  output['repeating_attacks_' + id + '_attack_defense_attack_button_show'] = is_proficient && is_spell == 0;
                  output['repeating_attacks_' + id + '_attack_disarm_attack_button_show'] = is_proficient && is_spell == 0;
                  output['repeating_attacks_' + id + '_attack_feint_attack_button_show'] = is_proficient; // allow spells to be aimed if held
                  output['repeating_attacks_' + id + '_attack_lightning_attack_button_show'] = is_proficient && is_spell == 0;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_button_show'] = is_proficient && is_spell == 0;
                  output['repeating_attacks_' + id + '_attack_strong_attack_button_show'] = is_proficient && is_spell == 0;

                  // Only slashing / force attacks may 'cleave'
                  output['repeating_attacks_' + id + '_attack_cleave_attack_button_show'] = is_proficient && is_spell == 0
                         && (attack_dam_type === 'Slashing' || attack_dam_type === 'Force') ? 1 : 0;
                  output['repeating_attacks_' + id + '_attack_great_cleave_attack_button_show'] = is_proficient && is_spell == 0
                         && (attack_dam_type === 'Slashing' || attack_dam_type === 'Force') ? 1 : 0;

                  // Only bashing / force 'attacks' may 'stun'
                  output['repeating_attacks_' + id + '_attack_stun_attack_button_show'] = is_proficient && is_spell == 0
                         && (attack_dam_type === 'Bludgeoning' || attack_dam_type === 'Force') ? 1 : 0;

                  // NO charge, defense or press attacks with ranged attacks
                  output['repeating_attacks_' + id + '_attack_charge_attack_button_show'] = is_proficient && (is_ranged == 0) && is_spell == 0;
                  output['repeating_attacks_' + id + '_attack_press_attack_button_show'] = is_proficient && (is_ranged == 0) && is_spell == 0;

                  // NO ranged attack berserk attacks. Require too much concentration
                  // conversely, we CAN berserk w/o proficiency in a attack.
                  output['repeating_attacks_' + id + '_attack_berserk_attack_button_show'] = is_ranged || is_spell ? 0 : 1;

              });

              setAttrs(output);
            });
         });
      });
  });

  on(`change:cmbt_opts_used change:level change:level2 change:repeating_cmbt-styles remove:repeating_cmbt-styles` , function () {
    // do combat style entries now
    getSectionIDs('repeating_cmbt-styles', function (ids) {
       getAttrs(['cmbt_opts_used', 'max_cmbt_styles_and_opts_allowed'], function (v) {
         const max_cmbt_styles_and_opts_allowed = parseInt(v.max_cmbt_styles_and_opts_allowed) || 0;
         const cmbt_opts_used = parseInt(v.cmbt_opts_used) || 0;
         const cmbt_styles_used = ids.length; // count combat styles
         const cmbt_styles_and_opts_used = cmbt_opts_used + cmbt_styles_used;
         const max_cstyle_copts_value_exceeded = cmbt_styles_and_opts_used > max_cmbt_styles_and_opts_allowed ? 0 : 1;
         const cstyle_copts_value_underspent = cmbt_styles_and_opts_used < max_cmbt_styles_and_opts_allowed ? 0 : 1;

         setAttrs({max_cstyle_copts_value_exceeded: max_cstyle_copts_value_exceeded,
                   cstyle_copts_value_underspent: cstyle_copts_value_underspent,
                   cmbt_styles_used : cmbt_styles_used, cmbt_styles_and_opts_used: cmbt_styles_used + cmbt_opts_used});
      });
    });
  });



  // Update basic attack information we expect to have
  on(`change:c_class change:c_class2 change:repeating_attacks`, () => {

    // Basic HTH attacks for everyone
     add_attack_if_missing({name: "Punch", attk_type: "unarmed", dam_die: "1d2", dam_type: "Bludgeoning"});
     // add_attack_if_missing({name: "Kick", attk_type: "unarmed", dam_die: "1d4", dam_type: "Bludgeoning"});
     add_attack_if_missing({name: "Grapple", attk_type: "unarmed", dam_die: "0d0", dam_type: "Bludgeoning"});

     // TODO: attack proficiencies

  });

  function create_attack_obj (attack) {

    var newrowid = generateRowID();
    var settings = {};

    settings["repeating_attacks_" + newrowid + "_attack_name"] = attack["name"];
    settings["repeating_attacks_" + newrowid + "_attack_attk_type"] = attack["attk_type"];
    settings["repeating_attacks_" + newrowid + "_attack_dam_type"] = attack["dam_type"];
    settings["repeating_attacks_" + newrowid + "_attack_dam_die"] = attack["dam_die"];

    return settings;
  }

  function add_attack_if_missing (attack) {

    var name = attack["name"];

    // SO we cannot pass stuff out of getSectionIDs or getAttrs for whatever reason.
    // We need to cache our result in the chracter attribute (bah)
    getSectionIDs('repeating_attacks', function (ids) {
      // build list of attack name references
      const fieldnames = [];
      ids.forEach(id => {
         fieldnames.push('repeating_attacks_' + id + '_attack_name');
      });

      getAttrs([...fieldnames ], function (values) {
        // set default
        var has_attack = false;
        ids.forEach(id => {
            const attack_name = values['repeating_attacks_' + id + '_attack_name'];
            // NO need to add it if we already have it in the list
            if (attack_name.localeCompare(name) == 0) {
              has_attack = true;
            }
        });

        if (has_attack == false) {
          var settings = create_attack_obj(attack);
          setAttrs(settings);
        }
      });
    });
  }

  const armor_enc = { 'scale': 1, 'chain' : 1, 'half_plate': 1, 'plate': 2 }
  const shield_enc = { 'tower_shield' : 1 }

  // Check various inventory slots and the encumberance
  const islots9  = [ 'islot-9-1', 'islot-9-2', 'islot-9-3', 'islot-9-4', 'islot-9-5'];
  const islots13 = [ 'islot-13-1', 'islot-13-2', 'islot-13-3', 'islot-13-4', 'islot-13-5'];
  const islots16 = [ 'islot-16-1', 'islot-16-2', 'islot-16-3', 'islot-16-4', 'islot-16-5'];
  const islots18 = [ 'islot-18-1', 'islot-18-2', 'islot-18-3', 'islot-18-4', 'islot-18-5'];
  const readySlots = islots9.concat(islots13.concat(islots16.concat(islots18)));

  readySlots.forEach(ready_slot => {
    on(`change:${ready_slot} change:race change:encumbrance_mod change:armor change:shield change:container_1_type change:container_2_type change:container_3_type`, () => {
      getAttrs(readySlots.concat(['encumbrance_mod', 'race', 'armor', 'shield', 'container_1_type',
                                  'container_2_type', 'container_3_type']), v => {
        // ugh. seems like there should be a better way to do this
        const enc_points9 = islots9.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points13 = islots13.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points16 = islots16.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points18 = islots18.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;

        // Containers
        const container_1_enc_pts = v.container_1_type === 'large_pack' ? 1 : 0;
        const container_2_enc_pts = v.container_2_type === 'small_pack' ? 1 : 0;
        const container_3_enc_pts = v.container_3_type === 'sack' ? 1 : 0;

        // armor
        const armor_enc_pts = armor_enc[v.armor] || 0;
        const shield_enc_pts = shield_enc[v.shield] || 0;

        // calculate encumbrance points
        const enc_points = enc_points9 + enc_points13 + enc_points16 + enc_points18
                           + container_1_enc_pts + container_2_enc_pts + container_3_enc_pts
                           + armor_enc_pts + shield_enc_pts;

        // calculate encumbrance
        var enc = enc_points - parseInt(v['encumbrance_mod']);
        enc = enc > 0 ? enc : 0;

        // TODO: Calculate movement
        const enc_move_factor = enc > 1 ? enc : 0;
        const base_move_rate = (v.race === 'Dwarf' || v.race === 'Halfling') ? 35 : 40;
        var move_rate = base_move_rate;
        move_rate -= enc_move_factor > 0 ? (enc_move_factor -1) * 10 : 0;
        move_rate = move_rate > 0 ? move_rate : 0;

        const move_rate_light_enc = (move_rate < base_move_rate) &&  (move_rate >= 30 ) ? 0 : 1;
        const move_rate_med_enc = (move_rate < 30 ) &&  (move_rate >= 20 ) ? 0 : 1;
        const move_rate_heavy_enc = (move_rate < 20 ) &&  (move_rate >= 10 ) ? 0 : 1;
        const move_rate_stop = (move_rate < 10 ) ? 0 : 1;

        setAttrs( { encumbrance_points: enc_points, encumbrance: enc,
                    base_movement_rate: base_move_rate, movement_rate: move_rate,
                    move_rate_light_enc: move_rate_light_enc, move_rate_med_enc: move_rate_med_enc,
                    move_rate_heavy_enc: move_rate_heavy_enc, move_rate_stop: move_rate_stop
                  });
      });
    });
  });

  on(`sheet:opened change:npc change:name`, () => {
    getAttrs(['npc', 'level', 'hp', 'character_name'], v => {
       const is_pc = parseInt(v.npc) ? 0 : 1;

       settings = {};

       settings['npc_header_enabled'] = v.npc;
       settings['pc_header_enabled'] = is_pc;
       settings['pc_logo_enabled'] = is_pc;
       settings['pc_main_enabled'] = is_pc;

       if (v.npc) {
         console.debug("Is NPC reached: "+v.character_name)
         settings['npc_name'] = v.character_name;
         // settings['class'] = 'fighter';
         settings['npc_hpformula'] = v.level + 'd8';
       } else {
         settings['npc_hpformula'] = v.hp;
         settings['npc_name'] = '';
       }

       setAttrs(settings);
    });
  });

  on(`change:is_multiclass`, () => {
    getAttrs(['is_multiclass'], v=> {
      setAttrs( {multiclass_enabled: v.is_multiclass });
     });
  });

  on("change:drop_category", function(eventinfo) {
    console.debug("Drop category reached")
    if(eventinfo.newValue === "Monsters") {
      console.debug("Drop monster reached")
      handle_drop_monster(eventinfo.newValue);
    }
  });

  var handle_drop_monster = function(category, eventinfo) {
      var callbacks = [];
      var update = {};
      var id = generateRowID();

      drop_attrs = ["drop_name","drop_weight","drop_properties",
                    "drop_modifiers","drop_content","drop_itemtype",
                    "drop_damage","drop_damagetype","drop_damage2",
                    "drop_damagetype2","drop_range","drop_ac",
                    "drop_speed", "drop_str", "drop_dex", "drop_con",
                    "drop_int", "drop_wis", "drop_cha",
                    "drop_vulnerabilities", "drop_resistances",
                    "drop_immunities", "drop_condition_immunities",
                    "drop_languages", "drop_challenge_rating", "drop_size",
                    "drop_type", "drop_alignment", "drop_hp",
                    "drop_saving_throws", "drop_senses",
                    "drop_passive_perception", "drop_skills",
//                    "drop_spellcasting_ability",
                    "drop_token_size", "character_id"]
      getAttrs(drop_attrs, function(v) {
        if(category === "Monsters") {
             update["npc"] = "1";
             if(v["drop_name"] && v["drop_name"] != "") {
               update["character_name"] = v["drop_name"];
             };

             // default class
             update['class'] = 'fighter';

             // core stats
             update["strength"]     = v["drop_str"] ? v["drop_str"] : "";
             update["dexterity"]    = v["drop_dex"] ? v["drop_dex"] : "";
             update["constitution"] = v["drop_con"] ? v["drop_con"] : "";
             update["intelligence"] = v["drop_int"] ? v["drop_int"] : "";
             update["wisdom"]       = v["drop_wis"] ? v["drop_wis"] : "";
             update["charisma"]     = v["drop_cha"] ? v["drop_cha"] : "";

             /*
             update["npc_strength_save_mod"] = 0;
             update["npc_dexterity_save_mod"] = 0;
             update["npc_constitution_save_mod"] = 0;
             update["npc_intelligence_save_mod"] = 0;
             update["npc_wisdom_save_mod"] = 0;
             update["npc_charisma_save_mod"] = 0;
             */

             /*
             if(v["drop_saving_throws"] && v["drop_saving_throws"] != "") {
                 var savearray = v["drop_saving_throws"].split(", ");
                 _.each(savearray, function(save) {
                     kv = save.indexOf("-") > -1 ? save.split(" ") : save.split(" +");
                     update["npc_" + kv[0].toLowerCase() + "_save_mod"] = parseInt(kv[1], 10);
                 });
             };
             */

             // figure out 'level' (hit_dice) from challenge Rating
             var cr = v["drop_challenge_rating"];
             if (cr) {
                if (cr === '1/4') {
                  update["level"] = 1;
                } else if (cr === '1/2') {
                  update["level"] = 2;
                } else {
                   update["level"] = parseInt(cr) + 2;
                }
                // default, using d8s
                update["npc_hpformula"] = update["level"].toString() + 'd8';
             }

             //right side of core stats, top to bottom
             update["npc_size"]      = v["drop_size"] ? v["drop_size"] : "";
             update["npc_type"]      = v["drop_type"] ? v["drop_type"] : "";
             if (v["drop_alignment"]) {
               update["npc_type"]  = update["npc_type"] + ", " + v["drop_alignment"];
             }

             //AC handling
             if(v["drop_ac"]) {
                 if(v["drop_ac"].indexOf("(") > -1) {
                     update["npc_ac"] = v["drop_ac"].split(" (")[0];
                     update["npc_ac_note"] = v["drop_ac"].split(" (")[1].slice(0, -1);
                 }
                 else {
                     update["npc_ac"] = v["drop_ac"];
                     update["npc_ac_note"] = "";
                 };
             }
             else {
                 update["npc_ac"] = 10;
                 update["npc_ac_note"] = "";
             };

             //HP handling
              if(v["drop_hp"]) {
                  if(v["drop_hp"].indexOf("(") > -1) {
                      update["hp"] = v["drop_hp"].split(" (")[0];
                      update["hp_max"] = update["hp"]// v["drop_hp"].split(" (")[0];
                      update["npc_hpformula"] = v["drop_hp"].split(" (")[1].slice(0, -1);
                      // try to update our level based on the npc_hpformula
                      // update["level"] = parseInt(update["npc_hpformula"].split("d")[0]) || update["level"];
                  }
                  else {
                      update["hp"] = v["drop_hp"];
                      update["hp_max"] = v["drop_hp"];
                  };
              }
              else {
                  update["hp"] = 1;
                  update["hp_max"] = 1;
              };

              update["npc_speed"] = v["drop_speed"] ? v["drop_speed"] + '/rnd' : "";
              update["npc_senses"] = v["drop_senses"] ? v["drop_senses"] : "";
              update["known_lang"] = v["drop_languages"] ? v["drop_languages"] : "";

              //Traits/Background
              update["npc_damage_resistance"] = v["drop_resistances"] ? v["drop_resistances"] : "";
              update["npc_damage_vulnerability"] = v["drop_vulnerabilities"] ? v["drop_vulnerabilities"] : "";
              update["npc_damage_immunity"] = v["drop_immunities"] ? v["drop_immunities"] : "";
              update["npc_condition_immunity"] = v["drop_condition_immunities"] ? v["drop_condition_immunities"] : "";
              update["notes"] = "";

               /*
               //Skills
               update["npc_acrobatics_bonus"] = 0;
               update["npc_animal_handling_bonus"] = 0;
               update["npc_arcana_bonus"] = 0;
               update["npc_athletics_bonus"] = 0;
               update["npc_deception_bonus"] = 0;
               update["npc_history_bonus"] = 0;
               update["npc_insight_bonus"] = 0;
               update["npc_intimidation_bonus"] = 0;
               update["npc_investigation_bonus"] = 0;
               update["npc_medicine_bonus"] = 0;
               update["npc_nature_bonus"] = 0;
               update["npc_perception_bonus"] = 0;
               update["npc_performance_bonus"] = 0;
               update["npc_persuasion_bonus"] = 0;
               update["npc_religion_bonus"] = 0;
               update["npc_sleight_of_hand_bonus"] = 0;
               update["npc_stealth_bonus"] = 0;
               update["npc_survival_bonus"] = 0;
               */


              // NPC Skills
              if(v["drop_skills"] && v["drop_skills"] != "") {
                     skillarray = v["drop_skills"].split(", ");
                     _.each(skillarray, function(skill) {
                         kv = skill.indexOf("-") > -1 ? skill.split(" ") : skill.split(" +");
                         //update["npc_" + kv[0].toLowerCase().replace(/ /g, '_') + "_bonus"] = parseInt(kv[1], 10);
                         newrowid = generateRowID();
                         update["repeating_skills_" + newrowid + "_skillname"] = kv[0].trim();
                         update["repeating_skills_" + newrowid + "_skillvalue"] = parseInt(kv[1]) || 0;
                     });
              }

              if(v["drop_content"] && v["drop_content"] != "") {

                  // split out and parse items of interest from drop_content
                  var contentarray = v["drop_content"];

                  if(contentarray && contentarray.indexOf("Legendary Actions") > -1) {
                      if(contentarray.indexOf(/\n Legendary Actions\n/) > -1) {
                          temp = contentarray.split(/\n Legendary Actions\n/)
                      }
                      else {
                          temp = contentarray.split(/Legendary Actions\n/)
                      }
                      var legendaryactionsarray = temp[1];
                      contentarray = temp[0];
                  }

                  if(contentarray && contentarray.indexOf("Reactions") > -1) {
                      if(contentarray.indexOf(/\n Reactions\n/) > -1) {
                          temp = contentarray.split(/\n Reactions\n/)
                      }
                      else {
                          temp = contentarray.split(/Reactions\n/)
                      }
                      var reactionsarray = temp[1];
                      contentarray = temp[0];
                  }

                  if(contentarray && contentarray.indexOf("Actions") > -1) {
                      if(contentarray.indexOf("Lair Actions") > -1) {
                          contentarray = contentarray.replace("Lair Actions","Lair Action");
                      }
                      if(contentarray.indexOf(/\n Actions\n/) > -1) {
                          temp = contentarray.split(/\n Actions\n/)
                      }
                      else {
                          temp = contentarray.split(/Actions\n/)
                      }
                      var actionsarray = temp[1];
                      contentarray = temp[0];
                  }

                  if(contentarray && contentarray.indexOf("Traits") > -1) {
                      if(contentarray.indexOf("Lair Traits") > -1) {
                          contentarray = contentarray.replace("Lair Traits", "Lair Trait");
                      }
                      if(contentarray.indexOf(/\n Traits\n/) > -1) {
                          temp = contentarray.split(/\n Traits\n/)
                      }
                      else {
                          temp = contentarray.split(/Traits\n/)
                      }
                      var traitsarray = temp[1];
                      contentarray = temp[0];
                  }

                  if(traitsarray) {
                      traitsarray = traitsarray.split("**");
                      traitsarray.shift();
                      var traitsobj = {};
                      traitsarray.forEach(function(val, i) {
                          if (i % 2 === 1) return;
                          traitsobj[val] = traitsarray[i + 1];
                      });
                      _.each(traitsobj, function(desc, name) {
                          name = name.trim();
                          newrowid = generateRowID();
                          update["repeating_npctrait_" + newrowid + "_trait_name"] = name;
                          if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                              desc = desc.substring(2);
                          }
                          update["repeating_npctrait_" + newrowid + "_trait_desc"] = desc.trim();

                          // SPELLCASTING NPCS
                          if(name.includes("Spellcasting", 0)) {
                              var lvl = parseInt(desc.substring(desc.indexOf("-level")-4, desc.indexOf("-level")-2).trim(), 10);
                              lvl = !isNaN(lvl) ? lvl : 1;

                              var ability = desc.match(/casting ability is (.*?) /);
                              ability = ability && ability.length > 1 ? ability[1] : "";
                              console.log("Ability:"+ability);
                              var dc = desc.match(/spell save DC (.*?),/);
                              console.log("DC:"+dc);
                              var mod = desc.match(/ \+?(\d+?) to hit with spell attacks/);
                              console.log("Spellmod:"+mod);

                              // update["npcspellcastingflag"] = 1;
                              update["spellcasting_type"] = ability.toLowerCase() === "intelligence" ? "Arcane" : "Divine";
                              update["spellcasting_dc"] = parseInt(dc[1]) || -1;
                              update["spellcasting_mod"] = parseInt(mod[1]) || -1;

                              // we dont use these...
                              //update["caster_level"] = lvl;
                              // update["base_level"] = lvl;

                              // TODO: what if we have a cleric, druid or other??
                              update["class"] = ability.toLowerCase() === "intelligence" ? "wizard" : "cleric";
                              update["level"] = lvl;

                              // parse out prepared spells
                              spellsarray = desc.match(/(•.*?)$/mg);
                              if (spellsarray) {
                                spellsarray.forEach( function(val, i) {
                                    //if (i % 2 === 1) { console.log("REturning); return; }

                                    // clean up carrots from string which are for footnotes we dont currently use
                                    val = val.replaceAll("^", "");

                                    // try to capture the level of the spells
                                    // the 2nd field after string split should have the info we want
                                    levelarray = val.split(" ");
                                    if (levelarray[1] === 'Cantrips') {
                                      level = 0;
                                    } else {
                                      level = levelarray[1].match(/(\d)\w{2}/);
                                      level = parseInt(level[1]) || -1;
                                    }

                                    // now parse out our spells for level 1 and higher
                                    if (level > 0) {
                                      spellsstr = val.split(":");
                                      spellnames = spellsstr[1].split(",");
                                      spellnames.forEach (function (spellname, j) {
                                        if (spellname) {
                                          console.log(" adding spell:"+spellname);
                                          // add the spell here
                                          newrowid = generateRowID();
                                          update["repeating_spells_" + newrowid + "_spelllevel"] = level;
                                          update["repeating_spells_" + newrowid + "_spellname"] = spellname;
                                        }
                                      });
                                    }
                                });
                              }

                              // callbacks.push( function() {update_pb();} );
                              //callbacks.push( function() {update_spell_slots();} );
                              callbacks.push( function() { npc_spellrest(); });

                          }
                      });
                  }

                  if(legendaryactionsarray) {
                    lactionsarray = legendaryactionsarray.split("**");
                    lactionsarray.shift();
                    var actionsobj = {};
                    lactionsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        actionsobj[val] = lactionsarray[i + 1];
                    });
                    _.each(actionsobj, function(desc, name) {
                        newrowid = generateRowID();
                        update["repeating_npcactions-l_" + newrowid + "_action_name"] = name;
                        if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                            desc = desc.substring(2);
                        }

                        if(desc.indexOf(" Attack:") > -1)
                        {
                            update["repeating_npcactions-l_" + newrowid + "_action_is_an_attack"] = 1;
                            update["repeating_npcactions-l_" + newrowid + "_action_attack_options"] = "{{attack=1}}";
                            if(desc.indexOf(" Weapon Attack:") > -1) {
                                attacktype = desc.split(" Weapon Attack:")[0] + " Weapon";
                            }
                            else if(desc.indexOf(" Spell Attack:") > -1) {
                                attacktype = desc.split(" Spell Attack:")[0] + " Spell";
                            }
                            else {
                                console.log("FAILED TO IMPORT ATTACK - NO ATTACK TYPE FOUND (Weapon Attack/Spell Attack)");
                                return;
                            }

                            update["repeating_npcactions-l_" + newrowid + "_action_attack_type"] = attacktype;
                            if(attacktype === "Melee Weapon") {
                                update["repeating_npcactions-l_" + newrowid + "_action_attack_range"] = (desc.match(/reach (.*?),/) || ["",""])[1] + " reach";
                            }
                            else {
                                update["repeating_npcactions-l_" + newrowid + "_action_attack_range"] = (desc.match(/range (.*?),/) || ["",""])[1] + " range";
                            }

                            update["repeating_npcactions-l_" + newrowid + "_action_attack_tohit"] = (desc.match(/\+(.*) to hit/) || ["",""])[1];
                            update["repeating_npcactions-l_" + newrowid + "_action_attack_target"] = (desc.match(/\.,(?!.*\.,)(.*)\. Hit:/) || ["",""])[1];
                            if(desc.toLowerCase().indexOf("damage") > -1) {
                                update["repeating_npcactions-l_" + newrowid + "_action_attack_damage"] = (desc.match(/\(([^)]+)\)/) || ["",""])[1];
                                update["repeating_npcactions-l_" + newrowid + "_action_attack_damagetype"] = (desc.match(/\) (.*?) damage/) || ["",""])[1];
                                if((desc.match(/\(/g) || []).length > 1 && desc.match(/\((?!.*\()([^)]+)\)/)) {
                                    var second_match = desc.match(/\((?!.*\()([^)]+)\)/);
                                    if(second_match[1] && second_match[1].indexOf(" DC") === -1) {
                                        update["repeating_npcactions-l_" + newrowid + "_action_attack_damage2"] = (desc.match(/\((?!.*\()([^)]+)\)/) || ["",""])[1];
                                        update["repeating_npcactions-l_" + newrowid + "_action_attack_damagetype2"] = (desc.match(/\)(?!.*\)) (.*?) damage/) || ["",""])[1];
                                    };
                                };
                                ctest1 = desc.split("damage.")[1];
                                ctest2 = desc.split("damage, ")[1];
                                if(ctest1 && ctest1.length > 0) {
                                    update["repeating_npcactions-l_" + newrowid + "_action_desc"] = ctest1.trim();
                                }
                                else if(ctest2 && ctest2.length > 0) {
                                    update["repeating_npcactions-l_" + newrowid + "_action_desc"] = ctest2.trim();
                                }
                            }
                            else {
                                update["repeating_npcactions-l_" + newrowid + "_action_desc"] = desc.split("Hit:")[1].trim();
                            }

                            // attack description info
                            update["repeating_npcactions-l_" + newrowid + "_action_attack_desc1"] = attacktype + ' Attack. '
                              + update["repeating_npcactions-l_" + newrowid + "_action_attack_range"] + ".";

                            update["repeating_npcactions-l_" + newrowid + "_action_attack_desc2"] = " Hit: +"
                              + update["repeating_npcactions-l_" + newrowid + "_action_attack_tohit"] + ' ('
                              + update["repeating_npcactions-l_" + newrowid + "_action_attack_damage"] + ') '
                              + update["repeating_npcactions-l_" + newrowid + "_action_attack_damagetype"] + ' damage. ';
                        }
                        else {
                            update["repeating_npcactions-l_" + newrowid + "_action_desc"] = desc;
                            update["repeating_npcactions-l_" + newrowid + "_action_is_an_attack"] = 0;
                        }

                    });

                    // callbacks.push( function() {update_npc_action("all");} );
                  } // end legendary actions

                  if(actionsarray) {
                    actionsarray = actionsarray.split("**");
                    actionsarray.shift();
                    var actionsobj = {};
                    actionsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        actionsobj[val] = actionsarray[i + 1];
                    });
                    _.each(actionsobj, function(desc, name) {
                        newrowid = generateRowID();
                        if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                            desc = desc.substring(2);
                        }

                        // determine if its an attack, or just a non-attack 'action'
                        // For the later, we just turn it into a 'trait'
                        const is_attack_action = desc.indexOf(" Attack:") > -1 ? true : false;

                        update["repeating_npcactions_" + newrowid + "_action_name"] = name;
                        // set action editor to closed as a default
                        update['repeating_npcactions_'+newrowid+'_show_action_editor'] = 0;
                        // update["repeating_npcactions_" + newrowid + "_action_npc_options-flag"] = "0";

                        if(is_attack_action)
                        {
                            update["repeating_npcactions_" + newrowid + "_action_is_an_attack"] = 1;
                            update["repeating_npcactions_" + newrowid + "_action_attack_options"] = "{{attack=1}}";

                            if(desc.indexOf(" Weapon Attack:") > -1) {
                                attacktype = desc.split(" Weapon Attack:")[0] + " Weapon";
                            }
                            else if(desc.indexOf(" Spell Attack:") > -1) {
                                attacktype = desc.split(" Spell Attack:")[0] + " Spell";
                            }
                            else {
                                console.log("FAILED TO IMPORT ATTACK - NO ATTACK TYPE FOUND (Weapon Attack/Spell Attack)");
                                return;
                            }

                            update["repeating_npcactions_" + newrowid + "_action_attack_type"] = attacktype;
                            if(attacktype === "Melee Weapon") {
                                update["repeating_npcactions_" + newrowid + "_action_attack_range"] = (desc.match(/reach (.*?),/) || ["",""])[1] + " reach";
                            }
                            else {
                                update["repeating_npcactions_" + newrowid + "_action_attack_range"] = (desc.match(/range (.*?),/) || ["",""])[1] + " range";
                            }

                            update["repeating_npcactions_" + newrowid + "_action_attack_tohit"] = (desc.match(/\+(.*) to hit/) || ["",""])[1];
                            update["repeating_npcactions_" + newrowid + "_action_attack_target"] = (desc.match(/\.,(?!.*\.,)(.*)\. Hit:/) || ["",""])[1];

                            if(desc.toLowerCase().indexOf("damage") > -1) {
                                update["repeating_npcactions_" + newrowid + "_action_attack_damage"] = (desc.match(/\(([^)]+)\)/) || ["",""])[1];
                                update["repeating_npcactions_" + newrowid + "_action_attack_damagetype"] = (desc.match(/\) (.*?) damage/) || ["",""])[1];
                                if((desc.match(/\(/g) || []).length > 1 && desc.match(/\((?!.*\()([^)]+)\)/)) {
                                    var second_match = desc.match(/\((?!.*\()([^)]+)\)/);
                                    if(second_match[1] && second_match[1].indexOf(" DC") === -1) {
                                        update["repeating_npcactions_" + newrowid + "_action_attack_damage2"] = (desc.match(/\((?!.*\()([^)]+)\)/) || ["",""])[1];
                                        update["repeating_npcactions_" + newrowid + "_action_attack_damagetype2"] = (desc.match(/\)(?!.*\)) (.*?) damage/) || ["",""])[1];
                                    };
                                };
                                ctest1 = desc.split("damage.")[1];
                                ctest2 = desc.split("damage, ")[1];
                                if(ctest1 && ctest1.length > 0) {
                                    update["repeating_npcactions_" + newrowid + "_action_desc"] = ctest1.trim();
                                }
                                else if(ctest2 && ctest2.length > 0) {
                                    update["repeating_npcactions_" + newrowid + "_action_desc"] = ctest2.trim();
                                }
                            }
                            else {
                                update["repeating_npcactions_" + newrowid + "_action_desc"] = desc.split("Hit:")[1].trim();
                            }

                            // attack description info
                            update["repeating_npcactions_" + newrowid + "_action_attack_desc1"] = attacktype + ' Attack. '
                              + update["repeating_npcactions_" + newrowid + "_action_attack_range"] + ".";

                            update["repeating_npcactions_" + newrowid + "_action_attack_desc2"] = " Hit: +"
                              + update["repeating_npcactions_" + newrowid + "_action_attack_tohit"] + ' ('
                              + update["repeating_npcactions_" + newrowid + "_action_attack_damage"] + ') '
                              + update["repeating_npcactions_" + newrowid + "_action_attack_damagetype"] + ' damage. ';
                        }
                        else {
                            update["repeating_npcactions_" + newrowid + "_action_desc"] = desc;
                            update["repeating_npcactions_" + newrowid + "_action_is_an_attack"] = 0;
                        }

                    });

                    //callbacks.push( function() {update_npc_action("all");} );
                 } // end actions array

                 if(reactionsarray) {
                    update["npcreactionsflag"] = 1;
                    reactionsarray = reactionsarray.split("**");
                    reactionsarray.shift();
                    var reactionsobj = {};
                    reactionsarray.forEach(function(val, i) {
                        if (i % 2 === 1) return;
                        reactionsobj[val] = reactionsarray[i + 1];
                    });
                    _.each(reactionsobj, function(desc, name) {
                        newrowid = generateRowID();
                        update["repeating_npcreaction_" + newrowid + "_react_name"] = name + ".";
                        if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                            desc = desc.substring(2);
                        }
                        update["repeating_npcreaction_" + newrowid + "_react_desc"] = desc.trim();
                    });
                 } // end of reactionsarray

              }

            };

            // callbacks.push( function() {cleanup_drop_fields();} );
            setAttrs(update, {silent: true}, function() {callbacks.forEach(function(callback) {callback(); })} );
         });
     };

     var cleanup_drop_fields = function() {
          var update = {};
          update["drop_name"] = "";
          update["drop_weight"] = "";
          update["drop_properties"] = "";
          update["drop_modifiers"] = "";
          update["drop_content"] = "";
          update["drop_itemtype"] = "";
          update["drop_damage"] = "";
          update["drop_damagetype"] = "";
          update["drop_range"] = "";
          update["drop_ac"] = "";
          update["drop_category"] = "";
          update["drop_speed"] = "";
          update["drop_str"] = "";
          update["drop_dex"] = "";
          update["drop_con"] = "";
          update["drop_int"] = "";
          update["drop_wis"] = "";
          update["drop_cha"] = "";
          update["drop_vulnerabilities"] = "";
          update["drop_resistances"] = "";
          update["drop_immunities"] = "";
          update["drop_condition_immunities"] = "";
          update["drop_languages"] = "";
          update["drop_challenge_rating"] = "";
          update["drop_size"] = "";
          update["drop_type"] = "";
          update["drop_alignment"] = "";
          update["drop_hp"] = "";
          update["drop_saving_throws"] = "";
          update["drop_senses"] = "";
          update["drop_passive_perception"] = "";
          update["drop_skills"] = "";
          update["drop_token_size"] = "";
          setAttrs(update, {silent: true});
      };

</script>
