<!-- stuff which might eventually be selectable by player -->
<input type="hidden" name="attr_charname_output" value="On">
<input type="checkbox" name="attr_licensedsheet" value="1" hidden="true"/>

<!--other stuff, not sure what its good for -->
<input name="attr_version" type="hidden" value="1.0"/>
<input class="monster_confirm_flag" name="attr_monster_confirm_flag" type="hidden"/>
<input class="mancer_confirm_flag" name="attr_mancer_confirm_flag" type="hidden"/>
<!-- use official licensed sheet styling -->

<div class="licensecontainer compendium-drop-target monsters" data-licensedsheet="attr_licensedsheet">

  <input type="text" name="attr_token_size" value="1" placeholder="1" hidden="true"/>

   <!-- COMPENDIUM DROP CATCHERS -->
  <input type="hidden" name="attr_drop_category" accept="Category"/>
  <input type="hidden" name="attr_drop_name" accept="Name"/>
  <input type="hidden" name="attr_drop_weight" accept="Weight"/>
  <input type="hidden" name="attr_drop_properties" accept="Properties"/>
  <input type="hidden" name="attr_drop_modifiers" accept="Modifiers"/>
  <input type="hidden" name="attr_drop_content" accept="Content"/>
  <input type="hidden" name="attr_drop_itemtype" accept="Item Type"/>
  <input type="hidden" name="attr_drop_damage" accept="Damage"/>
  <input type="hidden" name="attr_drop_damage2" accept="Damage2"/>
  <input type="hidden" name="attr_drop_damagetype" accept="Damage Type"/>
  <input type="hidden" name="attr_drop_damagetype2" accept="Damage Type2"/>
  <input type="hidden" name="attr_drop_range" accept="Range"/>
  <input type="hidden" name="attr_drop_ac" accept="AC"/>

  <input type="hidden" name="attr_drop_speed" accept="Speed"/>
  <input type="hidden" name="attr_drop_str" accept="STR"/>
  <input type="hidden" name="attr_drop_dex" accept="DEX"/>
  <input type="hidden" name="attr_drop_con" accept="CON"/>
  <input type="hidden" name="attr_drop_int" accept="INT"/>
  <input type="hidden" name="attr_drop_wis" accept="WIS"/>
  <input type="hidden" name="attr_drop_cha" accept="CHA"/>
  <input type="hidden" name="attr_drop_vulnerabilities" accept="Vulnerabilities"/>
  <input type="hidden" name="attr_drop_resistances" accept="Resistances"/>
  <input type="hidden" name="attr_drop_immunities" accept="Immunities"/>
  <input type="hidden" name="attr_drop_condition_immunities" accept="Condition Immunities"/>
  <input type="hidden" name="attr_drop_languages" accept="Languages"/>
  <input type="hidden" name="attr_drop_challenge_rating" accept="Challenge Rating"/>

  <input type="hidden" name="attr_drop_data" accept="data"/>

  <input type="hidden" name="attr_drop_size" accept="Size"/>
  <input type="hidden" name="attr_drop_type" accept="Type"/>
  <input type="hidden" name="attr_drop_alignment" accept="Alignment"/>
  <input type="hidden" name="attr_drop_hp" accept="HP"/>
  <input type="hidden" name="attr_drop_saving_throws" accept="Saving Throws"/>
  <input type="hidden" name="attr_drop_senses" accept="Senses"/>
  <input type="hidden" name="attr_drop_passive_perception" accept="Passive Perception"/>
  <input type="hidden" name="attr_drop_skills" accept="Skills"/>
  <input type="hidden" name="attr_drop_token_size" accept="Token Size"/>

  <!-- spells need these -->
  <input type="hidden" name="attr_drop_level" accept="Level"/>
  <input type="hidden" name="attr_drop_spell_castingtime" accept="Casting Time"/>
  <input type="hidden" name="attr_drop_spell_concentration" accept="Concentration"/>
  <input type="hidden" name="attr_drop_spell_components" accept="Components"/>
  <input type="hidden" name="attr_drop_spell_duration" accept="Duration"/>
  <input type="hidden" name="attr_drop_spell_healamount" accept="Healing"/>
  <input type="hidden" name="attr_drop_spell_range" accept="Range"/>
  <input type="hidden" name="attr_drop_spell_ritual" accept="Ritual"/>
  <input type="hidden" name="attr_drop_spell_savestat" accept="Save"/>
  <input type="hidden" name="attr_drop_spell_savesuccess" accept="Save Success"/>
  <input type="hidden" name="attr_drop_spell_school" accept="School"/>
  <input type="hidden" name="attr_drop_spell_target" accept="Target"/>
  <!-- END COMPENDIUM DROP CATCHERS -->

  <div class="compendium_warning"><span data-i18n="accepting-drop-u">ACCEPTING DROP FROM COMPENDIUM</span></div>

  <span class="small-font">NPC</span>
  <input type="checkbox" class="sheet-is_npc" name="attr_npc" value="1" checked="True"/>
  <div class="sheet-section-npc">
    <div class="block padding npc">
      <input type="text" class="align-left npc-name" name="attr_character_name"/>
      <div class="sheet-block info4 bottom-line">
        <input type="text" name="attr_npc_type" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Type"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Movement: </span>
        <input type="text" name="attr_npc_speed" class="sheet-npc-text sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Speed"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Senses: </span>
        <input type="text" name="attr_npc_senses" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Senses"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Languages: </span>
        <input type="text" name="attr_known_lang" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Languages"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Damage Resistances: </span>
        <input type="text" name="attr_npc_damage_resistance" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Damage Resistances"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Damage Immunities: </span>
        <input type="text" name="attr_npc_damage_immunity" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Damage Immunities"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Condition Immunities: </span>
        <input type="text" name="attr_npc_condition_immunity" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Damage Immunities"/>
      </div>
      <div class="sheet-block">
        <span class="italic-font">Damage Vulnerabilities: </span>
        <input type="text" name="attr_npc_damage_vulnerability" class="sheet-npc-text-long sheet-align-left sheet-padding sheet-italic-font" data-i18n-placeholder="NPC Damage Vulnerabilities"/>
      </div>

    </div>
    <hr/>

    <div class="sheet-inline">
      <input type="radio" name="attr_npctab" class="sheet-tab sheet-tab1" value="1" checked="checked" />
      <span class="sheet-tab sheet-tab1">Core Stats</span>
      <input type="radio" name="attr_npctab" class="sheet-tab sheet-tab3" value="3" />
      <span class="sheet-tab sheet-tab3">Spellcasting</span>
      <input type="radio" name="attr_npctab" class="sheet-tab sheet-tab5" value="5" />
      <span class="sheet-tab sheet-tab5">Notes</span>
      <input type="radio" name="attr_npctab" class="sheet-tab sheet-tab99" value="99" />
      <span class="sheet-tab sheet-tab99">Show All</span>

      <div class="section-core">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="npc sheet-flex padding thick-border">
          <div class="block">
            <div class="thin-border padding limit-to-half-width">
              <h4 class="bottom-line">Combat</h4>
              <div class="flex-between">
                <div class="block">
                  <div class="sheet-flex-inline">
                    <select class="sheet-info-name-med-sm" name="attr_level">
                      <option selected="selected" value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                      <option value="17">17</option>
                      <option value="18">18</option>
                      <option value="19">19</option>
                      <option value="20">20</option>
                      <option value="21">21</option>
                      <option value="22">22</option>
                      <option value="23">23</option>
                      <option value="24">24</option>
                      <option value="25">25</option>
                    </select>
                  </div>
                  <div class="block padding center">
                    <span class="ability-check-label">Hit</span>
                    <span class="ability-check-label">Dice</span>
                  </div>
                </div>
                <div class="block padding center">
                  <input name="attr_hp_max" type="number" value="1" hidden="True"/>
                  <input class="ability-check-value" name="attr_hp" type="number" value="1"/>
                  <span class="ability-check-label">HP</span>
                </div>
                <div class="block padding center">
                  <input class="ability-check-value" name="attr_npc_ac" type="number" value="10"/>
                  <span class="ability-check-label">AC</span>
                </div>
                <div class="block padding center">
                  <div class="sheet-block sheet-padding sheet-center">
                    <input class="ability-check-value" name="attr_initiative_bonus" type="number" value="0"/>
                    <button type="roll" class="sheet-npc-ability-button" name="roll_initiative"
                            value="&{template:roll_check} {{title=Initiative}} {{subheader=@{character_name}}} {{initiative=1}} {{rollname=Initiative}} {{roll=[[ 1d20 + @{initiative_bonus} [Initiative Mod] &{tracker} ]]}}">
                            Init.
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <br/>

            <div class="block thin-border padding limit-to-half-width">
              <h4 class="bottom-line">Attributes</h4>
              <div class="flex">
                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_str_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=STR Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{strength_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{strength_mod}]]}}">
                          <span class="bold-font npc-text">STR</span>
                  </button>
                  <input class="npc-ability-value" name="attr_strength" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_fortitude"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Fortitude Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{fortitude} + @{fort_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{fortitude}]] + [[@{fort_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Fort.</span>
                  </button>
                  <input class="npc-ability-check" name="attr_fortitude" type="number" value="0"/>
                </div>

                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_dex_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=DEX Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{dexterity_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{dexterity_mod}]]}}">
                    <span class="bold-font npc-text">DEX</span>
                  </button>
                  <input class="npc-ability-value" name="attr_dexterity" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_dodge"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dodge Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{dodge} + @{dodge_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dodge}]] + [[@{dodge_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Dodge</span>
                  </button>
                  <input class="npc-ability-check" name="attr_dodge" type="number" value="0"/>
                </div>

                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_con_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CON Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{constitution_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{constitution_mod}]]}}">
                    <span class="bold-font npc-text">CON</span>
                  </button>
                  <input class="npc-ability-value" name="attr_constitution" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_health"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Health Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{health} +@{health_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{health}]] + [[@{health_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Health</span>
                  </button>
                  <input class="npc-ability-check" name="attr_health" type="number" value="0"/>
                </div>

                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_int_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=INT Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{intelligence_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{intelligence_mod}]]}}">
                    <span class="bold-font npc-text">INT</span>
                 </button>
                  <input class="npc-ability-value" name="attr_intelligence" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_perception"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Perception Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{perception} + @{per_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{perception}]] + [[@{per_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Per.</span>
                  </button>
                  <input class="npc-ability-check" name="attr_perception" type="number" value="0"/>
                </div>

                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_wis_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=WIS Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{wisdom_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{wisdom_mod}]]}}">
                    <span class="bold-font npc-text">WIS</span>
                  </button>
                  <input class="npc-ability-value" name="attr_wisdom" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_willpower"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Willpower Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{willpower} +@{will_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{willpower}]] +[[@{will_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Will</span>
                  </button>
                  <input class="npc-ability-check" name="attr_willpower" type="number" value="0"/>
                </div>

                <div class="block center">
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_cha_check"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CHA Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{charisma_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{charisma_mod}]]}}">
                    <span class="bold-font npc-text">CHA</span>
                  </button>
                  <input class="npc-ability-value" name="attr_charisma" type="number" value="10"/>
                  <button class="blank-roll-button narrow-button" type="roll" name="roll_ego"
                          value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Ego Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{ego} + @{ego_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{ego}]] +[[@{ego_bonus}]] ]]}}">
                          <span class="bold-font npc-text">Ego</span>
                  </button>
                  <input class="npc-ability-check" name="attr_ego" type="number" value="0"/>
                  <input name="attr_ego_bonus" type="number" value="0" hidden="True"/>
                </div>
              </div>
            </div> <!-- end attribs and saves -->
            <br/>

            <div class="block thin-border padding limit-to-half-width">
               <h4 class="bottom-line">Skills</h4>
               <div class="npc-traitcontainer">
                 <fieldset class="repeating_skills">
                   <div class="sheet-block sheet-thin-border sheet-side-padding">
                     <div class="sheet-align-right">
                       <input type="text" name="attr_skillname" class="sheet-bottom-line sheet-skillname"/>
                       <input type="number" name="attr_skillvalue" class="sheet-bold-font" value="1"/>
                       <input type="number" name="attr_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                       <button class="sheet-skill-button" type="roll" name="roll_skill"
                               value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{skillname} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{skillvalue} +@{skill_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{skillvalue}]] +[[@{skill_bonus}]] ]]}}"></button>
                     </div>
                   </div>
                </fieldset>
               </div>
            </div>
            <br/>

            <div class="block thin-border padding limit-to-half-width">
              <h4 class="bottom-line">Traits</h4>
               <div class="npc-traitcontainer">
                 <fieldset class="repeating_npctrait">
                   <div class="sheet-block sheet-side-padding bottom-line align-left">
                     <img class="small-image" src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                     <input type="checkbox" class="sheet-is_edit_trait" value="1"/>
                     <div class="section-npc-edit-trait">
                       <div class="flex fill-width">
                         <span class="bold-font">Name:</span>
                         <input type="text" name="attr_trait_name" class="align-left"/>
                       </div>
                       <div class="block">
                         <span class="bold-font">Desc:</span>
                         <!--input type="textarea" name="attr_trait_desc" class="npc-trait-textarea"/-->
                         <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_trait_desc" data-i18n-placeholder="description"></textarea>
                       </div>
                     </div>
                     <div class="section-npc-show-trait">
                       <div class="flex fill-width">
                         <label class="npc-trait-name info5"><span name="attr_trait_name">Trait Name</span></label>
                       </div>
                       <label class="npc-text-sm info5"><span name="attr_trait_desc">Description Here</span></label>
                     </div>
                   </div>
                 </fieldset>
               </div>
            </div>
          </div> <!-- LHS -->

          <div class="block">
          <div class="block thin-border limit-to-half-width">
            <h4 class="bottom-line">Actions</h4>
            <div class="npc-traitcontainer">
              <fieldset class="repeating_npcactions">
                <div class="sheet-block sheet-side-padding bottom-line align-left">

                  <button type="action" name="act_edit_npc_action" class="npc-edit-button align-right">
                    <img src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                  </button>

                  <input type="checkbox" class="sheet-show-npc-action-editor" name="attr_show_action_editor" value="1" checked="True"/>
                  <div class="sheet-section-npc-action-editor sheet-block">
                    <!-- TODO: implement checkbox toggle in sheethelper attack /non attack here, which then reveals, or not, the attack options -->
                    <div class="sheet-flex">
                      <input type="text" class="npc-action-text" name="attr_action_name" data-i18n-placeholder="name"/>
                    </div>
                    <div class="sheet-flex">
                      <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_action_desc" data-i18n-placeholder="description"></textarea>
                    </div>
                    <span>is an attack action?</span>
                    <input type="checkbox" class="sheet-is-npc-attack-action" name="attr_action_is_an_attack" value="1" checked="True"/>
                    <div class="sheet-section-npc-action-attack-options">
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Type</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_type" data-i18n-placeholder="Attack Type (Weapon|Spell)"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Target Area</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_target" data-i18n-placeholder="Attack Targets, ex. 'One target'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Range</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_range" data-i18n-placeholder="Attack Range, ex '5 ft. reach'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack To Hit</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_tohit" data-i18n-placeholder="Attack To Hit Bonus"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage" data-i18n-placeholder="Attack Damage Dieroll, ex '1d6+1'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage Type</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damagetype" data-i18n-placeholder="Attack Damage Type, ex 'slashing'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage2</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage2" data-i18n-placeholder="Attack Damage2 Dieroll, ex '1d6+1'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage Type2</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage2type" data-i18n-placeholder="Attack Damage2 Type, ex 'slashing'"/>
                      </div>
                      <!-- TODO: upon edit update these fields -->
                      <input type="text" name="attr_action_attack_desc1" hidden="true"/>
                      <input type="text" name="attr_action_attack_desc2" hidden="true"/>
                    </div>
                  </div>

                  <input type="checkbox" class="sheet-npc-show-attack" name="attr_action_show_attack" value="1" hidden="True" checked="True"/>
                  <div class="sheet-section-npc-show-attack flex">
                    <button type="roll" name="roll_npc_action" class="npc-trait-name blank-roll-button info5"
                       value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{action_name} Attack}} {{subheader=@{character_name}}} {{attack=0}} {{attack=[[1d20 + [[@{action_attack_tohit}]] ]]}} {{critical=[[19 + @{action_attack_tohit}]]}} {{fumble=[[2+@{action_attack_tohit}]] }} {{damage=[[@{action_attack_damage}]]}} {{damagetype=@{action_attack_damagetype}}} {{critdamage=[[@{action_attack_damage} + @{action_attack_damage} ]]}} }}">
                       <span name="attr_action_name">Action Name</span>
                    </button>
                    <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc1"/></label>
                    <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc2"/></label>
                  </div>
                  <div class="section-npc-show-non-attack flex">
                    <label class="info5 npc-trait-name info5"><span name="attr_action_name">Action Name</span></label>
                  </div>
                  <label class="info5 npc-text"><span name="attr_action_desc" class="npc-text-sm">Description Here</span></label>
                </div>
              </fieldset>
            </div>
          </div>
          <br/>

          <div class="block thin-border padding limit-to-half-width">
            <h4 class="bottom-line">Legendary Actions</h4>
            <div class="npc-traitcontainer">
              <fieldset class="repeating_npcactions-l">
                <div class="sheet-block sheet-side-padding bottom-line align-left">

                  <button type="action" name="act_edit_npc_action" class="npc-edit-button align-right">
                    <img src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                  </button>

                  <input type="checkbox" class="sheet-show-npc-action-editor" name="attr_show_action_editor" value="1" checked="True"/>
                  <div class="sheet-section-npc-action-editor sheet-block">
                    <!-- TODO: implement checkbox toggle in sheethelper attack /non attack here, which then reveals, or not, the attack options -->
                    <div class="sheet-flex">
                      <input type="text" class="npc-action-text" name="attr_action_name" data-i18n-placeholder="name"/>
                    </div>
                    <div class="sheet-flex">
                      <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_action_desc" data-i18n-placeholder="description"></textarea>
                    </div>
                    <span>is an attack action?</span>
                    <input type="checkbox" class="sheet-is-npc-attack-action" name="attr_action_is_an_attack" value="1" checked="True"/>
                    <div class="sheet-section-npc-action-attack-options">
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Type</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_type" data-i18n-placeholder="Attack Type (Weapon|Spell)"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Target Area</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_target" data-i18n-placeholder="Attack Targets, ex. 'One target'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Range</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_range" data-i18n-placeholder="Attack Range, ex '5 ft. reach'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack To Hit</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_tohit" data-i18n-placeholder="Attack To Hit Bonus"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage" data-i18n-placeholder="Attack Damage Dieroll, ex '1d6+1'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage Type</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damagetype" data-i18n-placeholder="Attack Damage Type, ex 'slashing'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage2</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage2" data-i18n-placeholder="Attack Damage2 Dieroll, ex '1d6+1'"/>
                      </div>
                      <div class="flex">
                        <span class="bold-font npc-action-text">Attack Damage Type2</span>
                        <input type="text" class="npc-action-text" name="attr_action_attack_damage2type" data-i18n-placeholder="Attack Damage2 Type, ex 'slashing'"/>
                      </div>
                      <!-- TODO: upon edit update these fields -->
                      <input type="text" name="attr_action_attack_desc1" hidden="true"/>
                      <input type="text" name="attr_action_attack_desc2" hidden="true"/>
                    </div>
                  </div>

                  <input type="checkbox" class="sheet-npc-show-attack" name="attr_action_show_attack" value="1" hidden="True" checked="True"/>
                  <div class="sheet-section-npc-show-attack flex">
                    <button type="roll" name="roll_npc_action" class="npc-trait-name blank-roll-button info5"
                       value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{action_name} Attack}} {{subheader=@{character_name}}} {{attack=0}} {{attack=[[1d20 + [[@{action_attack_tohit}]] ]]}} {{critical=[[19 + @{action_attack_tohit}]]}} {{fumble=[[2+@{action_attack_tohit}]] }} {{damage=[[@{action_attack_damage}]]}} {{damagetype=@{action_attack_damagetype}}} {{critdamage=[[@{action_attack_damage} + @{action_attack_damage} ]]}} }}">
                       <span name="attr_action_name">Legendary Action Name</span>
                    </button>
                    <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc1"/></label>
                    <label class="info5 npc-trait-attack-info"><span name="attr_action_attack_desc2"/></label>
                  </div>
                  <div class="section-npc-show-non-attack flex">
                    <label class="info5 npc-trait-name info5"><span name="attr_action_name">Legendary Action Name</span></label>
                  </div>
                  <label class="info5 npc-text"><span name="attr_action_desc" class="npc-text-sm">Description Here</span></label>
                </div>
              </fieldset>
            </div>
          </div>
          <br/>

          <div class="block thin-border padding limit-to-half-width">
             <h4 class="bottom-line">Reactions</h4>
             <div class="npc-traitcontainer">
               <fieldset class="repeating_npcreaction">
                 <div class="sheet-block sheet-side-padding bottom-line align-left">
                   <input type="checkbox" class="sheet-is_edit_trait" value="1"/>
                   <img class="small-image" src="https://raw.githubusercontent.com/brian-thomas/roll20-osr-homebrew-charsheet/master/gear_icon.png"/>
                   <div class="section-npc-edit-trait">
                     <div class="flex fill-width">
                       <span class="bold-font">Name:</span>
                       <input type="text" name="attr_name" class="align-left" data-i18n-placeholder="reaction name"/>
                     </div>
                     <div class="block">
                       <span class="bold-font">Desc:</span>
                       <textarea class="sheet-npc-action-desc" spellcheck="false" name="attr_desc" data-i18n-placeholder="description"></textarea>
                     </div>
                   </div>
                   <div class="section-npc-show-trait">
                     <div class="flex fill-width">
                       <label class="npc-trait-name info5"><span name="attr_name">Reaction Name</span></label>
                     </div>
                     <label class="npc-text-sm info5"><span name="attr_desc"/>Description Here</label>
                   </div>
                 </div>
               </fieldset>
             </div>
           </div>

         </div> <!-- action/reaction block -->
       </div>
     </div> <!-- core w/ thick border -->

     <div class="section-magic">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="block thick-border">
          <h3>Spellcasting</h3>
          <div class="sheet-flex-between">
            <div class="sheet-flex">
              <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                <span>Spellcasting Type</span>
              </div>
              <div class="sheet-ability-column-modifier sheet-flex-between">
                <select class="attack-param-long" name="attr_spellcasting_type">
                  <option selected="selected" value="none">--</option>
                  <option value="Arcane">Arcane</option>
                  <option value="Divine">Divine</option>
                </select>
              </div>
            </div>
            <div class="sheet-flex">
              <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                <span>Spellcasting Modifier</span>
              </div>
              <div class="sheet-ability-column-modifier sheet-flex-between">
                <div class="sheet-thin-border sheet-flex sheet-side-padding">
                  <input class="ability-value" name="attr_spellcasting_mod" type="number" value="0"/>
                </div>
              </div>
            </div>
            <div class="sheet-flex">
              <div class="sheet-ability-column-modifier sheet-flex-between sheet-side-padding">
                <span>Spell Save DC</span>
              </div>
              <div class="sheet-ability-column-modifier sheet-flex-between">
                <div class="sheet-thin-border sheet-flex sheet-side-padding">
                  <input class="ability-value" name="attr_spellcasting_dc" type="number" value="0"/>
                </div>
              </div>
            </div>
          </div>

          <button type="action" name="act_spellrest">Regain All Spellslots</button>

          <h4 class="bottom-line">Spells</h4>
          <div class="npc-traitcontainer sheet-spells">
              <input type="hidden" class="spellicon_flag" name="attr_spellicon_flag" value="all"/>
              <div class="body">
                <div class="col col1">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">1</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl1_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl1_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-1">
                        <div class="spell">
                            <div class="display">
                               <input type="hidden" name="attr_rollcontent"
                                      value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <input type="hidden" name="attr_adhoc_dc" value="10"/>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
  <!--
                                value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{innate=@{innate}}} {{description=@{spelldescription}}}">

                                value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
  -->

          <!--
                            <input type="hidden" name="attr_adhoc_rollcontent"
                                   value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">

                            <button class="adhoc-flag" type="roll" name="roll_adhoc_cast" value="@{adhoc_rollcontent}"><span>e</span></button>

          <button class="adhoc-flag" type="roll" name="roll_adhoc_cast"
                                    value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
              <span>e</span>
          </button>
          <input class="adhoc-flag" type="checkbox" name="attr_adhoc-flag" checked="checked"><span>e</span></input>
          -->

                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span></input>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="1">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">4</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl4_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl4_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-4">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="4">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">7</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl7_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl7_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-7">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="7">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>

                <div class="col col2">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">2</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl2_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl2_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-2">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="2">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">5</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl5_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl5_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-5">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="5">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">8</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl8_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl8_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-8">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="8">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>

                <div class="col col3">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">3</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl3_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl3_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-3">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="3">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">6</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl6_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl6_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-6">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="6">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">9</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl9_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl9_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-9">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
              <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
          <!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
          -->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="9">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>
              </div>
          <!-- end paste -->
          </div>
        </div>
     </div>
     <br/>

     <div class="section-notes">
       <span class="sheet-spacer">&nbsp;</span>
       <div class="thin-border block padding">
         <h3>Notes</h3>
         <textarea class="sheet-npc-notes" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
       </div>
     </div>

   </div>

  </div> <!-- NPC End -->

  <input type="checkbox" class="sheet-pc_header_enabled" name="attr_pc_header_enabled" value="1" hidden="True"/>
  <div class="sheet-section-pc body">

    <!-- Used by OGL Companion API Script -->
    <input type="text" name="attr_wtype" value="" hidden="true"/>
    <input type="text" name="attr_whispertoggle" value="" hidden="true"/>

    <div class="sheet-bottom-padding sheet-flex-between">
      <div class="header-left">
        <div class="thin-border" style="background-color: #C7C7C7;">

          <div class="block bottom-padding" style="background-color: #C7C7C7;">
            <span class="sheet-bold-font med-font centered-label">Name:</span>
            <input type="text" class="sheet-align-left sheet-info-name-long right-pad" name="attr_character_name"/>
            <input type="checkbox" class="sheet-move-rate-stop" name="attr_move_rate_stop" value="0" hidden="true" checked="true"/>
            <input type="checkbox" class="sheet-move-rate-heavy-enc" name="attr_move_rate_heavy_enc" value="0" hidden="true" checked="true"/>
            <input type="checkbox" class="sheet-move-rate-med-enc" name="attr_move_rate_med_enc" value="0" hidden="true" checked="true"/>
            <input type="checkbox" class="sheet-move-rate-light-enc" name="attr_move_rate_light_enc" value="0" hidden="true" checked="true"/>
            <span class="sheet-bold-font centered-label left-pad right-pad move-rate-light-enc-notify move-rate-med-enc-notify move-rate-heavy-enc-notify move-rate-stop-notify">Movement Rate:</span>
            <input type="number" name="attr_movement_rate" class="sheet-inactive-color sm-stat right-pad" value="40" readonly="true"/>
            <span class="bold-font big-font centred-label left-pad right-pad">/</span>
            <input type="number" name="attr_base_movement_rate" class="sheet-inactive-color sm-stat" value="40" readonly="true"/>
          </div>

          <div class="block" style="background-color: #C7C7C7;">
            <select class="sheet-info-name" name="attr_class">
               <option selected="selected" value="none">--</option>
               <option value="fighter">Fighter</option>
               <!--option value="cleric">Cleric</option-->
               <option value="specialist">Specialist</option>
               <option value="wizard">Wizard</option>
             </select>
             <select class="sheet-info-name-sm" name="attr_level">
               <option selected="selected" value="0">0</option>
               <option value="1">1</option>
               <option value="2">2</option>
               <option value="3">3</option>
               <option value="4">4</option>
               <option value="5">5</option>
               <option value="6">6</option>
               <option value="7">7</option>
               <option value="8">8</option>
               <option value="9">9</option>
               <option value="10">10</option>
               <option value="11">11</option>
               <option value="12">12</option>
               <option value="13">13</option>
               <option value="14">14</option>
               <option value="15">15</option>
               <option value="16">16</option>
               <option value="17">17</option>
               <option value="18">18</option>
               <option value="19">19</option>
               <option value="20">20</option>
             </select>
             <input type="text" class="sheet-align-right sheet-info-name-med" name="attr_xp" value="0"/>
             <input type="checkbox" class="sheet-next-level-up" name="attr_next_level_up" value="0" hidden="true" checked="true"/>
             <input type="text" class="sheet-align-right inactive-color sheet-next-level-notify sheet-info-name-med" name="attr_next_level_xp" value="1" readonly="true"/>
             <input type="checkbox" class="sheet-is_multiclass" name="attr_is_multiclass" value="1"/>
             <span class="ability-check-label">Multiclass</span>
          </div>

          <!--div class="sheet-inline-flex sheet-bottom-padding"-->
          <div class="inline-flex" style="background-color: #C7C7C7;">
             <span class="sheet-info-name">Class</span>
             <span class="sheet-info-name-sm">Level</span>
             <span class="sheet-info-name-med">XP</span>
             <span class="sheet-info-name-med" style="">Next Level XP</span>
           </div>

           <input type="checkbox" class="sheet-multiclass_enabled" name="attr_multiclass_enabled" value="1" hidden="true"/>
           <div class="section-multiclass" style="background-color: #C7C7C7;">
             <div class="sheet-inline-flex">
               <select class="sheet-info-name" name="attr_class2">
                 <option selected="selected" value="none">--</option>
                 <option value="fighter">Fighter</option>
                 <!--option value="cleric">Cleric</option-->
                 <option value="specialist">Specialist</option>
                 <option value="wizard">Wizard</option>
               </select>
               <select class="sheet-info-name-sm" name="attr_level2">
                 <option value="0" selected="selected">--</option>
                 <option value="1">1</option>
                 <option value="2">2</option>
                 <option value="3">3</option>
                 <option value="4">4</option>
                 <option value="5">5</option>
                 <option value="6">6</option>
                 <option value="7">7</option>
                 <option value="8">8</option>
                 <option value="9">9</option>
                 <option value="10">10</option>
                 <option value="11">11</option>
                 <option value="12">12</option>
                 <option value="13">13</option>
                 <option value="14">14</option>
                 <option value="15">15</option>
                 <option value="16">16</option>
                 <option value="17">17</option>
                 <option value="18">18</option>
                 <option value="19">19</option>
                 <option value="20">20</option>
               </select>
             </div>
             <div class="sheet-inline-flex">
               <span class="sheet-info-name">Class</span>
               <span class="sheet-info-name">Level</span>
               <span class="sheet-info-name">&nbsp;</span>
             </div>
           </div>

           <div class="sheet-block" style="background-color: #C7C7C7;">
             <div class="sheet-inline-flex">
               <select class="sheet-info-name" name="attr_alignment">
                  <option selectekd="selected" value="Neutral">Neutral</option>
                  <option value="Lawful">Lawful</option>
                  <option value="Chaotic">Chaotic</option>
               </select>
               <select class="sheet-info-name" name="attr_race">
                  <option selected="selected" value="Human">Human</option>
                  <option value="Dwarf">Dwarf</option>
                  <option value="Elven">Elven</option>
                  <option value="Halfling">Halfling</option>
               </select>
               <input type="text" class="info-name" style="width: 315px;" name="attr_background"/>
             </div>
             <div class="sheet-inline-flex">
               <span class="sheet-info-name">Alignment</span>
               <span class="sheet-info-name">Race</span>
               <span class="info-name" style="margin-left: 90px;">Background</span>
             </div>
          </div>
        </div>
        <span style="text-align: center;">&nbsp;</span>
        <div class="block thin-border" style="padding: 2px; top-margin: 2px; background-color: #C7C7C7;">
          <div class="inline-flex">
             <span class="info-name bold-font" style="width: 150px;">Social Status</span>
             <span class="info-name-sm" style="width: 40px;">Buy %</span>
             <span class="info-name-sm" style="width: 40px;">Sell %</span>
             <span class="info-name" style="width: 60px; text-align: center;">Max Savings</span>
             <span class="info-name" style="width: 310px;">Other</span>
          </div>
           <div class="inline-flex">
              <input type="number" name="attr_starting_status" value="3" hidden="true"/>
              <input type="text" class="info-name bold-font" style="text-align: center; border-color: #C7C7C7; background-color: #D7D7D7; width: 150px;"
                     value="Slave" name="attr_status_title" readonly="true"/>
              <input type="text" class="info-name inactive-color" style="text-align: right; width: 40px; border-color: #C7C7C7; background-color: #D7D7D7;"
                    value="1" name="attr_buy_percent" readonly="true"/>
              <input type="text" class="info-name inactive-color" style="text-align: right; width: 40px; border-color: #C7C7C7; background-color: #D7D7D7;"
                    value="1" name="attr_sell_percent" readonly="true"/>
              <input type="text" class="info-name inactive-color" style="text-align: right; width: 60px; border-color: #C7C7C7; background-color: #D7D7D7;"
                    value="10000" name="attr_max_savings" readonly="true"/>
              <input type="text" class="info-name inactive-color" style="width: 310px;  border-color: #C7C7C7; background-color: #D7D7D7;"
                    value="Slave" name="attr_status_other" readonly="true"/>
           </div>
        </div>
    </div>

    <div class="sheet-header-right sheet-noborder">
       <div class="block">
          <img name="attr_character_token" class="logo"/>
       </div>
       <!--
       <div class="inline-flex center">
         <span style="width: 60px;">Taint Level:</span>
         <select name="attr_taint_level">
            <option selcted="selected" value="0">0 - Untainted</option>
            <option selcted="selected" value="1">1 - Untainted</option>
            <option selcted="selected" value="2">2 - Untainted</option>
            <option selcted="selected" value="3">3 - Mild Taint</option>
            <option selcted="selected" value="4">4 - Mild Taint</option>
            <option selcted="selected" value="5">5 - Tainted</option>
            <option selcted="selected" value="6">6 - Tainted</option>
            <option selcted="selected" value="7">7 - Severe Taint</option>
            <option selcted="selected" value="8">8 - Severe Taint</option>
            <option selcted="selected" value="9">9 - Blackened Soul</option>
        </select>
          <input type="text" name="attr_exhaustion_level" value="0" hidden="true"/>
          <input type="text" name="attr_condition_msg" value="" hidden="true"/>
          <span name="attr_condition_msg" class="inactive-color"
                style="text-align: center; border: 0px; font-size: 18px; height: 20px;  width: 290px;"
          />
       </div>
       -->
    </div>
    </div>

    <hr/>

    <div class="sheet-inline">
      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab1" value="1" checked="checked" />
      <span class="sheet-tab sheet-tab1">Core Stats</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab2" value="2" />
      <span class="sheet-tab sheet-tab2">Combat</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab3" value="3" />
      <span class="sheet-tab sheet-tab3">Magic</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab4" value="4" />
      <span class="sheet-tab sheet-tab4">Perks</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab5" value="5" />
      <span class="sheet-tab sheet-tab5">Inventory</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab6" value="6" />
      <span class="sheet-tab sheet-tab6">Notes</span>

      <input type="radio" name="attr_tab" class="sheet-tab sheet-tab99" value="99" />
      <span class="sheet-tab sheet-tab99">Show All</span>

      <div class="section-core">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-bottom-padding sheet-flex-between">
          <div class="sheet-col-left">
            <div class="sheet-flex-between">
              <div class="sheet-col-left-left sheet-thick-border">
                <h3 style="height: 40px;">Abilities</h3>
                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">STR</span>
                    <input class="ability-value" name="attr_strength" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_strength_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="ability-column-bonus">
                    <span>Mod</span>
                    <input name="attr_strength_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Melee AB, Athletics, Open Doors, Encumbrance, Fortitude</span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_str_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=STR Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{strength_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + @{strength_mod}]]}}"></button>
                  </div>
                  -->
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">DEX</span>
                    <input class="ability-value" name="attr_dexterity" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_dexterity_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <input name="attr_perk_inventory_mod" type="number" value="0" hidden="true"/>
                  <div class="ability-column-bonus">
                    <span>Mod</span>
                    <input name="attr_dexterity_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Ranged AB, Dodge, AC, Initiative, Stealth</span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_dex_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=DEX Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{dexterity_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dexterity_mod}]] ]]}}"></button>
                  </div>
                  -->
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">CON</span>
                    <input class="ability-value" name="attr_constitution" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_constitution_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="ability-column-bonus">
                    <span>Mod</span>
                    <input name="attr_constitution_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Health, Hit Points</span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_con_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CON Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{constitution_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{constitution_mod}]] ]]}}"></button>

                  </div>
                  -->
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">INT</span>
                    <input class="ability-value" name="attr_intelligence" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_intelligence_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="ability-column-bonus">
                    <span>Mod</span>
                    <input name="attr_intelligence_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Perception, Languages, Search, Magic Spell Casting, Skills </span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_int_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=INT Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{intelligence_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{intelligence_mod}]] ]]}}"></button>
                  </div>
                  -->
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">WIS</span>
                    <input class="ability-value" name="attr_wisdom" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_wisdom_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="ability-column-bonus">
                    <span>Mod</span>
                    <input name="attr_wisdom_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Willpower, Cleric Powers</span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_wis_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=WIS Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{wisdom_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{wisdom_mod}]] ]]}}"></button>
                  </div>
                  -->
                </div>

                <div class="sheet-flex">
                  <div class="sheet-ability-column-value">
                    <span style="font-size: 18px;">CHA</span>
                    <input class="ability-value" name="attr_charisma" type="number" value="10"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span class="ability-check-bonus-label">bonus</span>
                    <input type="number" name="attr_charisma_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                  </div>
                  <div class="sheet-ability-column-bonus">
                    <span style="font-size: 12px;">Mod</span>
                    <input name="attr_charisma_mod" type="number" value="0" class="sheet-ability-modifier inactive-color" readonly="true"/>
                  </div>
                  <div class="sheet-ability-column-modifier sheet-flex-between">
                    <span class="noborder left-pad">Ego, Retainer Recruitment, Loyalty, Reaction, Social Skill</span>
                  </div>
                  <!--
                  <div class="sheet-ability-column-roll sheet-flex">
                    <button class="sheet-ability-button" type="roll" name="roll_cha_check"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=CHA Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{charisma_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{charisma_mod}]] ]]}}"></button>
                  </div>
                  -->
                </div>
              </div>

              <div class="sheet-col-left-right sheet-save-col sheet-thick-border-no-pad">
                <h3 style="height: 30px;">Checks</h3>
                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_fortitude"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Fortitude Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{fortitude} + @{fort_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{fortitude}]] + [[@{fort_bonus}]] ]]}}">
                            <span class="ability-check-label">Fortitude</span>
                    </button>
                    <input name="attr_perk_fortitude" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                      <input class="ability-check-value inactive-color" name="attr_fortitude" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                      <span class="ability-check-bonus-label">bonus</span>
                      <input type="number" name="attr_fort_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>

                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_dodge"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dodge Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{dodge} + @{dodge_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{dodge}]] + [[@{dodge_bonus}]] ]]}}">
                            <span class="ability-check-label">Dodge</span>
                    </button>
                    <input name="attr_perk_dodge" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                        <input class="ability-check-value inactive-color" name="attr_dodge" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                        <span class="ability-check-bonus-label">bonus</span>
                        <input type="number" name="attr_dodge_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>

                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_health"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Health Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{health} +@{health_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{health}]] + [[@{health_bonus}]] ]]}}">
                            <span class="ability-check-label">Health</span>
                    </button>
                    <input name="attr_perk_health" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                        <input class="ability-check-value inactive-color" name="attr_health" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                        <span class="ability-check-bonus-label">bonus</span>
                        <input type="number" name="attr_health_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>

                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_perception"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Perception Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{perception} + @{per_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{perception}]] + [[@{per_bonus}]] ]]}}">
                            <span class="ability-check-label">Perception</span>
                    </button>
                    <input name="attr_perk_perception" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                        <input class="ability-check-value inactive-color" name="attr_perception" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                        <span class="ability-check-bonus-label">bonus</span>
                        <input type="number" name="attr_per_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>

                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_willpower"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Willpower Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{willpower} +@{will_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{willpower}]] +[[@{will_bonus}]] ]]}}">
                            <span class="ability-check-label">Willpower</span>
                    </button>
                    <input name="attr_perk_willpower" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                        <input class="ability-check-value inactive-color" name="attr_willpower" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                        <span class="ability-check-bonus-label">bonus</span>
                        <input type="number" name="attr_will_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>

                <div class="block" style="height: 90px;">
                  <div style="text-align: center;">
                    <button class="blank-roll-button narrow-button" type="roll" name="roll_ego"
                            value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Ego Check}} {{subheader=@{character_name}}} {{save=1}} {{math=roll: 1d20 + @{ego} + @{ego_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{ego}]] +[[@{ego_bonus}]] ]]}}">
                            <span class="ability-check-label">Ego</span>
                    </button>
                    <input name="attr_perk_ego" type="number" value="0" hidden="true"/>
                  </div>
                  <div class="sheet-flex-between">
                    <div class="sheet-ability-column-bonus">
                        <input class="ability-check-value inactive-color" name="attr_ego" type="number" value="0" readonly="true"/>
                    </div>
                    <div style="height: 50px;" class="sheet-ability-column-value">
                        <span class="ability-check-bonus-label">bonus</span>
                        <input type="number" name="attr_ego_bonus" class="sheet-ability-bonus-value sheet-purple-border" value="0"/>
                    </div>
                  </div>
                </div>


              </div>
            </div>


          </div>

          <div class="sheet-col-right">
            <div class="sheet-noborder">
              <div class="sheet-thick-border">
                <h3>Skills</h3>
                <div class="sheet-bold-font center">
                  <span class="med-small-font">Points Available:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_skill_points" value="0" readonly="true"/>
                  </span>
                  <input type="checkbox" class="sheet-skill-points-overspent" name="attr_skill_points_overspent" value="0" hidden="true" checked="true"/>
                  <input type="checkbox" class="sheet-skill-points-underspent" name="attr_skill_points_underspent" value="0" hidden="true" checked="true"/>
                  <span class="sheet-skill-points-overspend-notify sheet-skill-points-underspent-notify med-small-font">Points Spent:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_skill_points_used" value="0" readonly="true"/>
                  </span>
                  <input type="checkbox" class="sheet-max-skill-value-exceeded" name="attr_max_skill_value_exceeded" value="0" hidden="true" checked="true"/>
                  <span class="sheet-max-skill-value-exceeded-notify med-small-font">Max Skill Value:
                    <input type="number" class="sheet-inactive-color no-border info-name-tiny" name="attr_max_skill_value_allowed" value="0" readonly="true"/>
                  </span>
                </div>
                <div class="sheet-block">
                  <div class="sheet-block">
                    <div class="sheet-thin-border sheet-bottom-padding">
                      <h4>Skills</h4>
                      <div class="sheet-flex-between">
                        <div class="sheet-block sheet-side-padding">

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Arcana</span>
                              <input type="number" name="attr_arcana_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_arcana_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_arcana"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Arcana Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{arcana_skill} + @{arcana_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{arcana_skill}]] +[[@{arcana_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Architect</span>
                              <input type="number" name="attr_architect_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_architect_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_architect"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Architect Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{architect_skill} + @{architect_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{architect_skill}]] + [[@{architect_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block-between">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Armory</span>
                              <input type="number" name="attr_armory_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_armory_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_armory"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Armory Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{armory_skill} + @{armory_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{armory_skill}]] + [[@{armory_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Athletics</span>
                              <input type="hidden" name="attr_athletics_skill_mod" value="0"/>
                              <input type="number" name="attr_athletics_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_athletics_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_athletics"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Athletics Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{athletics_skill} + (@{athletics_bonus} bonus) + (@{athletics_skill_mod} STR/DEX mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{athletics_skill} + @{athletics_bonus} + @{athletics_skill_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Bushcraft</span>
                              <input type="number" name="attr_bushcraft_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_bushcraft_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_bushcraft"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Bushcraft Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{bushcraft_skill} +@{bushcraft_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{bushcraft_skill}]] + [[@{bushcraft_bonus}]]]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Languages</span>
                              <input type="number" name="attr_languages_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_languages_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_languagues"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Languages Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{languages_skill} + (@{languages_bonus} bonus) + (@{intelligence_mod} INT mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{languages_skill} + @{languages_bonus} + @{intelligence_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Open&nbsp;Doors</span>
                              <input type="number" name="attr_open_door_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_open_door_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_opendoor"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Open Doors Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{open_door_skill} + @{open_door_bonus} bonus +(@{strength_mod} STR mod) }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{open_door_skill} + @{open_door_bonus} @{strength_mod}]] ]]}}"></button>
                            </div>
                          </div>
                        </div>

                        <div class="sheet-block sheet-side-padding">
                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Search</span>
                              <input type="number" name="attr_search_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_search_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_search"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Search Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{search_skill} + @{search_bonus} bonus + (@{intelligence_mod} INT mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{search_skill} + @{search_bonus} +@{intelligence_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Sleight of Hand</span>
                              <input type="number" name="attr_sleight_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_sleight_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_sleight"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Sleight of Hand Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{sleight_skill} +@{sleight_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{sleight_skill}]] +@{sleight_bonus}]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-left">
                              <span class="sheet-bold-font">&nbsp;&nbsp;&nbsp; Sneak Attack</span>
                              <input type="number" name="attr_sneak_attack_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_sneak_atkbonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
    		                      <span>&nbsp;&nbsp;</span>
    		                      <span>&nbsp;&nbsp;</span>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Stealth</span>
                              <input type="number" name="attr_stealth_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_stealth_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_stealth"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Stealth Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{stealth_skill} + @{stealth_bonus} bonus + (@{dexterity_mod} DEX mod) }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{stealth_skill} + @{stealth_bonus} +@{dexterity_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <input type="text" class="sheet-primary-skill-name" name="attr_social_skill_name" value="" data-i18n-placeholder="Social (rename)"/>
                              <input type="number" name="attr_social_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_social_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_stealth"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{social_skill_name} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{social_skill} + @{social_skill_bonus} bonus + (@{charisma_mod} CHA mod)}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{social_skill} + @{social_skill_bonus} + @{charisma_mod}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Theology</span>
                              <input type="number" name="attr_theology_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_theology_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_theology"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Theology Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{theology_skill} + @{theology_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{theology_skill}]] + [[@{theology_bonus}]] ]]}}"></button>
                            </div>
                          </div>

                          <div class="sheet-block">
                            <div class="sheet-align-right">
                              <span class="sheet-bold-font">Tinker</span>
                              <input type="number" name="attr_tinker_skill" class="sheet-bold-font" value="0"/>
                              <input type="number" name="attr_tinker_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                              <button class="sheet-skill-button" type="roll" name="roll_tinker"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Tinker Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{tinker_skill} +@{tinker_bonus}}} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{tinker_skill}]] +[[@{tinker_bonus}]] ]]}}"></button>
                            </div>
                          </div>

                        </div>
                      </div>

                    </div>
                  </div>

                  <div class="sheet-thin-border">
                    <h4>Additional Skills</h4>
                    <fieldset class="repeating_skills">
                      <div class="sheet-block sheet-thin-border sheet-side-padding">
                        <div class="sheet-align-right">
                          <input type="text" name="attr_skillname" class="sheet-bottom-line sheet-skillname"/>
                          <input type="number" name="attr_skillvalue" class="sheet-bold-font" value="1"/>
                          <input type="number" name="attr_skill_bonus" class="sheet-skill-bonus-value sheet-purple-border" value="0"/>
                          <button class="sheet-skill-button" type="roll" name="roll_skill"
                                  value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{skillname} Skill Check}} {{subheader=@{character_name}}} {{skill=1}} {{math=roll: 1d20 + @{skillvalue} +@{skill_bonus} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{skillvalue}]] +[[@{skill_bonus}]] ]]}}"></button>
                        </div>
                      </div>
                   </fieldset>
                 </div>
               </div>
             </div>

             <div class="sheet-inline">
               <div class="sheet-thick-border">
                 <h3>Languages</h3>
                 <div class="center">
                    <label class="italic-font centered-label"><span>Max known lanaguages allowed: </span><span name="attr_max_languages_allowed"/></label>
                    &nbsp;
                 </div>
                 <div class="sheet-flex-between">
                   <div class="sheet-col-right">
                     <h4>Known Languages</h4>
                     <textarea class="sheet-tiny-textarea" spellcheck="false" name="attr_known_lang" data-i18n-placeholder="known_lang"></textarea>
                   </div>
                   <div class="sheet-col-left">
                     <h4>Not Known Languages</h4>
                     <textarea class="sheet-tiny-textarea" spellcheck="false" name="attr_not_known_lang" data-i18n-placeholder="not_known_lang"></textarea>
                   </div>
                 </div>
               </div>
             </div>
            </div>
          </div>
        </div>
      </div>


      <div class="sheet-section-combat">
        <span class="sheet-spacer">&nbsp;</span>

        <div class="sheet-thick-border-no-pad">
          <h3>Combat</h3>
          <span class="sheet-spacer">&nbsp;</span>

          <h4 class="bold-font">Combat Stats</h4>
          <div class="sheet-thin-border padding">
            <div class="sheet-flex left-pad bottom-padding">
              <div class="sheet-ability-column-value">
                <div class="sheet-thin-border sheet-flex left-pad">
      	           <button type="roll" class="sheet-initiative" name="roll_initiative"
      			               value="&{template:roll_check} {{title=Initiative}} {{subheader=@{character_name}}} {{initiative=1}} {{rollname=Initiative}} {{roll=[[ 1d20 + @{initiative_bonus} [Initiative Mod] &{tracker} ]]}}">Roll Init.</button>
                  <input class="ability-check-value-wide inactive-color" name="attr_initiative_bonus" type="number" value="0" readonly="true"/>
                </div>
                <span class="ability-check-label">Initiative Bonus</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_ac" type="number" value="10" readonly="true"/>
                <span class="ability-check-label">AC</span>
              </div>
              <div class="sheet-ability-column-value">
                <div class="sheet-flex sheet-thin-border sheet-right-pad">
                  <input class="ability-check-value" name="attr_hp" type="number" value="1"/>
                  /
                  <input class="ability-check-value" name="attr_hp_max" type="number" value="1"/>
                </div>
                <span class="ability-check-label">HP / Max HP</span>
                <br/>
                <input type="number" name="attr_healing_rate" value="0" hidden="true"/>
                <label class="ability-check-label small-font">(healing rate: <span name="attr_healing_rate"></span> HP/day)</label>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_melee_ab" type="number" value="0" readonly="true"/>
                <input name="attr_melee_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Melee AB</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_ranged_ab" type="number" value="0" readonly="true"/>
                <input name="attr_ranged_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Ranged AB</span>
              </div>
              <div class="sheet-ability-column-value">
                <input class="ability-check-value inactive-color" name="attr_unarmed_ab" type="number" value="0" readonly="true"/>
                <input name="attr_unarmed_base_ab" type="number" value="0" hidden="true"/>
                <span class="ability-check-label">Unarmed AB</span>
              </div>

              <input name="attr_hit_dice" type="number" value="1" hidden="true"/>
              <input name="attr_hit_dice_max" type="number" value="1" hidden="true"/>
            </div>
          </div>

          <span class="sheet-spacer">&nbsp;</span>
          <div class="sheet-bottom-padding"><h4 class="bold-font">Combat Options</h4></div>

          <div class="sheet-thin-border padding">
            <div class="sheet-flex center">
              <input type="checkbox" class="sheet-max-copts-value-exceeded" name="attr_max_cmbt_opts_exceeded" value="0" hidden="true" checked="true"/>
              <span class="max-copts-value-exceeded-notify med-font italic-font">Additional Combat Options Allowed:
		      &nbsp;
                <input type="number" class="sheet-inactive-color info1 center info-name-tiny" name="attr_max_cmbt_opts_allowed" value="0" readonly="true"/>
              </span>
		      &nbsp;
		      &nbsp;
              <input type="checkbox" class="sheet-copts-value-underspent" name="attr_cmbt_opts_underspent" value="0" hidden="true" checked="true"/>
              <span class="sheet-copts-value-underspent-notify med-font italic-font">Additional Combat Options Used:
		      &nbsp;
               <input type="number" class="sheet-inactive-color info1 center info-name-tiny" name="attr_cmbt_opts_used" value="0" readonly="true"/>
              </span>
            </div>

            <div class="sheet-flex-between">
              <div class="sheet-inline sheet-side-padding">
                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_stnd_attack" value="1" checked="checked" readonly="true"/>
                  <span class="ability-check-label">Stnd</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+0 AC+0)</span>
                </div>
                <div class="sheet-bottom-padding">
                  <div class="sheet-flex">
                    &nbsp;&nbsp;
                    <span class="ability-check-label">Parry / Defend</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(do nothing but defend)</span>
                  </div>
                  <div class="sheet-flex">
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <span><input type="radio" class="inactive-color" name="attr_parry_attack" value="0" checked="checked" readonly="true"/>AC+2</span>
                    <span><input type="radio" class="inactive-color" name="attr_parry_attack" value="1" readonly="true"/>AC+4</span>
                  </div>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_charge_attack" value="1" readonly="true"/>
                  <span class="ability-check-label">Charge</span>
                  <div class="sheet-block">
                    <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+2, 2x dam, must move full move to target. Braced targets may cause 2x dam to attacker.)</span>
                  </div>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input type="checkbox" name="attr_press_attack" value="1" readonly="true"/>
                  <span class="ability-check-label">Press</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+2, Fort save vs dam+10 or force 1 step retreat. AC penalty.)</span>
                </div>

                <div class="sheet-thin-border sheet-flex-between">
                  <input type="checkbox" name="attr_sneak_attack_checkbox" value="1" readonly="true"/>
                  <span class="ability-check-label centered-label right-pad">Sneak Attack</span>
                  <span class="sheet-italic-font centered-label right-pad">Extra Dam. Dice</span>
                  <input class="sheet-inactive-color sheet-ability-check-sm-value" name="attr_sneak_attack_dice" type="number" value="0" readonly="true"/>
                </div>

              </div>

              <div class="sheet-inline sheet-side-padding">

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" class="sheet-add-cmbt-opt" type="checkbox" name="attr_feint_attack" value="1"/>
                  <span class="ability-check-label">Aim/Feint</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(+4 AB, -4 Init, AC penalty)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" class="sheet-add-cmbt-opt" type="checkbox" name="attr_berserk_attack" value="1"/>
                  <span class="ability-check-label">Berserk</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB+2+Fghtr/4, Dam+2+Fghtr/4, No retreat, Will to Stop, AC pen.)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_cleave_attack" value="1"/>
                  <span class="ability-check-label">Cleave</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB/2 -&gt; Dam, Attack adj foe on kill, AC penalty)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" class="sheet-add-cmbt-opt" type="checkbox" name="attr_disarm_attack" value="1"/>
                  <span class="ability-check-label">Disarm</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Target Fort save vs dam+10 or drop held item, AB-4, AC penalty)</span>
                </div>

                <input type="checkbox" class="sheet-cleave_attack_enabled2" name="attr_cleave_attack_enabled2" value="1" hidden="true"/>
                <div class="sheet-section-great_cleave sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" class="sheet-add-cmbt-opt" type="checkbox" name="attr_great_cleave_attack" value="1"/>
                  <span class="ability-check-label">Great Cleave</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB -&gt; Dam, Attack adj foe on kill, AC penalty)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" class="sheet-add-cmbt-opt" type="checkbox" name="attr_lightning_attack" value="1"/>
                  <span class="ability-check-label">Lightning Strike</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(-4 AB, +4 Init, AC penalty)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_rapid_strike_attack1" value="1"/>
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_rapid_strike_attack2" value="1"/>
                  <span class="ability-check-label">Rapid Strike</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Xtra Melee Attk, AC penalty)</span>
                </div>
              </div>

              <div class="sheet-inline sheet-side-padding">
                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_rapid_shot_attack1" value="1"/>
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_rapid_shot_attack2" value="1"/>
                  <span class="ability-check-label">Rapid Shot</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Xtra Ranged Attk, AC penalty)</span>
                </div>

                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_shield_bash_attack" value="1"/>
                  <span class="ability-check-label">Shield Bash</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(May make a 2nd attack w/ shield which may knock down or push back opponent.)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_strong_attack" value="1"/>
                  <span class="ability-check-label">Strong</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(Dam x2, AB-4, AC penalty)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_stun_attack" value="1"/>
                  <span class="ability-check-label">Stun</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(AB-4, AC penalty, target Fort save vs dam+10 or stun)</span>
                </div>
                <div class="sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_two_attack_attack" value="1"/>
                  <span class="ability-check-label">Two Weapon Attack</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(2nd Attk w/ small offhand weapon or AC+1)</span>
                </div>
                <input type="checkbox" class="sheet-two_attack_attack_enabled"  name="attr_two_attack_attack_enabled" value="1" hidden="true"/>
                <div class="sheet-section-two_attack_master sheet-flex sheet-bottom-padding">
                  <input class="sheet-add-cmbt-opt" type="checkbox" name="attr_two_attack_master_attack" value="1"/>
                  <span class="ability-check-label">Two Weapon Master</span>
                  <span class="sheet-small-font sheet-italic-font sheet-flex-between">&nbsp;(2nd Attk with offhand weapon or AC+2)</span>
                </div>
              </div>

            </div>
          </div>

          <span class="sheet-spacer">&nbsp;</span>
          <!--span class="label" style="margin-top: 0px; position: absolute; bottom: 0px;" data-i18n="atk-spellcasting-u">ATTACKS & SPELLCASTING</span-->
          <div class="sheet-bottom-padding"><h4 class="bold-font">Attacks</h4></div>

          <div class="thin-border padding">

            <div class="sheet-flex center">
              <input type="checkbox" class="sheet-max-prof-value-exceeded" name="attr_max_prof_numb_exceeded" value="0" hidden="true" checked="true"/>
              <span class="max-prof-value-exceeded-notify med-font italic-font">Weapon Proficiencies Allowed:
		&nbsp;
                <input type="number" class="sheet-inactive-color center info1 info-name-tiny" name="attr_max_prof_allowed" value="0" readonly="true"/>
              </span>

              <input type="checkbox" class="sheet-prof-value-underspent" name="attr_prof_underspent" value="0" hidden="true" checked="true"/>
    	       &nbsp; &nbsp;
              <span class="sheet-prof-value-underspent-notify med-font italic-font">Weapon Proficiencies Used:
		&nbsp;
                <input type="number" class="sheet-inactive-color center info1 info-name-tiny" name="attr_prof_used" value="0" readonly="true"/>
              </span>

              <input type="checkbox" class="sheet-max-prof-level-exceeded" name="attr_max_prof_level_exceeded" value="0" hidden="true" checked="true"/>
              <span class="max-prof-level-exceeded-notify med-font italic-font">Max Prof Level:
                <input type="number" name="attr_max_prof_level_allowed" value="0" hidden="true"/>
                <input type="text" class="info3 align-left" name="attr_max_prof_level_name" value="Skilled" readonly="true"/>
              </span>
            </div>

            <!-- TODO -->
            <input type="hidden" class="ammoflag" name="attr_ammotracking">
            <input type="number" name="attr_berserk_attack_mod" value="2" hidden="true"/>

            <div class="attacks border-red" style="position: relative;">
                <div class="top">
                    <div class="inline-block">
                      <div>
                        <span class="sheet-spacer"></span>
                      </div>
                      <div class="flex">
                        <span class="label" style="width: 42px; margin-left: 8px;" data-i18n="notch-u">NOTCHES</span>
                        <span class="label" style="width: 42px;" data-i18n="proflevel-u">PROF LVL</span>
                        <span class="label" style="width: 115px;" data-i18n="name-u">NAME</span>
                        <span class="label" style="width: 65px; text-align: center;" data-i18n="atk-form-u">FORM</span>
                        <span class="label" style="width: 25px; text-align: center;" data-i19n="atk-bonus-u">ATK</span>
                        <span class="label" style="width: 55px; text-align: center;" data-i18n="atk-dmg-u">DAMAGE</span>
                        <span class="label" style="width: 70px; text-align: center;" data-i18n="atk-dmg-type-u">DAM/TYPE</span>
                      </div>
                    </div>

                    <div class="flex">
                      <span class="label" style="width: 30px; margin-left: 17px; text-align: center;" data-i18n="atk-standard-u">STND ATK</span>

                      <input type="checkbox" class="sheet-berserk_attack_enabled" name="attr_berserk_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-charge_attack_enabled" name="attr_charge_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-cleave_attack_enabled" name="attr_cleave_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-disarm_attack_enabled" name="attr_disarm_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-great_cleave_attack_enabled" name="attr_great_cleave_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-feint_attack_enabled" name="attr_feint_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-press_attack_enabled" name="attr_press_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-lightning_attack_enabled" name="attr_lightning_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-strong_attack_enabled" name="attr_strong_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-stun_attack_enabled" name="attr_stun_attack_enabled" value="1" hidden="true"/>
                      <input type="checkbox" class="sheet-sneak_attack_enabled" name="attr_sneak_attack_enabled" value="1" hidden="true"/>

                      <div class="sheet-press_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-press-u">PRESS ATK</span>
                      </div>

                      <div class="sheet-charge_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-charge-u">CHARGE ATK</span>
                      </div>

                      <div class="sheet-berserk_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-berserk-u">BERSERK ATK</span>
                      </div>

                      <div class="sheet-cleave_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-cleave-u">Cleave ATK</span>
                      </div>

                      <div class="sheet-disarm_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-disarm-u">Disarm ATK</span>
                      </div>

                      <div class="sheet-great_cleave_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-gcleave-u">Great Cleave ATK</span>
                      </div>

                      <div class="sheet-feint_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-aim-u">AIM/FEINT ATK</span>
                      </div>

                      <div class="sheet-lightning_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-lightstrike-u">LIGTHNING STRIKE ATK</span>
                      </div>

                      <div class="sheet-strong_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-strong-u">STRONG ATK</span>
                      </div>

                      <div class="sheet-stun_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-stun-u">STUN ATK</span>
                      </div>

                      <div class="sheet-sneak_attack_section">
                        <span class="label" style="width: 30px; text-align: center; margin-left: 9px;" data-i18n="atk-sneak-u">SNEAK ATK</span>
                      </div>

                    </div>

                </div>
                <fieldset class="repeating_attacks">

                    <div class="attack">
                        <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                        <div class="options">
                            <input type="checkbox" name="attr_atkflag" value="{{attack=1}}" checked="checked" hidden="True"/>
                            <div class="row">
                                <span style="margin-left: 17px;" data-i18n="range:-u">RANGE:</span>
                                <input type="text" name="attr_atkrange" placeholder="Self (60-foot cone)" style="width: 170px;" data-i18n-placeholder="range-place">
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;" data-i18n="magic-bonus:-u">MAGIC BONUS:</span>
                                <input type="number" class="num" name="attr_atkmagic" value="0" placeholder="0">
			    <!--
                                <span data-i18n="crit-range-u">CRIT RANGE:</span>
			    -->
                            </div>
                            <div class="row">
                                <input type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmg1flag=1}}" checked="checked">
                                <span data-i18n="damage:-u">DAMAGE:</span>
                                <input name="attr_attack_dam" value="0" hidden="true"/>
                                <input type="text" name="attr_dmgbase" placeholder="1d6" style="width: 50px;"/>
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;" data-i18n="type:-u">TYPE:</span>
                                <select name="attr_dmgtype" style="width: 50px;">
                                  <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                  <option value="Piercing">Pierce</option>
                                  <option value="Slashing">Slash</option>
                                  <option value="Acid">Acid</option>
                                  <option value="Cold">Cold</option>
                                  <option value="Fire">Fire</option>
                                  <option value="Force">Force</option>
                                  <option value="Lightning">Lightning</option>
                                  <option value="Necrotic">Necrotic</option>
                                  <option value="Poison">Poison</option>
                                  <option value="Psychic">Psychic</option>
                                  <option value="Radiant">Radiant</option>
                                  <option value="Thunder">Thunder</option>
                                </select>

                                <input type="number" name="attr_attack_proficiency_dam_bonus" value="0" hidden="true"/>
                                <input type="number" name="attr_attack_cmbt_option_ac_penalty" value="-4" hidden="true"/>
                                <input type="number" name="attr_attack_crit_range_adj" value="0" hidden="true"/>
                                <input type="number" name="attr_attack_crit_number" value="20" hidden="true"/>
                                <input type="text" style="display: none;" name="attr_sneak_attack_dam" value="0" hidden="true"/>

                                <span data-i18n="crit:-u">CRIT:</span>
                                <input type="text" name="attr_dmgcustcrit" placeholder="1d6" style="width: 80px;">
                            </div>
			    <!--
                            <div class="row">
                                <input type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}"/>
                                <span data-i18n="damage2:-u">DAMAGE2:</span>
                                <input type="text" name="attr_dmg2base" placeholder="1d6" style="width: 50px;"/>
                                <span>+</span>
                                <select name="attr_dmg2attr">
                                    <option value="@{strength_mod}" data-i18n="str-u">STR</option>
                                    <option value="@{dexterity_mod}" data-i18n="dex-u">DEX</option>
                                    <option value="@{constitution_mod}" data-i18n="con-u">CON</option>
                                    <option value="@{intelligence_mod}" data-i18n="int-u">INT</option>
                                    <option value="@{wisdom_mod}" data-i18n="wis-u">WIS</option>
                                    <option value="@{charisma_mod}" data-i18n="cha-u">CHA</option>
                                    <option value="spell" data-i18n="spell-u">SPELL</option>
                                    <option value="0" selected="selected">-</option>
                                </select>
                                <span>+</span>
                                <input type="text" class="num" name="attr_dmg2mod" placeholder="0">
                            </div>
                            <div class="row">
                                <span style="margin-left: 17px;" data-i18n="type:-u">TYPE:</span>
                                <select name="attr_dmg2type">
                                  <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                  <option value="Piercing">Pierce</option>
                                  <option value="Slashing">Slash</option>
                                  <option value="Acid">Acid</option>
                                  <option value="Cold">Cold</option>
                                  <option value="Fire">Fire</option>
                                  <option value="Force">Force</option>
                                  <option value="Lightning">Lightning</option>
                                  <option value="Necrotic">Necrotic</option>
                                  <option value="Poison">Poison</option>
                                  <option value="Psychic">Psychic</option>
                                  <option value="Radiant">Radiant</option>
                                  <option value="Thunder">Thunder</option>
                                </select>

                                <span data-i18n="dam-bonus:-u">CRIT:</span>
                                <input type="number" name="attr_attack_dam_bonus" class="attack-param bold-font inactive-color"
                                                     value="[[@{strength_mod}+@{atkmagic}+@{attack_proficiency_dam_bonus}]]" disabled="true" hidden="true"/>

                                <span data-i18n="crit:-u">CRIT:</span>
                                <input type="text" name="attr_dmg2custcrit" placeholder="1d6" style="width: 80px;">
                            </div>
			    -->
                            <div class="row">
                                <input type="checkbox" name="attr_saveflag" value="{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]][SAVE]]]}}">
                                <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                <select name="attr_saveattr">
                                    <option value="Strength" selected="selected" data-i18n="str-u">STR</option>
                                    <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                    <option value="Constitution" data-i18n="con-u">CON</option>
                                    <option value="Intelligence" data-i18n="int-u">INT</option>
                                    <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                    <option value="Charisma" data-i18n="cha-u">CHA</option>
                                </select>
                                <span data-i18n="vs-dc:-u">VS DC:</span>
                                <select name="attr_savedc">
                                    <option value="(@{spell_save_dc})" selected="selected" data-i18n="spell-u">SPELL</option>
                                    <option value="(@{strength_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="str-u">STR</option>
                                    <option value="(@{dexterity_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="dex-u">DEX</option>
                                    <option value="(@{constitution_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="con-u">CON</option>
                                    <option value="(@{intelligence_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="int-u">INT</option>
                                    <option value="(@{wisdom_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="wis-u">WIS</option>
                                    <option value="(@{charisma_mod}+8+@{spell_dc_mod}+@{pb})" data-i18n="cha-u">CHA</option>
                                    <option value="(@{saveflat})" data-i18n="flat-u">FLAT</option>
                                </select>
                                <input class="flatflag" type="hidden" name="attr_savedc">
                                <input class="num flat" type="text" name="attr_saveflat" placeholder="10" value="10">
                            </div>
                            <div class="row">
                                <span data-i18n="save-effect:-u">SAVE EFFECT:</span>
                                <input type="text" name="attr_saveeffect" placeholder="half damage" style="width: 160px;" data-i18n-placeholder="save-effect-place">
                            </div>
                            <div class="row ammo">
                                <span data-i18n="ammunition:-u">AMMUNITION:</span>
                                <input type="text" name="attr_ammo" placeholder="Arrows" style="width: 160px;" data-i18n-placeholder="ammunition-place">
                            </div>
                            <div class="row">
                                <span data-i18n="description:-u">DESCRIPTION:</span>
                                <textarea name="attr_atk_desc" style="width: 90%;" placeholder="Up to 2 creatures within 5 feet" data-i18n-placeholder="description-place"></textarea>
                            </div>
                        </div>

                        <div class="display">

                          <input type="checkbox" class="sheet-attack_berserk_attack_enabled" name="attr_attack_berserk_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_cleave_attack_enabled" name="attr_attack_cleave_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_charge_attack_enabled" name="attr_attack_charge_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_disarm_attack_enabled" name="attr_attack_disarm_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_great_cleave_attack_enabled" name="attr_attack_great_cleave_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_feint_attack_enabled" name="attr_attack_feint_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_press_attack_enabled" name="attr_attack_press_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_lightning_attack_enabled" name="attr_attack_lightning_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_sneak_attack_enabled" name="attr_attack_sneak_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_strong_attack_enabled" name="attr_attack_strong_attack_enabled" value="1" hidden="true"/>
                          <input type="checkbox" class="sheet-attack_stun_attack_enabled" name="attr_attack_stun_attack_enabled" value="1" hidden="true"/>

                          <input type="text" name="msg" value="" hidden="true"/>

                          <input type="checkbox" class="sheet-attack-is-weapon-attack" name="attr_attack_is_weapon_attack" value="1" hidden="true"/>
                          <div class="sheet-section-weapon-proficiency flex">
                            <select class="attack-notches" name="attr_attack_notches">
                              <option selected="selected" value="0">--</option>
                              <option value="1">1 - Slightly Damaged</option>
                              <option value="2">2 - Damaged</option>
                              <option value="3">3 - Badly Damaged</option>
                            </select>

                            <select class="attack-proficiency" name="attr_attack_proficiency_level"
                                    onchange="this.className=this.options[this.selectedIndex].className">
                              <option selected="selected" value="0">--</option>
                              <option value="1">Skilled</option>
                              <option value="2">Proficient</option>
                              <option value="3">Master</option>
                              <option value="4">Grand Master</option>
                            </select>
                          </div>
                          <div class="sheet-section-non-weapon-proficiency flex">
                            <span class="attack-notches">N/A</span>
                            <span class="attack-proficiency">N/A</span>
                          </div>

                          <input type="number" name="attr_atkbonus" value="0" hidden="true"/>
                          <input type="number" name="attr_attack_proficiency_dam_bonus" value="0" hidden="true"/>
                          <input type="number" name="attr_attack_dam_bonus"
                                               value="[[@{strength_mod}+@{atkmagic}+@{attack_proficiency_dam_bonus}]]" disabled="true" hidden="true"/>

                          <input type="text" name="attr_atkname" style="width: 119px;">
                          <select name="attr_attack_form" style="width: 68px; font-size: 10px;">
                            <option selected="selected" value="melee">Melee</option>
                            <option value="ranged">Ranged</option>
                            <option value="unarmed">Unarmed</option>
                            <option value="spell">Spell</option>
                          </select>
                          <span name="attr_atkbonus" style="width: 25px; text-align: center;"></span>
                          <span name="attr_attack_dam" style="width: 45px; text-align: center"></span>

                          <input name="attr_attack_damage_msg" value="" hidden="true"/>

			                    <select name="attr_dmgtype" style="width: 80px;">
                              <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                              <option value="Piercing">Pierce</option>
                              <option value="Slashing">Slash</option>
                              <option value="Acid">Acid</option>
                              <option value="Cold">Cold</option>
                              <option value="Fire">Fire</option>
                              <option value="Force">Force</option>
                              <option value="Lightning">Lightning</option>
                              <option value="Necrotic">Necrotic</option>
                              <option value="Poison">Poison</option>
                              <option value="Psychic">Psychic</option>
                              <option value="Radiant">Radiant</option>
                              <option value="Thunder">Thunder</option>
                          </select>

			                    <div>
                              <button type="roll" class="attack-button black-border" style="margin-left: 8px;"
                                      name="roll_attack" value=@{rollbase}"/>
                          </div>

			  <!-- TODO: Fix d20, rtype -->
			  <input type="hidden" name="attr_d20" value="d20"/>
			  <input type="hidden" name="attr_rtype" value="{{always=1}} {{r2=[[@{d20}"/>

			  <input type="hidden" name="attr_rollbase"
				 value="&{template:roll_check} {{character_name=@{character_name}}} ammo=@{ammo} {{name=@{atkname}}} {{innate=}} {{spelllevel={@spelllevel}}} {{title=@{atkname} <b>Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] ]]}} {{critical=[[19 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=}}"
			  />

			  <!--
					       value = "@{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{spell=1}} {{charname=@{character_name}}} {{rname=@{atkname}}} {{r1=[[${r1}cs>@{atkcritrange}${hbonus}]]}} ${r2}cs>@{atkcritrange}${hbonus}]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[${hdmg1}]]}} {{dmg1type=${dmgtype}}} {{crit1=[[${crit1}[CRIT]]]}} {{crit2=[[${crit2}[CRIT]]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg} ${hldmgcrit} {{level=@{spelllevel}}} {{innate=@{spell_innate}}} ammo=@{ammo} @{charname_output} {{licensedsheet=@{licensedsheet}}}"


				 value="&{template:roll_check} {{character_name=@{character_name}}} ammo=@{ammo} {{name=@{atkname}}} {{innate=}} {{spelllevel={@spelllevel}}} {{title=@{atkname} <b>Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] ]]}} {{critical=[[19 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=}}"

			  @{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{rname=@{atkname}}} {{r1=[[${r1}cs>@{atkcritrange}${hbonus}]]}} ${r2}cs>@{atkcritrange}${hbonus}]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[${hdmg1}]]}} {{dmg1type=${dmgtype}}} {{crit1=[[${crit1}[CRIT]]]}} {{crit2=[[${crit2}[CRIT]]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg} ${hldmgcrit} {{spelllevel=@{spelllevel}}} {{innate=@{spell_innate}}} ammo=@{ammo} @{charname_output} {{licensedsheet=@{licensedsheet}}}"

			  -->

                          <input type="hidden" name="attr_rollbase_dmg"/>
                          <input type="hidden" name="attr_rollbase_crit"/>

                          <input type="hidden" name="attr_hldmg"/>
                          <input type="hidden" name="attr_spelllevel"/>
                          <input type="hidden" name="attr_spell_save_dc"/>
                          <input type="hidden" name="attr_itemid"/>
                          <input type="hidden" name="attr_spellid"/>
                          <input type="hidden" name="attr_spell_innate" value=""/>
                          <input type="hidden" name="attr_versatile_alt"/>
                          <input type="text" class="num" name="attr_atkcritrange" value="20" hidden="True">

                          <div class="sheet-attack_press_attack_section">
                            <input type="checkbox" class="sheet-attack-press-attack-button-show" name="attr_attack_press_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-press-attack-button-enabled">
                              <button class="attack-button nod20 sheet-red-border" type="roll" name="roll_press_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Press Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] + 2 ]]}} {{critical=[[21 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[4+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] + 2 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=Fort save vs DC: damage +10 or force 1 step retreat. @{attack_cmbt_option_ac_penalty} AC penalty next round.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-press-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_charge_attack_section">
                            <input type="checkbox" class="sheet-attack-charge-attack-button-show" name="attr_attack_charge_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="attack-charge-attack-button-enabled">
                              <button type="roll" class="attack-button nod20 orange-border" name="roll_charge_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Charge Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] +2 ]]}} {{critical=[[21 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[4+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] +2 [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} [Dam] }} {{description=Must move full move to attack. Braced opponents w/ long attacks immediately counterattack.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="attack-charge-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_berserk_attack_section">
                            <input type="checkbox" class="sheet-attack-berserk-attack-button-show" name="attr_attack_berserk_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-berserk-attack-button-enabled">
                              <button class="attack-button nod20 sheet-yellow-border" type="roll" name="roll_berserk_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Berserk Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] + [[@{berserk_attack_mod}]] ]]}} {{critical=[[19 + @{atkbonus} -@{attack_crit_range_adj}+ [[@{berserk_attack_mod}]] ]]}} {{fumble=[[2+@{atkbonus} + [[@{berserk_attack_mod}]] ]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} ]]}}   {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} ]]}}  {{math=1d20 + [[@{atkbonus}]] + @{berserk_attack_mod} [Attk], @{attack_dam} + @{attack_dam_bonus} + @{berserk_attack_mod} [Dam] }} {{description=Will vs DC 12 to stop. No Retreat. @{attack_cmbt_option_ac_penalty} AC penalty for next rnd.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-berserk-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_cleave_attack_section">
                            <input type="checkbox" class="sheet-attack-cleave-attack-button-show" name="attr_attack_cleave_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-cleave-attack-button-enabled">
                              <button class="attack-button nod20 sheet-blue-border" type="roll" name="roll_cleave_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Cleave Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] ]]}} {{critical=[[19 + @{atkbonus} -@{attack_crit_range_adj}]]}} {{fumble=[[2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{atkbonus}/2 ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{atkbonus}/2 ]]}} {{math=1d20 + [[@{atkbonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} + [[@{atkbonus}/2]] [Dam] }} {{description=@{attack_cmbt_option_ac_penalty} AC penalty for next round}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-cleave-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_disarm_attack_section">
                            <input type="checkbox" class="sheet-attack-disarm-attack-button-show" name="attr_attack_disarm_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-disarm-attack-button-enabled">
                              <button class="attack-button nod20 blue-border" type="roll" name="roll_disarm_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Disarm Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] - 4 ]]}} {{critical=[[15 + @{atkbonus} -@{attack_crit_range_adj}]]}} {{fumble=[[-2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] - 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=Target Fort save vs dam+10 or drop held item. @{attack_cmbt_option_ac_penalty} AC penalty next round.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-disarm-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_great_cleave_attack_section">
                            <input type="checkbox" class="sheet-attack-great-cleave-attack-button-show" name="attr_attack_great_cleave_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-great-cleave-attack-button-enabled">
                              <button class="attack-button nod20 sheet-blue-border" type="roll" name="roll_great_cleave_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Great Cleave Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] ]]}} {{critical=[[19 + @{atkbonus}-@{attack_crit_range_adj}]]}} {{fumble=[[2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{atkbonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{atkbonus} ]]}} {{math=1d20 + [[@{atkbonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} + @{atkbonus} [Dam] }} {{description=-@{attack_cmbt_option_ac_penalty} AC penality for next round}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-great-cleave-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_feint_attack_section">
                            <input type="checkbox" class="sheet-attack-feint-attack-button-show" name="attr_attack_feint_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-feint-attack-button-enabled">
                              <button class="attack-button nod20 sheet-blue-border" type="roll" name="roll_feint_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Aim/Feint Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] + 4 ]]}} {{critical=[[23 + @{atkbonus}-@{attack_crit_range_adj}]]}} {{fumble=[[6+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] + 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=Attack occurs at -4 Initiative, @{attack_cmbt_option_ac_penalty} AC penalty for next round.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-feint-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_lightning_attack_section">
                            <input type="checkbox" class="sheet-attack-lightning-attack-button-show" name="attr_attack_lightning_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-lightning-attack-button-enabled">
                              <button class="attack-button nod20 sheet-yellow-border" type="roll" name="roll_lightning_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Lightning Strike</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}}  {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] - 4 ]]}} {{critical=[[15 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[-2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] - 4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=Attack earlier, Init +4, AB-4, @{attack_cmbt_option_ac_penalty} AC penalty for next round.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-lightning-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_strong_attack_section">
                            <input type="checkbox" class="sheet-attack-strong-attack-button-show" name="attr_attack_strong_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-strong-attack-button-enabled">
                              <button class="attack-button nod20 green-border" type="roll" name="roll_strong_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b> Strong Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] -4 ]]}} {{critical=[[13 + @{atkbonus}-@{attack_crit_range_adj}]]}} {{fumble=[[-4+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] -4 [Attack], @{attack_dam} + @{attack_dam_bonus} + @{attack_dam} + @{attack_dam_bonus} [Dam] }} {{description=@{attack_cmbt_option_ac_penalty} AC penalty for next round}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-strong-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_stun_attack_section">
                            <input type="checkbox" class="sheet-attack-stun-attack-button-show" name="attr_attack_stun_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-stun-attack-button-enabled">
                              <button class="attack-button nod20 orange-border" type="roll" name="roll_stun_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Stun Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] -4 ]]}} {{critical=[[15 + @{atkbonus}-@{attack_crit_range_adj}]]}} {{fumble=[[-2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] -4 [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=Target Fort save vs damage+10 or stun 1d3 rnds. @{attack_cmbt_option_ac_penalty} AC penalty next round.}}">
                                    <span name="attr_attack_cmbt_option_ac_penalty"/></button>
                            </div>
                            <div class="sheet-attack-stun-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                          <div class="sheet-attack_sneak_attack_section">
                            <input type="checkbox" class="sheet-attack-sneak-attack-button-show" name="attr_attack_sneak_attack_button_show" value="1" hidden="true" checked="checked"/>
                            <div class="sheet-attack-sneak-attack-button-enabled">
                              <button class="sheet-attack-button sheet-orange-border" type="roll" name="roll_sneak_attack"
                                      value="&{template:roll_check} {{character_name=@{character_name}}} {{title=@{atkname} <b>Sneak Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{sneak_attack_skill}]] + [[@{sneak_atkbonus}]] ]]}} {{critical=[[19 + @{sneak_attack_skill} + @{sneak_atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[2+@{sneak_attack_skill} + @{sneak_atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} + @{sneak_attack_dam}]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} + @{sneak_attack_dam} + @{sneak_attack_dam} ]]}} {{math=1d20 + @{sneak_attack_skill} + @{sneak_atkbonus} [Attack], @{attack_dam} + @{attack_dam_bonus} + @{sneak_attack_dam} [Dam] }}"></button>
                            </div>
                            <div class="sheet-attack-sneak-attack-button-disabled">
                              <button class="inactive-attack-button nod20" type="roll" name="roll_disabled_attack" value="" disabled="true"><span>X</span></button>
                            </div>
                          </div>

                        </div>

                        <button type="roll" name="roll_attack_dmg" style="display: none;" value="@{rollbase_dmg}"></button>
                        <button type="roll" name="roll_attack_crit" style="display: none;" value="@{rollbase_crit}"></button>

                    </div>

                </fieldset>
              </div>

            </div>
            <span class="sheet-spacer">&nbsp;</span>
          </div>
      </div>

      <div class="sheet-section-magic">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border">
          <h3>Magic</h3>
            <div class="sheet-thin-border">
              <h4 class="bottom-padding">Spellcasting</h4>

              <div class="sheet-flex bottom-padding">
                <div class="col col1 block">
                  <div class="center"> <span class="bold-font">Spellcasting Type</span> </div>
                  <div class="center">
                      <input class="ability-value sheet-inactive-color center info3" name="attr_spellcasting_type" type="text" value="None" readonly="true"/>
                  </div>
                </div>

                <div class="col col2 block">
                  <div class="center">
                     <input class="ability-check-value sheet-inactive-color center" name="attr_spellcasting_mod" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="center"> <span class="bold-font">Spellcasting Modifier</span> </div>
                </div>

                <div class="col col3 block">
                  <div class="center">
                     <input class="ability-check-value sheet-inactive-color center" name="attr_spellcasting_dc" type="number" value="0" readonly="true"/>
                  </div>
                  <div class="center"> <span class="bold-font">Spell Save DC</span> </div>
                </div>
              </div>
            </div>

            <span class="sheet-spacer">&nbsp;</span>

            <div class="sheet-thin-border sheet-bottom-padding">
              <h4>Powers</h4>
              <input type="checkbox" name="attr_has_cleric_powers" class="sheet-has-cleric-powers" value="1" hidden="True">
              <div class="sheet-show-cleric-powers">
                <div class="sheet-flex-between">
                  <div class="sheet-flex-between sheet-thin-border sheet-padding">
                    <span class="sheet-bold-font">Turn Undead</span>
                    <div class="sheet-col-left sheet-inline">
                      <input type="checkbox" name="attr_turn_undead1" value="1"/>
                      <input type="checkbox" name="attr_turn_undead2" value="1"/>
                      <input type="checkbox" name="attr_turn_undead3" value="1"/>
                      <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                    </div>
                    <div class="sheet-col-right">
                      <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_turn_undead_check"
                              value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Turn Undead Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                    </div>
                  </div>
                  <div class="sheet-flex-between sheet-padding sheet-thin-border">
                    <span class="sheet-bold-font">Dispel Magic</span>
                    <div class="sheet-col-left sheet-inline">
                      <input type="checkbox" name="attr_dispel_magic1" value="1"/>
                      <input type="checkbox" name="attr_dispel_magic2" value="1"/>
                      <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                    </div>
                    <div class="sheet-col-right">
                      <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_dispel_magic_check"
                              value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dispel Magic Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                    </div>
                  </div>
                  <div class="sheet-flex-between sheet-padding sheet-thin-border">
                    <div class="sheet-col-left sheet-inline">
                      <span class="sheet-bold-font">Dispel Evil</span>
                      <input type="checkbox" name="attr_dispel_evil" value="1"/>
                      &nbsp;
                      <span class="sheet-small-font sheet-italic-font">&nbsp;(per day)</span>
                    </div>
                    <div class="sheet-col-right">
                      <button class="sheet-ability-button sheet-green-border" type="roll" name="roll_dispel_evil_check"
                              value="&{template:roll_check} {{character_name=@{character_name}}} {{title=Dispel Evil Check}} {{subheader=@{character_name}}} {{ability=1}} {{math=roll: 1d20 + @{spellcasting_mod} }} {{noadvroll=1}} {{roll1=[[ 1d20 + [[@{spellcasting_mod}]] ]]}}"></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <span class="sheet-spacer">&nbsp;</span>
            <div class="spells thin-border">
              <h4>Spellbook</h4>

<!--
                     <button class="sheet-cast-button nod20 sheet-red-border" type="roll" name="roll_cast_adhoc_spell"
                             value="@{wtype}&{template:spell} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
                             <span name="attr_adhoc_dc"/></button>
 -->

              <input type="hidden" class="spellicon_flag" name="attr_spellicon_flag" value="all"/>
              <div class="body">
                <div class="col col1">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">1</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl1_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl1_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-1">
                        <div class="spell">
                            <div class="display">
                               <input type="hidden" name="attr_rollcontent"
                                      value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
			                          <input type="hidden" name="attr_adhoc_dc" value="10"/>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
<!--
                                value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{innate=@{innate}}} {{description=@{spelldescription}}}">

                                value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
-->

			    <!--
                            <input type="hidden" name="attr_adhoc_rollcontent"
                                   value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">

                            <button class="adhoc-flag" type="roll" name="roll_adhoc_cast" value="@{adhoc_rollcontent}"><span>e</span></button>

			    <button class="adhoc-flag" type="roll" name="roll_adhoc_cast"
                                    value="@{wtype}&{template:spell-adhoc} {{charname=@{character_name}}} {{title=Cast @{spellname}}} {{subheader=@{character_name}}} {{spell_save_dc=@{spellcasting_dc}}} {{spellcasting_mod=@{spellcasting_mod}}} {{adhoc=[[1d20]]}} {{dc=[[@{adhoc_dc}]]}} {{critical=[[19]]}} {{fumble=[[2]]}} {{description=@{spelldescription}}}">
			        <span>e</span>
			    </button>
			    <input class="adhoc-flag" type="checkbox" name="attr_adhoc-flag" checked="checked"><span>e</span></input>
			    -->

                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span></input>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					                                  <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="1">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">4</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl4_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl4_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-4">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="4">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">7</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl7_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl7_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-7">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="7">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>

                <div class="col col2">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">2</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl2_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl2_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-2">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="2">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">5</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl5_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl5_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-5">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="5">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">8</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl8_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl8_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-8">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="8">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>

                <div class="col col3">
                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">3</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl3_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl3_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-3">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="3">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">6</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl6_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl6_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-6">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="6">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <hr/>
                  </div>

                  <div class="spell-labels">
                     <span data-i18n="slots_total-u" style="margin-right: 17px; margin-left: 38px;">SLOTS TOTAL</span>
                     <span data-i18n="slots_remaining-u">SLOTS REMAINING</span>
                  </div>
                  <div class="spell-level">
                     <div class="level">
                         <span class="label">9</span>
                     </div>
                     <div class="total">
                         <span name="attr_lvl9_slots_total"></span>
                     </div>
                     <div class="expended">
                         <input type="number" name="attr_lvl9_slots_expended" value="0">
                     </div>
                  </div>
                  <div class="spell-container">
                    <fieldset class="repeating_spells-9">
                        <div class="spell">
                            <div class="display">
                                <input type="hidden" name="attr_rollcontent"
                                       value="@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} @{spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}"/>
                                <input type="checkbox" name="attr_spellprepared" value="1" class="sheet-prep-box"><span class="prep"></span>
                                <button class="spellcard" type="roll" name="roll_cast_spell" value="@{rollcontent}">
                                    <span class="spellname" name="attr_spellname"></span>
                                    <input class="innate_flag" type="hidden" name="attr_innate" value="">
                                    <span class="innate" name="attr_innate"></span>
                                </button>
                                <input type="hidden" class="spellritual" name="attr_spellritual" value="0">
                                <input type="hidden" class="spellconcentration" name="attr_spellconcentration" value="0">
                                <input type="hidden" class="v" name="attr_spellcomp_v" value="{{v=1}}">
                                <input type="hidden" class="s" name="attr_spellcomp_s" value="{{s=1}}">
                                <input type="hidden" class="m" name="attr_spellcomp_m" value="{{m=1}}">
                                <span class="spellritual" data-i18n="spell-ritual">R</span>
                                <span class="spellconcentration" data-i18n="spell-concentration">C</span>
                                <span class="componentscontainer">
                                    <span class="v" data-i18n="spell-component-verbal">V</span>
                                    <span class="s" data-i18n="spell-component-somatic">S</span>
                                    <span class="m" data-i18n="spell-component-material">M</span>
                                </span>
                            </div>
                            <input class="details-flag" type="checkbox" name="attr_details-flag" checked="checked"><span>i</span>
                            <div class="wrapper">
                                <input class="options-flag" type="checkbox" name="attr_options-flag" checked="checked"><span>y</span>
                                <div class="options">
                                    <div class="row">
                                        <span data-i18n="name:-u">NAME:</span>
                                        <input type="text" name="attr_spellname">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="school:-u">SCHOOL:</span>
                                        <select name="attr_spellschool">
                                            <option value="abjuration" data-i18n="abjuration">Abjuration</option>
                                            <option value="conjuration" data-i18n="conjuration">Conjuration</option>
                                            <option value="divination" data-i18n="divination">Divination</option>
                                            <option value="enchantment" data-i18n="enchantment">Enchantment</option>
                                            <option value="evocation" data-i18n="evocation">Evocation</option>
                                            <option value="illusion" data-i18n="illusion">Illusion</option>
                                            <option value="necromancy" data-i18n="necromancy">Necromancy</option>
                                            <option value="transmutation" data-i18n="transmutation">Transmutation</option>
                                        </select>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span data-i18n="ritual-u">RITUAL</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="casting-time:-u">CASTING TIME:</span>
                                        <input type="text" name="attr_spellcastingtime">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="range:-u">RANGE:</span>
                                        <input type="text" name="attr_spellrange">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="target:-u">TARGET:</span>
                                        <input type="text" name="attr_spelltarget">
                                    </div>
                                    <input type="hidden" name="attr_spellcomp">
                                    <div class="row">
                                        <span data-i18n="components:-u">COMPONENTS:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked">
                                        <span data-i18n="spell-component-verbal">V</span>
                                        <input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked">
                                        <span data-i18n="spell-component-somatic">S</span>
                                        <input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked">
                                        <span data-i18n="spell-component-material">M</span>
                                        <input type="text" name="attr_spellcomp_materials" placeholder="ruby dust worth 50gp" data-i18n-placeholder="ruby-dust-place">
                                    </div>
                                    <div class="row">
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration-u">CONCENTRATION</span>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="duration:-u">DURATION:</span>
                                        <input type="text" name="attr_spellduration">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="innate:-u">INNATE:</span>
                                        <input type="text" name="attr_innate" placeholder="1/day" value="">
                                    </div>
                                    <div class="row">
                                        <span data-i18n="output:-u">OUTPUT:</span>
                                        <select name="attr_spelloutput">
                                            <option value="SPELLCARD" data-i18n="spellcard-u">SPELLCARD</option>
                                            <option value="ATTACK" data-i18n="attack-u">ATTACK</option>
                                        </select>
                                    </div>
                                    <input type="hidden" class="spellattackinfoflag" name="attr_spelloutput">
                                    <div class="spellattackinfo">
                                        <div class="row">
                                            <span data-i18n="spell-atk:-u">SPELL ATTACK:</span>
                                            <select name="attr_spellattack">
                                                <option value="None" data-i18n="none">None</option>
                                                <option value="Melee" data-i18n="melee">Melee</option>
                                                <option value="Ranged" data-i18n="ranged">Ranged</option>
                                            </select>
                                        </div>
                                        <div class="row">
                                            <span data-i18n="damage:-u">DAMAGE:</span>
                                            <input type="text" name="attr_spelldamage" style="width: 50px;">
                                            <span data-i18n="type:-u">TYPE:</span>
					    <select name="attr_dmgtype" style="width: 103px;">
                                                <option selcted="selected" value="Bludgeoning">Bludgeon</option>
                                                <option value="Piercing">Pierce</option>
                                                <option value="Slashing">Slash</option>
                                                <option value="Acid">Acid</option>
                                                <option value="Cold">Cold</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Force">Force</option>
                                                <option value="Lightning">Lightning</option>
                                                <option value="Necrotic">Necrotic</option>
                                                <option value="Poison">Poison</option>
                                                <option value="Psychic">Psychic</option>
                                                <option value="Radiant">Radiant</option>
                                                <option value="Thunder">Thunder</option>
                                            </select>
                                        </div>
					<!--
                                        <div class="row">
                                            <span data-i18n="damage2:-u">DAMAGE2:</span>
                                            <input type="text" name="attr_spelldamage2" style="width: 45px;">
                                            <span data-i18n="type:-u">TYPE:</span>
                                            <input type="text" name="attr_dmgtype2" style="width: 103px;">
                                        </div>
					-->
                                        <div class="row">
                                            <span data-i18n="healing:-u">HEALING:</span>
                                            <input type="text" name="attr_spellhealing" style="width: 45px;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="saving-throw:-u">SAVING THROW:</span>
                                            <select name="attr_spellsave">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="Strength" data-i18n="str-u">STR</option>
                                                <option value="Dexterity" data-i18n="dex-u">DEX</option>
                                                <option value="Constitution" data-i18n="con-u">CON</option>
                                                <option value="Intelligence" data-i18n="int-u">INT</option>
                                                <option value="Wisdom" data-i18n="wis-u">WIS</option>
                                                <option value="Charisma" data-i18n="cha-u">CHA</option>
                                            </select>
                                            <span data-i18n="effect:-u">EFFECT:</span>
                                            <input type="text" name="attr_spellsavesuccess" style="width: 78px;" placeholder="Half damage" data-i18n-placeholder="half-dmg-place">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="at-higher-lvl-dmg:-u">HIGHER LVL CAST DMG:</span>
                                            <input type="text" name="attr_spellhldie" placeholder="1" style="width: 15px; text-align: right;">
                                            <select name="attr_spellhldietype">
                                                <option value="" selected="selected" data-i18n="none-u">NONE</option>
                                                <option value="d4">d4</option>
                                                <option value="d6">d6</option>
                                                <option value="d8">d8</option>
                                                <option value="d10">d10</option>
                                                <option value="d12">d12</option>
                                                <option value="d20">d20</option>
                                            </select>
                                            <span>+</span>
                                            <input type="text" name="attr_spellhlbonus" placeholder="0" style="width: 15px; text-align: center;">
                                        </div>
                                        <div class="row">
                                            <span data-i18n="include_spell_desc:-u">INCLUDE SPELL DESCRIPTION IN ATTACK:</span>
                                            <select name="attr_includedesc">
                                                <option value="off" selected="selected" data-i18n="off">Off</option>
                                                <option value="partial" data-i18n="partial">Partial</option>
                                                <option value="on" data-i18n="on">On</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="description:-u">DESCRIPTION:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spelldescription"></textarea>
                                    </div>
                                    <div class="row">
                                        <span data-i18n="at-higher-lvl:-u">AT HIGHER LEVELS:</span>
                                    </div>
                                    <div class="row">
                                        <textarea name="attr_spellathigherlevels" style="height: 36px; min-height: 36px;"></textarea>
                                    </div>
                                    <input type="hidden" name="attr_spellattackid">
                                    <input type="hidden" name="attr_spelllevel" value="9">
                                    <label class="options-done">
                                        <input type="checkbox" name="attr_options-flag" checked="checked">
                                        <span class="label" data-i18n="done">Done</span>
                                    </label>
                                </div>
                                <div class="details">
                                    <span class="row">
                                        <span name="attr_spellname"></span><input class="innate_flag" type="hidden" name="attr_innate" value=""><span class="innate" name="attr_innate"></span>
                                    </span>
                                    <div class="row italics">
                                        <span name="attr_spellschool"></span>
                                        <span name="attr_spelllevel"></span>
                                        <input type="checkbox" name="attr_spellritual" value="{{ritual=1}}">
                                        <span>(<span data-i18n="ritual-l">ritual</span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="casting-time:">Casting Time:</span>
                                        <span name="attr_spellcastingtime"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="range:">Range:</span>
                                        <span name="attr_spellrange"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="target:">Target:</span>
                                        <span name="attr_spelltarget"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="components:">Components:</span>
                                        <input type="checkbox" name="attr_spellcomp_v" value="{{v=1}}" checked="checked"><span data-i18n="spell-component-verbal">V</span><input type="checkbox" name="attr_spellcomp_s" value="{{s=1}}" checked="checked"><span data-i18n="spell-component-somatic">S</span><input type="checkbox" name="attr_spellcomp_m" value="{{m=1}}" checked="checked"><span class="spellcomp_m" data-i18n="spell-component-material">M</span>
                                        <input type="hidden" name="attr_spellcomp_materials" value="">
                                        <span>(<span name="attr_spellcomp_materials"></span>)</span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="duration:">Duration:</span>
                                        <input type="checkbox" name="attr_spellconcentration" value="{{concentration=1}}">
                                        <span data-i18n="concentration">Concentration</span>
                                        <span name="attr_spellduration"></span>
                                    </div>
                                    <div class="row">
                                        <span class="bold" data-i18n="description:">Description:</span>
                                    </div>
                                    <div class="row">
                                        <span name="attr_spelldescription"></span>
                                    </div>
                                    <input type="hidden" name="attr_spellathigherlevels" value="">
                                    <div class="row">
                                        <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>
                                        <span name="attr_spellathigherlevels"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                  </div>
                </div>
              </div>
            </div>
          </div>
     </div>

     <div class="sheet-section-perks">
       <span class="sheet-spacer">&nbsp;</span>
        <div class="thick-border perks" style="width:95%;">
          <h3>Perks</h3>
          <input type="checkbox" class="sheet-max-perks-overspent" name="attr_perks_overspent" value="0" hidden="true" checked="true"/>
          <input type="checkbox" class="sheet-perks-underspent" name="attr_perks_underspent" value="0" hidden="true" checked="true"/>
          <input type="number" name="attr_perk_known_languages" value="0" hidden="false"/>
          <input type="number" name="attr_perk_status_points" value="0" hidden="false"/>
          <input type="number" name="attr_perk_skill_points" value="0" hidden="false"/>
          <label class="italic-font centered-label max-perks-exceeded-notify perks-underspent-notify"><span>Max perks allowed: </span><span name="attr_max_perks_allowed"/></label>
          <fieldset class="repeating_perks">
            <div class="sheet-block sheet-thin-border sheet-side-padding">
               <div class="sheet-perkcontainer sheet-side-padding">
                  <select class="sheet-perk-name" name="attr_perk_type">
                     <option selected="selected" value="none">-- Select Perk --</option>
                     <option value="assassin">Assassin (Sneak Attack Combat Option, +1 Skill)</option>
                     <option value="dual_weilder">Dual Wielder (Two Weapon Attack Combat Option, +1 Skill)</option>
                     <option value="duelist">Duelist (Aim/Feint Combat Option, +1 Skill)</option>
                     <option value="packer">Organized Packer (+1 step for ready items, +1 Skill)</option>
                     <option value="status">Higher Status (+1 Status, +1 Skill)</option>
                     <option value="skilled">Skilled (+4 Skills)</option>
                     <option value="scholar">Scholar (+2 Lang, +2 Skills)</option>
                     <option value="acrobat">Acrobat (+2 Dodge, +1 Skill)</option>
                     <option value="bodybuilder">Bodybuilder (+2 Fortitdue, +1 Skill)</option>
                     <option value="healthy">Healthy(+2 Health, +1 Skill)</option>
                     <option value="perceptive">Perceptive (+2 Perception, +1 Skill)</option>
                     <option value="strong_will">Strong Will (+2 Willpower, +1 Skill)</option>
                     <option value="strong_personality">Strong Personality (+2 Ego, +1 Skill)</option>
                  </select>
                </div>
            </div>
         </fieldset>
       </div>
     </div>

     <div class="sheet-section-inventory">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-block">
          <div class="sheet-flex-between sheet-bottom-padding">
            <div class="sheet-thin-border sheet-padding">
              <span class="sheet-bold-font sheet-left-pad">Encumbrance Points:</span>
              <input type="number" name="attr_encumbrance_points" class="sheet-inactive-color" value="0" readonly="true"/>
              <span class="sheet-bold-font">Encumbrance Modifier:</span>
              <input type="number" name="attr_encumbrance_mod" class="sheet-inactive-color" value="0" readonly="true"/>
              <span class="sheet-bold-font sheet-big-font">Encumbrance: </span>
              <input type="number" name="attr_encumbrance" class="sheet-inactive-color sheet-right-pad" value="0" readonly="true"/>
            </div>
          </div>
          <div class="sheet-thick-border">
          <h3>Inventory</h3>
            <div class="sheet-block">
              <div class="sheet-thin-border sheet-padding">
                <h4 class="sheet-bold-font">Worn Items</h4>
                <div class="sheet-flex-between">
                  <div class="table sheet-fill-width">
                    <div class="table-row sheet-inline-flex">
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font sheet-worn-item">Armor:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <select name="attr_armor" class="sheet-worn-name">
                          <option selected="selected" value="none">Clothing / 0 Slots</option>
                          <option value="padded">Padded / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="leather">Leather / 1 Slot / +3 AC max DEX bonus</option>
                          <option value="studded_leather">Std. Leather / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="scale">Scale / 1 Enc. Pts. / 1 Slot / +0 AC max DEX bonus</option>
                          <option value="chainshirt">Chain Shirt / 1 Enc. Pts. / 1 Slot / +2 AC max DEX bonus</option>
                          <option value="chain">Chain Suit / 1 Enc. Pts. / 1 Slot / +1 AC max DEX bonus</option>
                          <option value="half_plate">Half Plate/ 1 Enc. Pts. / 2 Slots / -1 Dex Mod penalty</option>
                          <option value="plate">Plate / 2 Enc. Pts. / 2 Slots / -2 Dex Mod penalty</option>
                        </select>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <div class="sheet-flex">
                          <input type="number" class="center sheet-purple-border" name="attr_armor_bonus" value="0"/>
                          <div class="sheet-block">
                            <select class="sheet-attack-notches" name="attr_armor_notches">
                              <option selected="selected" value="0">--</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                            </select>
                            <span class="sheet-italic-font">Notches</span>
                          </div>
                        </div>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Head/Neck:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_head" data-i18n-placeholder="head or neck"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Body/Belt:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_body" data-i18n-placeholder="body or belt"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">R Ring:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_rring" data-i18n-placeholder="right ring"/>
                      </div>
                    </div>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Shield:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <select name="attr_shield" class="sheet-worn-name">
                          <option selected="selected" value="none">None</option>
                          <option value="small_shield">Small Shield / 1 Slot</option>
                          <option value="large_shield">Large Shield / 2 Slots</option>
                          <option value="tower_shield">Tower Shield / 2 Slots/ 1 Enc</option>
                        </select>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <div class="sheet-flex">
                          <input type="number" class="center sheet-purple-border" name="attr_shield_bonus" value="0"/>
                          <div class="sheet-block">
                            <select class="sheet-attack-notches" name="attr_shield_notches">
                              <option selected="selected" value="0">--</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                            </select>
                            <span class="sheet-italic-font">Notches</span>
                          </div>
                        </div>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Legs/Feet:&nbsp;&nbsp;</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_feet" data-i18n-placeholder="legs or feet"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">Hand/Arm:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_gloves" data-i18n-placeholder="gloves or arms"/>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        &nbsp; &nbsp; &nbsp;
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <span class="sheet-bold-font">L Ring:</span>
                      </div>
                      <div class="table-cell sheet-table-cell">
                        <input type="text" class="sheet-worn-name" name="attr_inv_lring" data-i18n-placeholder="left ring"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="sheet-flex-between">
              <div class="sheet-col-left-inv">

                <div class="sheet-thin-border sheet-padding">
                  <h3>Ready Items</h3>
                  <div class="table sheet-fill-width">
                    <input class="sheet-dex-show-slots" name="attr_dex-show-slots" type="hidden" value="18"/>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-header-cell sheet-item-name"><span>Item Name</span></div>
                      <div class="table-cell sheet-table-header-cell sheet-item-dex">Min Dex.</div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="table-row sheet-flex-simple">
                      <div class="table-cell sheet-table-cell"><input name="attr_islot3-1" type="text" class="sheet-item-name" value="" data-i18n-placeholder="Primary Hand"/></div>
                      <div class="table-cell sheet-table-cell"><input type="number" value="3" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                    </div>
                    <div class="sheet-dex4slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot4-1" type="text" class="sheet-item-name" data-i18n-placeholder="Off Hand"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="4" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex4slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot4-2" type="text" class="sheet-item-name sheet-inactive-color" data-i18n-placeholder="Off Hand" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="4" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-dex6slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-1" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-2" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input name="attr_islot6-3" type="text" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex6slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="6" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex9slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-9-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex9slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="9" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex13slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-13-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex13slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="13" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex16slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-16-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex16slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="16" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                    <div class="sheet-dex18slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-1" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-2" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-3" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-4" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" name="attr_islot-18-5" class="sheet-item-name"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="sheet-no-dex18slots">
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                      <div class="table-row sheet-flex-simple">
                        <div class="table-cell sheet-table-cell"><input type="text" value="" class="sheet-item-name sheet-inactive-color" readonly="true"/></div>
                        <div class="table-cell sheet-table-cell"><input type="number" value="18" class="sheet-inactive-color sheet-item-dex" readonly="true"/></div>
                      </div>
                    </div>
                    <div class="table-row sheet-table-sep-row"></div>
                  </div>
                </div>
              </div>
              <div class="sheet-col-right-inv">
                <div class="sheet-thin-border sheet-bottom-padding">
                  <h3>Purse (Coins/Gems)</h3>
                  <textarea class="sheet-sm-textarea" spellcheck="false" name="attr_purse_items" data-i18n-placeholder="coins_gems"></textarea>
                </div>
                <div class="sheet-padding"></div>
                <div class="sheet-flex-between">
                  <div class="sheet-col-right sheet-padding">
                    <div class="sheet-thin-border sheet-padding">
                      <div class="table sheet-fill-width">
                        <div class="table-row sheet-flex-simple">
                          <div class="table-cell sheet-table-header-cell"><span>Container 1 </span></div>
                          <div class="table-cell sheet-table-header-cell">
                            <select name="attr_container_1_type" class="sheet-info5">
                              <option selected="selected" value="none">None</option>
                              <option value="sack">Sack</option>
                              <option value="small_pack">Small Pack</option>
                              <option value="large_pack">Large Pack - 1 Enc. Pt.</option>
                            </select>
                          </div>
                        </div>
                        <input class="sheet-cont1-show-slots" name="attr_cont1_show_slots" type="hidden" value="none"/>
                        <div class="table-row sheet-table-sep-row"></div>
                        <div class="sheet-sack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-1" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-2" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-3" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-sack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                        <div class="sheet-sm-pack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-4" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-5" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-sm-pack1-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                        <div class="sheet-lrg-pack-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-6" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-7" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-8" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-9" type="text" class="sheet-container-item"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input name="attr_cslot1-10" type="text" class="sheet-container-item"/></div>
                          </div>
                        </div>
                        <div class="sheet-no-lrg-pack-slots">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="sheet-padding"></div>
                  <div class="sheet-col-left sheet-padding">
                    <div class="sheet-block">
                      <div class="sheet-thin-border sheet-padding">
                        <div class="table sheet-fill-width">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-header-cell"><span>Container 2 </span></div>
                            <div class="table-cell sheet-table-header-cell">
                              <select name="attr_container_2_type" class="sheet-info5">
                                <option selected="selected" value="none">None</option>
                                <option value="sack">Sack</option>
                                <option value="small_pack">Small Pack - 1 Enc. Pt.</option>
                              </select>
                            </div>
                          </div>
                          <input class="sheet-cont2-show-slots" name="attr_cont2_show_slots" type="hidden" value="none"/>
                          <div class="table-row sheet-table-sep-row"></div>
                          <div class="sheet-sack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-1" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-2" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-3" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                          <div class="sheet-sm-pack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-4" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot2-5" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sm-pack2-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                          <div class="table-row sheet-table-sep-row"></div>
                        </div>
                      </div>
                      <div class="sheet-padding"></div>
                      <div class="sheet-thin-border sheet-padding">
                        <div class="table sheet-fill-width">
                          <div class="table-row sheet-flex-simple">
                            <div class="table-cell sheet-table-header-cell"><span>Container 3 </span></div>
                            <div class="table-cell sheet-table-header-cell">
                              <select name="attr_container_3_type" class="sheet-info5">
                                <option selected="selected" value="none">None</option>
                                <option value="sack">Sack - 1 Enc. Pt.</option>
                              </select>
                            </div>
                          </div>
                          <input class="sheet-cont3-show-slots" name="attr_cont3_show_slots" type="hidden" value="none"/>
                          <div class="table-row sheet-table-sep-row"></div>
                          <div class="sheet-sack3-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-1" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-2" type="text" class="sheet-container-item"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input name="attr_cslot3-3" type="text" class="sheet-container-item"/></div>
                            </div>
                          </div>
                          <div class="sheet-no-sack3-slots">
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                            <div class="table-row sheet-flex-simple">
                              <div class="table-cell sheet-table-cell"><input type="text" class="sheet-container-item sheet-inactive-color" readonly="true"/></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="sheet-padding"></div>
                <div class="sheet-thin-border sheet-bottom-padding">
                  <h3>Non-Encumbering Items</h3>
                  <textarea class="sheet-med-textarea" spellcheck="false" name="attr_non_encumber_items" data-i18n-placeholder="non_encumber_items"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="sheet-section-notes">
        <span class="sheet-spacer">&nbsp;</span>
        <div class="sheet-thick-border">
          <h3>Notes</h3>
          <textarea class="sheet-fill-width" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Templates -->
<div class="rolltemplates">

  <rolltemplate class="sheet-rolltemplate-atk">
      <div class="licensedsheet-flag-{{licensedsheet}}"></div>
      <div class="container">
          <div class="result">
              {{#always}}
                  <div class="adv">
                      <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                  </div>
                  <div class="advspacer"></div>
                  <div class="adv">
                      <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                  </div>
              {{/always}}
              {{#normal}}
                  <div class="solo">
                      <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                  </div>
              {{/normal}}
              {{#advantage}}
                  {{#rollLess() r1 r2}}
                      <div class="adv">
                          <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollLess() r1 r2}}
                  {{#rollTotal() r1 r2}}
                      <div class="adv">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollTotal() r1 r2}}
                  {{#rollGreater() r1 r2}}
                      <div class="adv">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollGreater() r1 r2}}
              {{/advantage}}
              {{#disadvantage}}
                  {{#rollLess() r1 r2}}
                      <div class="adv">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollLess() r1 r2}}
                  {{#rollTotal() r1 r2}}
                      <div class="adv">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollTotal() r1 r2}}
                  {{#rollGreater() r1 r2}}
                      <div class="adv">
                          <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/rollGreater() r1 r2}}
              {{/disadvantage}}
          </div>
          {{#range}}
              <div class="sublabel">
                  <span>{{range}}</span>
              </div>
          {{/range}}
          <div class="label">
              {{#normal}}
                  {{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}
                  {{#^rollWasCrit() r1}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/^rollWasCrit() r1}}
              {{/normal}}
              {{#always}}
                  {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                  {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                  {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                  {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
              {{/always}}
              {{#advantage}}
                  {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                  {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                  {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                  {{#^rollWasCrit() r1}}{{#^rollWasCrit() r2}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/^rollWasCrit() r2}}{{/^rollWasCrit() r1}}
              {{/advantage}}
              {{#disadvantage}}
                  {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span>{{rnamec}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                  {{#rollTotal() r1 r2}}{{#^rollWasCrit() r1}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/^rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                  {{#rollLess() r1 r2}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollLess() r1 r2}}
                  {{#rollGreater() r1 r2}}<span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}} <span>({{mod}})</span></span>{{/rollGreater() r1 r2}}
              {{/disadvantage}}
          </div>
          {{#charname}}
              <div class="charname">
                  <span>{{charname}}</span>
              </div>
          {{/charname}}
      </div>
      {{#desc}}
          <div class="desc info">
              <span>
                  <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
              </span>
          </div>
      {{/desc}}
  </rolltemplate>

  <rolltemplate class="sheet-rolltemplate-dmg">
      <div class="licensedsheet-flag-{{licensedsheet}}"></div>
      {{#save}}
          {{#attack}}
              <div class="desc save">
          {{/attack}}
          {{^attack}}
              <div class="atk save">
          {{/attack}}
              <div class="savedc">
                  <span class="rolltemplate-inline" data-i18n="difficulty-class-abv">DC</span><span class="rolltemplate-inline">{{savedc}}</span>
              </div>
              {{#savedesc}}
                  <div class="sublabel">
                      <span>{{savedesc}}</span>
                  </div>
              {{/savedesc}}
              <div class="label">
                  <span class="rolltemplate-inline">{{saveattr}}</span> <span class="rolltemplate-inline" data-i18n="save">Save</span>
              </div>
          </div>
      {{/save}}
      {{^attack}}
          {{#desc}}
              <div class="desc info">
                  <span>
                      <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                  </span>
              </div>
          {{/desc}}
      {{/attack}}
      {{#globaldamage}}
          {{#^rollTotal() globaldamage 0}}
              <div class="desc">
                  <span>{{globaldamage}}{{#globaldamagecrit}}<span class="plus"> + </span>{{globaldamagecrit}}{{/globaldamagecrit}}</span>
                  <span class="sublabel">{{globaldamagetype}}</span>
              </div>
          {{/^rollTotal() globaldamage 0}}
      {{/globaldamage}}
      {{#hldmg}}
          {{#^rollTotal() hldmg 0}}
              <div class="desc">
                  <span>{{hldmg}}{{#hldmgcrit}}<span class="plus"> + </span>{{hldmgcrit}}{{/hldmgcrit}}</span>
                  <span class="sublabel">{{dmg1type}}</span>
                  <div class="label">
                      <span data-i18n="higher-lvl-cast">Higher Level Cast</span>
                  </div>
              </div>
          {{/^rollTotal() hldmg 0}}
      {{/hldmg}}
      <div class="container damagetemplate">
          <div class="result">
              {{#dmg1flag}}
                  {{^dmg2flag}}
                      <div class="solo">
                          <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
                          <span class="sublabel">{{dmg1type}}</span>
                      </div>
                  {{/dmg2flag}}
              {{/dmg1flag}}
              {{#dmg2flag}}
                  {{^dmg1flag}}
                      <div class="solo">
                          <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
                          <span class="sublabel">{{dmg2type}}</span>
                      </div>
                  {{/dmg1flag}}
              {{/dmg2flag}}
              {{#dmg1flag}}
                  {{#dmg2flag}}
                      <div class="adv">
                          <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
                          <span class="sublabel">{{dmg1type}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
                          <span class="sublabel">{{dmg2type}}</span>
                      </div>
                  {{/dmg2flag}}
              {{/dmg1flag}}
          </div>
          {{^attack}}
              {{#range}}
                  <div class="sublabel" style="color: black;">
                      <span>{{range}}</span>
                  </div>
              {{/range}}
              <div class="label">
                  <span>{{rname}}</span>{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}
              </div>
              {{#charname}}
                  <div class="charname">
                      <span>{{charname}}</span>
                  </div>
              {{/charname}}
          {{/attack}}
      </div>
  </rolltemplate>

  <rolltemplate class="sheet-rolltemplate-atkdmg">
      <div class="licensedsheet-flag-{{licensedsheet}}"></div>
      <div class="container">
      {{#attack}}
          <div class="atk">
              <div class="result">
                  {{#always}}
                      <div class="adv">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                      <div class="advspacer"></div>
                      <div class="adv">
                          <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/always}}
                  {{#normal}}
                      <div class="solo">
                          <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                      </div>
                  {{/normal}}
                  {{#advantage}}
                      {{#rollLess() r1 r2}}
                          <div class="adv">
                              <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollLess() r1 r2}}
                      {{#rollTotal() r1 r2}}
                          <div class="adv">
                              <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollTotal() r1 r2}}
                      {{#rollGreater() r1 r2}}
                          <div class="adv">
                              <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollGreater() r1 r2}}
                  {{/advantage}}
                  {{#disadvantage}}
                      {{#rollLess() r1 r2}}
                          <div class="adv">
                              <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span class="grey">{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollLess() r1 r2}}
                      {{#rollTotal() r1 r2}}
                          <div class="adv">
                              <span>{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollTotal() r1 r2}}
                      {{#rollGreater() r1 r2}}
                          <div class="adv">
                              <span class="grey">{{r1}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span>{{r2}}{{#globalattack}} + {{globalattack}}{{/globalattack}}</span>
                          </div>
                      {{/rollGreater() r1 r2}}
                  {{/disadvantage}}
              </div>
              {{#range}}
                  <div class="sublabel">
                      <span>{{range}}</span>
                  </div>
              {{/range}}
              <div class="label">
                  <span>{{rname}}{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}{{#attack}} <span>({{mod}})</span>{{/attack}}</span>
              </div>
              {{#charname}}
                  <div class="charname">
                      <span>{{charname}}</span>
                  </div>
              {{/charname}}
          </div>
      {{/attack}}
      {{#save}}
          {{#attack}}
              <div class="container desc save">
          {{/attack}}
          {{^attack}}
              <div class="container atk save">
          {{/attack}}
              <div class="savedc">
                  <span class="rolltemplate-inline" data-i18n="difficulty-class-abv">DC</span><span class="rolltemplate-inline">{{savedc}}</span>
              </div>
              {{#savedesc}}
                  <div class="sublabel">
                      <span>{{savedesc}}</span>
                  </div>
              {{/savedesc}}
              <div class="label">
                  <span class="rolltemplate-inline">{{saveattr}}</span> <span class="rolltemplate-inline" data-i18n="save">Save</span>
              </div>
          </div>
      {{/save}}
      {{#desc}}
          <!--div class="description info"-->
          <div class="description">
              <span>
                  <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
              </span>
          </div>
      {{/desc}}
      {{#globaldamage}}
          {{#^rollTotal() globaldamage 0}}
              <div class="desc">
                  <span>
                      {{globaldamage}}
                      {{#attack}}
                          {{#normal}}
                              {{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}
                          {{/normal}}
                          {{#always}}
                              {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                              {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                          {{/always}}
                          {{#advantage}}
                              {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                              {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                          {{/advantage}}
                          {{#disadvantage}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{globaldamagecrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                          {{/disadvantage}}
                      {{/attack}}
                  </span>
                  <span class="sublabel">{{globaldamagetype}}</span>
              </div>
          {{/^rollTotal() globaldamage 0}}
      {{/globaldamage}}
      {{#hldmg}}
          {{#^rollTotal() hldmg 0}}
              <div class="desc">
                  <span>
                      {{hldmg}}
                      <!-- {{#hldmgcrit}} + {{hldmgcrit}}{{/hldmgcrit}} -->
                      {{#attack}}
                          {{#normal}}
                              {{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}
                          {{/normal}}
                          {{#always}}
                              {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                              {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                          {{/always}}
                          {{#advantage}}
                              {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                              {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                          {{/advantage}}
                          {{#disadvantage}}
                              {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}<span class="plus"> + </span>{{hldmgcrit}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                          {{/disadvantage}}
                      {{/attack}}
                  </span>
                  <span class="sublabel">{{dmg1type}}</span>
                  <div class="label">
                      <span data-i18n="higher-lvl-cast">Higher Level Cast</span>
                  </div>
              </div>
          {{/^rollTotal() hldmg 0}}
      {{/hldmg}}
      {{#damage}}
          <div class="container damagetemplate">
              <div class="result">
                  {{#dmg1flag}}
                      {{^dmg2flag}}
                          <div class="solo">
                              <span class="damage">
                                  {{dmg1}}
                                  {{#attack}}
                                      {{#normal}}
                                          {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                      {{/normal}}
                                      {{#always}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/always}}
                                      {{#advantage}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/advantage}}
                                      {{#disadvantage}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                      {{/disadvantage}}
                                  {{/attack}}
                              </span>
                              <span class="sublabel">{{dmg1type}}</span>
                          </div>
                      {{/dmg2flag}}
                  {{/dmg1flag}}
                  {{#dmg2flag}}
                      {{^dmg1flag}}
                          <div class="solo">
                              <span class="damage">
                                  {{dmg2}}
                                  {{#attack}}
                                      {{#normal}}
                                          {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                      {{/normal}}
                                      {{#always}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/always}}
                                      {{#advantage}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/advantage}}
                                      {{#disadvantage}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                      {{/disadvantage}}
                                  {{/attack}}
                              </span>
                              <span class="sublabel">{{dmg2type}}</span>
                          </div>
                      {{/dmg1flag}}
                  {{/dmg2flag}}
                  {{#dmg1flag}}
                      {{#dmg2flag}}
                          <div class="adv">
                              <span class="damage">
                                  {{dmg1}}
                                  {{#attack}}
                                      {{#normal}}
                                          {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                      {{/normal}}
                                      {{#always}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/always}}
                                      {{#advantage}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/advantage}}
                                      {{#disadvantage}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                      {{/disadvantage}}
                                  {{/attack}}
                              </span>
                              <span class="sublabel">{{dmg1type}}</span>
                          </div>
                          <div class="advspacer"></div>
                          <div class="adv">
                              <span>
                                  {{dmg2}}
                                  {{#attack}}
                                      {{#normal}}
                                          {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                      {{/normal}}
                                      {{#always}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/always}}
                                      {{#advantage}}
                                          {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                          {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                      {{/advantage}}
                                      {{#disadvantage}}
                                          {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                      {{/disadvantage}}
                                  {{/attack}}
                              </span>
                              <span class="sublabel">{{dmg2type}}</span>
                          </div>
                      {{/dmg2flag}}
                  {{/dmg1flag}}
              </div>
              {{^attack}}
                  {{#range}}
                      <div class="sublabel">
                          <span>{{range}}</span>
                      </div>
                  {{/range}}
                  <div class="label">
                      <span>{{rname}}</span>{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}
                  </div>
                  {{#charname}}
                      <div class="charname">
                          <span>{{charname}}</span>
                      </div>
                  {{/charname}}
              {{/attack}}
          </div>
      {{/damage}}
      </div>
  </rolltemplate>

  <rolltemplate class="sheet-rolltemplate-spell">
      <div class="licensedsheet-flag-{{licensedsheet}}"></div>
      <div class="container">
          <div class="title row">
              <span>{{name}}</span>{{#innate}}<span class="grey">, {{innate}}</span>{{/innate}}
          </div>
          <div class="italics row">
              <span>{{level}}{{#ritual}} (<span data-i18n="ritual-l"></span>){{/ritual}}</span>
          </div>
          <div class="spacer"></div>
          {{#castingtime}}
          <div class="row">
              <span class="bold" data-i18n="casting-time:">Casting Time:</span> <span>{{castingtime}}</span>
          </div>
          {{/castingtime}}
          {{#range}}
          <div class="row">
              <span class="bold" data-i18n="range:">Range:</span> <span>{{range}}</span>
          </div>
          {{/range}}
          {{#target}}
          <div class="row">
              <span class="bold" data-i18n="target:">Target:</span> <span>{{target}}</span>
          </div>
          {{/target}}
          <div class="row">
              <span class="bold" data-i18n="components:">Components:</span>
              <span>
                  {{#v}}V{{#s}}, {{/s}}{{^s}}{{#m}}, {{/m}}{{/s}}{{/v}}
                  {{#s}}S{{#m}}, {{/m}}{{/s}}
                  {{#m}}M {{#material}}({{material}}){{/material}}{{/m}}
              </span>
          </div>
          {{#duration}}
          <div class="row">
              <span class="bold" data-i18n="duration:">Duration:</span> <span>{{#concentration}}<span data-i18n="concentration">Concentration</span> {{/concentration}}{{duration}}</span>
          </div>
          {{/duration}}
          <div class="spacer"></div>
          {{#description}}
          <div class="row">
              <span class="description">{{description}}</span>
          </div>
          {{/description}}
          {{#athigherlevels}}
          <div class="row">
              <span class="bold italics" data-i18n="at-higher-lvl">At Higher Levels</span>. <span class="description">{{athigherlevels}}</span>
          </div>
          {{/athigherlevels}}
      </div>
  </rolltemplate>

<rolltemplate class="sheet-rolltemplate-spell-adhoc">
  <div class="sheet-rt-card">
    <div class="sheet-rt-header sheet-spell">
      <div class="sheet-rt-title">{{title}}</div>
      {{#subheader}}
      <div class="sheet-rt-subheader">{{subheader}}{{#subheaderright}} &bullet; {{subheaderright}}{{/subheaderright}}</div>
      {{/subheader}} {{#subheader2}}
      <div class="sheet-rt-subheader">{{subheader2}}{{#subheaderright2}} &bullet; {{subheaderright2}}{{/subheaderright2}}</div>
      {{/subheader2}}
    </div>
    {{#emote}}
      <p class="sheet-rt-emote">{{character_name}} {{emote}}</p>
    {{/emote}}
    <div class="sheet-main-content">

        <div class="sheet-row">
          {{#adhoc}}
          <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Adhoc Casting</div>
          <div class="sheet-col-5-12 sheet-padr sheet-rt-value">DC: {{dc}}</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Adhoc casting roll: {{adhoc}}</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> </div>

          {{#rollBetween() adhoc fumble critical}}

            {{#rollGreater() adhoc dc}}
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><b>Adhoc casting success.</b></div>
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell takes effect normally.</div>
            {{/rollGreater() adhoc dc}}

            {{#^rollGreater() adhoc dc}}
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><b><i>Adhoc casting failure!<i></b></div>
            <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Roll Adhoc casting failure result.</div>
            {{/^rollGreater() adhoc dc}}

          {{/rollBetween() adhoc fumble critical}}

          {{#rollWasCrit() adhoc}}
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Critical!</h3></i> &dash; automatic casting success.</div>
          {{/rollWasCrit() adhoc}}

          {{#rollWasFumble() adhoc}}
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Fumble!</h3></i> &dash; automatic spell failure.</div>
          <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Roll adhoc casting blowback result.</div>
          {{/rollWasFumble() adhoc}}

          <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> </div>

          {{/adhoc}}

          {{#memorized}}
          <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Casting memorized spell.</div>
          {{/memorized}}

        </div>

        <div class="sheet-row">

              {{#memorized}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Save DC: {{spell_save_dc}}</div>
              {{#spell_dice_enabled}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Dice Roll: {{roll1}}</div>
              {{/spell_dice_enabled}}
              {{/memorized}}

              {{#adhoc}}

              {{#rollGreater() adhoc dc}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Save DC: {{spell_save_dc}}</div>
              {{#spell_dice_enabled}}
              <div class="sheet-col-7-12 sheet-padr sheet-rt-value">Spell Dice Roll: {{roll1}}</div>
              {{/spell_dice_enabled}}
              {{/rollGreater() adhoc dc}}

              {{/adhoc}}

        </div>

        {{#rollGreater() adhoc dc}}
          {{#description}}
          <div class="sheet-row">{{description}}</div>
          {{/description}}
        {{/rollGreater() adhoc dc}}

        {{#memorized}}
          {{#description}}
          <div class="sheet-row">{{description}}</div>
          {{/description}}
        {{/memorized}}

    </div>
  </div>
</rolltemplate>

  <rolltemplate class="sheet-rolltemplate-roll_check">
    <div class="sheet-rt-card">
     <div class="sheet-rt-header{{#attack}} sheet-attackmsg{{/attack}}{{#skill}} sheet-skill{{/skill}} {{#initiative}} sheet-initiative{{/initiative}}{{#ability}} sheet-ability{{/ability}}{{#save}} sheet-save{{/save}}{{#deathsave}} sheet-deathsave{{/deathsave}}">
        <div class="sheet-rt-title">{{title}}</div>
        {{#subheader}}
        <div class="sheet-rt-subheader">{{subheader}}{{#subheaderright}} &bullet; {{subheaderright}}{{/subheaderright}}</div>
        {{/subheader}} {{#subheader2}}
        <div class="sheet-rt-subheader2">{{subheader2}}{{#subheaderright2}} &bullet; {{subheaderright2}}{{/subheaderright2}}</div>
        {{/subheader2}}
      </div>
      {{#emote}}
      <p class="sheet-rt-emote">{{character_name}} {{emote}}</p>
      {{/emote}}
      <div class="sheet-main-content">
          {{#attack}}
          <div class="sheet-row">
                  <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Attack</div>
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{attack}} vs AC</div>
                  {{#rollWasCrit() attack}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Critical Hit!</h3></i></div>
                  {{/rollWasCrit() attack}}
                  {{#rollWasFumble() attack}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value"><i><h3>Fumble!</h3></i></div>
                  {{/rollWasFumble() attack}}
          </div>
          {{/attack}}
          {{#damage}}
          <div class="sheet-row">
                  <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Damage</div>

                  {{#rollBetween() attack fumble critical}}
                    <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> {{damage}} ({{damagetype}})</div>
                    {{#damage2}}
                      <div class="sheet-col-7-12 sheet-padr sheet-rt-value"> {{damage2}} ({{damagetype2}})</div>
                    {{/damage2}}
                  {{/rollBetween() attack fumble critical}}

                  {{#rollWasCrit() attack}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{critdamage}} ({{damagetype}})</div>
                    {{#damage2}}
                      {{#critdamage2}}
                        <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{critdamage2}} ({{damagetype2}})</div>
                      {{/critdamage2}}
                    {{/damage2}}
                    <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Roll Critical Hit Effect</div>
                    <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Notch Target Armor</div>
                  {{/rollWasCrit() attack}}

                  {{#rollWasFumble() attack}}
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Roll Fumble Effect</div>
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">&bull; Notch Weapon</div>
                  {{/rollWasFumble() attack}}
          </div>
          {{/damage}}

          {{#roll}}
          <div class="sheet-row">
                  <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">{{rollname}}</div>
                  <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{roll}}{{#rolladv}} | {{rolladv}}{{/rolladv}}</div>
          </div>
          {{/roll}}

          <div class="sheet-row">
                 {{#noadvroll}}
                 <div class="sheet-col-7-12 sheet-padr sheet-rt-value">{{roll1}}</div>
                 {{/noadvroll}}
          </div>

          <!--
          {{#math}}
          <div class="sheet-row">
                   <div class="sheet-col-5-12 sheet-padl sheet-padr sheet-rt-key">Math</div>
                   <div class="sheet-col-7-12 sheet-padr sheet-rt-value sheet-no-roll-highlight">{{math}}</div>
          </div>
          {{/math}}
          -->

          {{#description}}
          <div class="sheet-col-7-12 sheet-padl sheet-padr sheet-rt-key">Special</div>
          <div class="sheet-row">{{description}}</div>
          {{/description}}

      </div>
    </div>
  </rolltemplate>
</div>

<!-- Sheet Workers -->
<script type="text/worker">

  // container update
  on(`change:container_1_type change:container_2_type change:container_3_type`, () => {
    getAttrs(['container_1_type', 'container_2_type', 'container_3_type'], v=> {
       setAttrs( {cont1_show_slots: v.container_1_type,
                  cont2_show_slots: v.container_2_type,
                  cont3_show_slots: v.container_3_type});
    });
  });

  // function to find the next step up in inventory
  const inventory_dex_ranks = [3, 4, 6, 9, 13, 16, 18, 100];
  function inventory_dex (dex_score, extra_inventory )
  {
    const base_inventory_rank = inventory_dex_ranks.findIndex(rank => dex_score <= rank);
    var effective_rank = base_inventory_rank + extra_inventory;
    if ((effective_rank+1) >= inventory_dex_ranks.length) {
      effective_rank = inventory_dex_ranks.length -2;
    }
    return inventory_dex_ranks[effective_rank];
  };


  // Ability modifiers
  const raceMods = { Human: "", Dwarf: "constitution", Halfling: "dexterity", Elven : "charisma:intelligence:dexterity" };
  const abilityNames = ['charisma', 'constitution', 'dexterity', 'intelligence', 'strength', 'wisdom'];
  const bonusNames = [ 'strength_bonus', 'dexterity_bonus', 'constitution_bonus', 'intelligence_bonus', 'wisdom_bonus', 'charisma_bonus' ];
  const armor_dex_mod_penalty = {'none': 0, 'padded': 0, 'leather': 0, 'studded_leather': 0, 'scale': 0, 'chain': 0, 'chainshirt':0, 'half_plate': -1, 'plate': -2};
  abilityNames.forEach( ability => {
    on(`sheet:opened change:class change:class2 change:race change:level change:level2 change:perk_skill_points change:perk_inventory_mod change:armor change:${ability} change:${ability}_bonus`, () => {
          getAttrs([ability, ...bonusNames, 'armor', 'class', 'class2', 'race', 'level', 'level2', 'skill_points', 'perk_skill_points', 'perk_inventory_mod'], v => {
              const setting = {};

              const ability_bonus_name = `${ability}_bonus`;
              const ability_bonus = parseInt(v[ability_bonus_name]) || 0;
              const score = (parseInt(v[ability]) || 10) + ability_bonus;
              const statrank = [1,3,5,8,11,14,17,19,21,23,25,27,29,31].findIndex(rank => score <= rank);

              const level = parseInt(v.level) || 0;
              const level2 = parseInt(v.level2) || 0;
              const total_level = level + level2;
              const perk_skill_points = parseInt(v.perk_skill_points) || 0;
              const race = v.race.trim();
              const c_class = v.class.trim();
              const c_class2 = v.class2.trim();

              const ability_mod = `${ability}_mod`;
              setting[ability_mod] = (statrank === -1 ? 4 : statrank -4) + ((raceMods[race] || '').indexOf(ability) !== -1 ? 1 : 0);

              // HACK! penalize elven characters for wisdom and constitution
              if (race === 'Elven') {
                if (ability_mod === 'wisdom_mod' || ability_mod === 'constitution_mod') {
                  setting[ability_mod] = parseInt(setting[ability_mod])-1;
                }
              }
              // nuther set of hacks, Armor and Halfings get +2 Dex mod
              if (ability_mod === 'dexterity_mod') {
                 if (race === 'Halfling') {
                  setting[ability_mod] = parseInt(setting[ability_mod])+1;
                }
                // modify for armor we are wearing
                setting[ability_mod] = parseInt(setting[ability_mod])+armor_dex_mod_penalty[v.armor];
              }

              // intelligence based stuff
              if (ability === 'intelligence') {
                const base_int_mod = setting[ability_mod];
                var skill_int_mod = base_int_mod;
                if (skill_int_mod < -1) {
                  skill_int_mod = -1; // preserve at least 1 skill point / level
                }

                // skill points
                // starting race skills; elves dont get any skill points to start
                // BUT everyone gets 1 skill point for their background profession, so 1/6 for Elves/Non-Elves
                var base_race_start_skills = (race === 'Elven' ? 1 : 6) + skill_int_mod;
                if (base_race_start_skills < 0) {
                  // prevent negative totals
                  base_race_start_skills = 0;
                }

                // class skills
                const base_start_class_skills = level > 0 ? (c_class === 'specialist' ?  10 : 5) : 0; // set by the first class chosen at 1st level

                // class skills for levels beyond 1st
                const class1_skill_points = level > 1 ? ((skill_int_mod + 2) * (level - 1)) : 0;
                var class2_skill_points = (skill_int_mod + 2) * level2;
                class2_skill_points += level2 > 0 ? (c_class2 === 'specialist' ? 8 : 3) : 0; // multi-class give the full skill points for 1st level

                var class_skill_points = class1_skill_points + class2_skill_points;



                // always give 1 skill point per level
                //if (class_skill_points < (level + level2)) {
                //    class_skill_points = level+level2;
                //}

                setting["skill_points"] = base_start_class_skills + base_race_start_skills + class_skill_points + perk_skill_points;

                // arcane spellcasting
                if (c_class === 'wizard') {
                  setting["spellcasting_mod"] = base_int_mod + 1 + parseInt(level/2);
                  setting["spellcasting_dc"] = base_int_mod + 10 + parseInt(level/2);
                }
                else
                if (c_class2 === 'wizard') {
                  setting["spellcasting_mod"] = base_int_mod + 1 + parseInt(level2/2);
                  setting["spellcasting_dc"] = base_int_mod + 10 + parseInt(level2/2);
                }
                else
                if (race === 'Elven') {
                  setting["spellcasting_mod"] = base_int_mod + 1;
                  setting["spellcasting_dc"] = base_int_mod + 11;
                }

              }

              if (ability === 'wisdom') {

                const base_wis_mod = setting[ability_mod];

                // divine spell casting
                if (c_class === 'cleric') {
                  setting["spellcasting_mod"] = base_wis_mod + 1 + parseInt(level/2);
                  setting["spellcasting_dc"] = base_wis_mod + 10 + parseInt(level/2);
                }
                else
                if (c_class2 === 'cleric') {
                  setting["spellcasting_mod"] = base_wis_mod + 1 + parseInt(level2/2);
                  setting["spellcasting_dc"] = base_wis_mod + 10 + parseInt(level2/2);
                }

              }

              // do dex-based stuff
              if (ability === 'dexterity') {
                const base_dex_mod = setting[ability_mod];
                const base_dex_f = parseFloat(v[ability]) * 0.01;
                const perk_inventory_mod = parseInt(v['perk_inventory_mod']) || 0;

                setting["initiative_bonus"] = base_dex_mod + base_dex_f;
                setting["ranged_base_ab"] = base_dex_mod;

                var ranged_ab = base_dex_mod + 1 + (c_class === 'fighter' ? parseInt((level+1)/2) : (c_class2 === 'fighter' ? parseInt((level2+1)/2) : 0));
                // halflings get +2 ranged AB
                setting["ranged_ab"] = ranged_ab + (race === 'Halfling' ? 1 : 0);

                // for ready inventory slots
                setting["dex-show-slots"] = inventory_dex(score, perk_inventory_mod);
              }

              if (ability === 'strength') {
                const base_str_mod = setting[ability_mod]
                setting["melee_base_ab"] = base_str_mod;
                setting["melee_ab"] = base_str_mod + 1 + (c_class === 'fighter' ? parseInt((level+1)/2) : (c_class2 === 'fighter' ? parseInt((level2+1)/2) : 0));
                setting["encumbrance_mod"] = base_str_mod + (race === 'Dwarf' ? 1 : 0);
              }

              setAttrs(setting);
            });
        });
      });

  // determine which attribute contributes the bonus for Athletics skill
  // also set unarmed AB here too
  on(`change:strength_mod change:dexterity_mod change:strength_bonus change:dexterity_bonus change:melee_ab change:ranged_ab`, () => {
    getAttrs(['strength_mod', 'dexterity_mod', 'athletics_skill_mod', 'melee_ab', 'melee_base_ab', 'ranged_ab', 'ranged_base_ab', 'unarmed_ab', 'unarmed_base_ab'], v => {
      const str_mod = parseInt(v.strength_mod);
      const dex_mod = parseInt(v.dexterity_mod);
      const melee_ab = parseInt(v.melee_ab);
      const melee_base_ab = parseInt(v.melee_base_ab);
      const ranged_ab = parseInt(v.ranged_ab);
      const ranged_base_ab = parseInt(v.ranged_base_ab);

      settings = {}
      if (str_mod > dex_mod) {
        settings["athletics_skill_mod"] = str_mod;
        settings["unarmed_ab"] = melee_ab;
        settings["unarmed_base_ab"] = melee_base_ab;
      } else {
        settings["athletics_skill_mod"] = dex_mod;
        settings["unarmed_ab"] = ranged_ab;
        settings["unarmed_base_ab"] = ranged_base_ab;
      }

      setAttrs(settings);
    });
  });

  // Status Titles and related fields
  const status_title = ["Slave (-4)", "Outlaw (-3)", "Beggar (-2)", "Working Poor (-1)", "Commoner / Soldier (0)",
                  "Craftsman / Merchant (1)", "Officer / Official (2)", "High Official (3)", "Lesser Noble (4)",
                  "Greater Noble (5)", "Leader (6)"];
  const status_sell_percent = [0,  20,  30,  40,  50,  60,   70,   80,    90,   100,    200 ];
  const status_buy_percent  = ["0", "200", "150", "100", "100", "100",  "100",   "90",    "80",    "70",     "50" ];
  const status_max_saving   = [0,   0,   0,  50, 100, 500, 1000, 5000, 10000, 50000, 100000 ];
  const status_other = [ "not allowed rights or property or freedom", // slave
                   "price on head; not allowed rights or property", // outlaw
                   "minimal property and rights",  // beggar
                   "may have savings", // poor
                   "may own land", // Commoner
                   "may own land & business", // craftsman / Merchant
                   "minor legal immunity, own land/busi.", // official / officier
                   "legal power, minor legal immun, own land/busi.", // High Official
                   "legal power, major legal imm., own land/busi.", // Lesser Noble
                   "legal power, legal imm., own land/busi.",
                   "Makes laws, total legal imm. & power, 'owns everything'" // King
                 ];

  // update ability modifiers, perk-related stuff
  const abilityCheck = { strength_mod: "fortitude", dexterity_mod: "dodge", constitution_mod: "health", intelligence_mod: "perception", wisdom_mod: "willpower", charisma_mod: "ego" };
  const perkAbility = { strength_mod: "perk_fortitude", dexterity_mod: "perk_dodge", constitution_mod: "perk_health", intelligence_mod: "perk_perception", wisdom_mod: "perk_willpower", charisma_mod: "perk_ego" };
  ['charisma_mod', 'constitution_mod', 'dexterity_mod', 'intelligence_mod', 'strength_mod', 'wisdom_mod', 'charisma_mod'].forEach(ability_mod => {
    on(`sheet:opened change:level change:level2 change:perk_fortitude change:perk_dodge change:perk_health change:perk_perception change:perk_willpower change:perk_ego
        change:perk_languages change:${ability_mod}`, () => {

      const perk_ability_mod = perkAbility[ability_mod];

      getAttrs([perk_ability_mod, ability_mod, 'level', 'level2', 'perk_languages'], v => {
        const score = parseInt(v[ability_mod]) || 0;
        const perk_score = parseInt(v[perk_ability_mod]) || 0;
        const level = parseInt(v.level) || 1;
        const level2 = parseInt(v.level2) || 0;

        const perk_languages = parseInt(v.perk_languages) || 0;

        var setting = {};

        const checkName = abilityCheck[ability_mod];
        setting[checkName] = score + parseInt((level+level2)/2) + perk_score;

        // set healing rate
        if (ability_mod === 'constitution_mod') {
          const base_rate = score + level + level2;
          setting['healing_rate'] = base_rate > 0 ? base_rate : 1;
        }

        // set max languages here as well
        if (ability_mod === 'intelligence_mod') {
          setting['max_languages_allowed'] = (score + 1 > 0 ? score + 1: 1) + perk_languages;
        }

        setAttrs(setting);
      });
    });
  });

  // Calculate armor class
  const armor_ac_value = {'none': 0, 'padded': 1, 'leather': 2, 'studded_leather': 3, 'chainshirt':4, 'scale': 5, 'chain': 6, 'half_plate': 7, 'plate': 8};
  const max_armor_ac_dex_bonus = {'none': 10, 'padded': 2, 'leather': 3, 'studded_leather': 2, 'scale': 1, 'chain': 1, 'chainshirt':2, 'half_plate': 0, 'plate': 0};
  const shield_ac_value = {'none': 0, 'small_shield': 1, 'large_shield': 2, 'tower_shield': 3};
  on(`sheet:opened change:armor change:shield change:dexterity_mod change:armor_bonus change:armor_notches change:shield_bonus change:shield_notches`, () => {
    getAttrs(['armor', 'shield', 'armor_bonus', 'armor_notches', 'shield_bonus', 'shield_notches', 'dexterity_mod'], v => {
      var armor_class = 10;
      var dex_bonus = parseInt(v.dexterity_mod);
      var max_dex_bonus = parseInt(max_armor_ac_dex_bonus[v.armor]);
      if (dex_bonus > max_dex_bonus) {
        armor_class += max_dex_bonus;
      } else {
        armor_class += dex_bonus;
      }
      armor_class += parseInt(armor_ac_value[v.armor]) + parseInt(shield_ac_value[v.shield]) - parseInt(v.armor_notches) - parseInt(v.shield_notches)
      armor_class += parseInt(v.armor_bonus) + parseInt(v.shield_bonus);
      setAttrs({ac : armor_class});
    });
  });

  // Spell Slots
  const arcane_spell_slots1 = [0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7, 7, 8];
  const arcane_spell_slots2 = [0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6, 7, 7];
  const arcane_spell_slots3 = [0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6];
  const arcane_spell_slots4 = [0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6];
  const arcane_spell_slots5 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5];
  const arcane_spell_slots6 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4];
  const arcane_spell_slots7 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3, 3, 4];
  const arcane_spell_slots8 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3, 3];
  const arcane_spell_slots9 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2];

  const divine_spell_slots1 = [0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 7, 8];
  const divine_spell_slots2 = [0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 7];
  const divine_spell_slots3 = [0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 6, 7];
  const divine_spell_slots4 = [0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 6];
  const divine_spell_slots5 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5];
  const divine_spell_slots6 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4, 4, 5];
  const divine_spell_slots7 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 3, 3, 3, 4, 4];

  function get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, level2) {

    if (is_wizard)
    {
      const l = (c_class === 'wizard' ? level : level2);
      return [arcane_spell_slots1[l], arcane_spell_slots2[l], arcane_spell_slots3[l],
              arcane_spell_slots4[l], arcane_spell_slots5[l], arcane_spell_slots6[l],
              arcane_spell_slots7[l], arcane_spell_slots8[l], arcane_spell_slots9[l]
             ];
    }
    else
    if (is_elf)
    {
      return [ 1 + parseInt((level + level2)/4), 0, 0, 0, 0, 0, 0, 0, 0 ];
    }
    else
    if (is_cleric)
    {
      const l = (c_class === 'cleric' ? level : level2);
      return [divine_spell_slots1[l], divine_spell_slots2[l], divine_spell_slots3[l],
              divine_spell_slots4[l], divine_spell_slots5[l], divine_spell_slots6[l],
              divine_spell_slots7[l], 0, 0
             ];
    }

    // Not a spell caster, reset spell slots
    return [0,0,0,0,0,0,0,0,0];

;
  }


  // safety to flush failed drops
  on(`sheet:opened`, () => { cleanup_drop_fields(); });

  // keep up proficiencies
  const prof_names = ['Unskilled', 'Skilled', 'Proficient', 'Master', 'Grand Master'];
  on(`sheet:opened change:class change:class2 change:level change:level2 change:race change:xp`, () => {
    getAttrs(['class', 'class2', 'level', 'level2', 'alignment', 'race', 'xp' ], v => {
      const c_align = v.alignment.trim();
      const c_class = v.class.trim();
      const c_class2 = v.class2.trim();
      const c_race = v.race.trim();
      const level = parseInt(v.level) || 0;
      const level2 = parseInt(v.level2) || 0;
      const xp = parseInt(v.xp) || 0;

      const is_cleric = (c_class === 'cleric' || c_class2 === 'cleric');
      const is_fighter = (c_class === 'fighter' || c_class2 === 'fighter');
      const is_specialist = (c_class === 'specialist' || c_class2 === 'specialist');
      const is_wizard = (c_class === 'wizard' || c_class2 === 'wizard');

      const is_elf = (c_race === 'Elven');

      const setting = {};

     // General Class/Level stuff

      // calculate next level xp
      const next_level_xp = level < 1 ? 100 : level > 8 ? 128000 * (level + level2 - 7) : 1000 * (2**(level + level2 - 1));
      setting['next_level_xp'] = next_level_xp;
      setting['next_level_up'] = next_level_xp <= xp ? 0 : 1;

      // hitdice - : not quite right, if they change level its reset..
      setting['hit_dice'] =  level + level2;
      setting['hit_dice_max'] = level + level2;

      // for npc characters
      setting['npc_hpformula'] = level + "d8";

      // deal with sneak attack stuff
      //setting['sneak_attack_enabled'] = (c_class === 'specialist' ? 1 : (c_class2 === 'specialist' ? 1: 0));
      // setting['sneak_attack_checkbox'] = (c_class === 'specialist' ? 1 : (c_class2 === 'specialist' ? 1: 0));
      setting['sneak_attack_dice'] = (c_class === 'specialist' ?  1 + parseInt((level-1)/2): (c_class2 === 'specialist' ?  1 + parseInt((level2-1)/2): 0));

      spellslots = get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, level2);
      setting["lvl1_slots_total"] = spellslots[0];
      setting["lvl1_slots_expended"] = spellslots[0];

      setting["lvl2_slots_total"] = spellslots[1];
      setting["lvl2_slots_expended"] = spellslots[1];

      setting["lvl3_slots_total"] = spellslots[2];
      setting["lvl3_slots_expended"] = spellslots[2];

      setting["lvl4_slots_total"] = spellslots[3];
      setting["lvl4_slots_expended"] = spellslots[3];

      setting["lvl5_slots_total"] = spellslots[4];
      setting["lvl5_slots_expended"] = spellslots[4];

      setting["lvl6_slots_total"] = spellslots[5];
      setting["lvl6_slots_expended"] = spellslots[5];

      setting["lvl7_slots_total"] = spellslots[6];
      setting["lvl7_slots_expended"] = spellslots[6];

      setting["lvl8_slots_total"] = spellslots[7];
      setting["lvl8_slots_expended"] = spellslots[7];

      setting["lvl9_slots_total"] = spellslots[8];
      setting["lvl9_slots_expended"] = spellslots[8];

      if (is_wizard)
      {
        const wizard_level = (c_class === 'wizard' ? level : level2);
        setting["spellcasting_type"] = "Arcane";
        // setting["alignment"] = "Chaotic";
      }
      else
      if (is_elf)
      {
        setting["spellcasting_type"] = "Arcane";
        // setting["alignment"] = "Chaotic";
      }
      else
      if (is_cleric)
      {
        const cleric_level = (c_class === 'cleric' ? level : level2);
        setting["spellcasting_type"] = "Divine";
        setting["alignment"] = "Lawful";
      }
      else
      {
        setting["spellcasting_type"] = "None";
        setting["spellcasting_mod"] = 0;
        setting["spellcasting_dc"] = 0;
        setting["alignment"] = c_align;
      }

      setting["has_cleric_powers"] = is_cleric;
      setting["can_cast_magic"] = is_wizard || is_cleric || is_elf;

      // Check that we have not gimped low level slots
      // for elf multiclassed w/ wizard
      if (is_elf && is_wizard) {
        const wizard_level = (c_class === 'wizard' ? level : level2);
        var elf_slots1 = 1 + parseInt((level + level2)/4);
        if (arcane_spell_slots1[wizard_level] < elf_slots1) {
           setting["lvl1_slots_total"] = elf_slots1;
           setting["lvl1_slots_expended"] = elf_slots1;
        }
        else {
           setting["lvl1_slots_total"] = arcane_spell_slots1[wizard_level];
           setting["lvl1_slots_expended"] = arcane_spell_slots1[wizard_level];
        }
      }

      setting['max_cmbt_opts_allowed'] = 0;
      setting['max_prof_allowed'] = 1;
      setting['max_prof_level_allowed'] = 1;
      setting['max_prof_level_name'] = prof_names[1];

      setting['berserk_attack_mod'] = 0;
      setting['charge_attack'] = is_fighter ? 1 : 0;
      setting['press_attack'] = is_fighter ? 1 : 0;
      setting['defensive_attack'] = is_fighter ? 1 : 0;
      setting['parry_attack'] = is_fighter ? 1 : 0;

      // reset incase we messed with levels
      setting['max_perks_allowed'] = 0;

      if (is_fighter) {
        const fighter_level = (c_class === 'fighter' ? level : level2);
        setting['berserk_attack_mod'] = 2 + parseInt(fighter_level/4)
        setting['max_cmbt_opts_allowed'] = 1 + parseInt(fighter_level/2);
        setting['max_prof_allowed'] = fighter_level > 0 ? 3 + fighter_level : 1;
        const max_prof_level = fighter_level > 4 ? 4 : fighter_level > 0 ? fighter_level : 1;
        setting['max_prof_level_allowed'] = max_prof_level;
        setting['max_prof_level_name'] = prof_names[max_prof_level];

      } else if (is_specialist) {
        const specialist_level = (c_class === 'specialist' ? level : level2);
        setting['max_prof_allowed'] = specialist_level > 0 ? 3 : 1;
        setting['max_perks_allowed'] = specialist_level;

      } else if (is_cleric) {
        setting['max_prof_allowed'] = cleric_level > 0 ? 2 : 1;
      }

      setAttrs(setting);
    });
  });

  function set_npc_spellslots (c_class) {

    getAttrs(['level', 'race' ], v => {

      //const c_class = v.class.trim();
      const c_race = v.race.trim();
      const level = parseInt(v.level) || 0;

      const is_cleric = (c_class === 'cleric');
      const is_wizard = (c_class === 'wizard');
      const is_elf = (c_race === 'Elven');

      var spellslots = get_spell_slots (is_wizard, is_elf, is_cleric, c_class, level, 0);

      const setting = {};
      setting["lvl1_slots_total"] = spellslots[0];
      setting["lvl2_slots_total"] = spellslots[1];
      setting["lvl3_slots_total"] = spellslots[2];
      setting["lvl4_slots_total"] = spellslots[3];
      setting["lvl5_slots_total"] = spellslots[4];
      setting["lvl6_slots_total"] = spellslots[5];
      setting["lvl7_slots_total"] = spellslots[6];
      setting["lvl8_slots_total"] = spellslots[7];
      setting["lvl9_slots_total"] = spellslots[8];

      setAttrs(setting);

    });

  }

  function npc_spellrest () {

    getAttrs(['class', 'lvl1_slots_total', 'lvl2_slots_total', 'lvl3_slots_total', 'lvl4_slots_total', 'lvl5_slots_total',
              'lvl6_slots_total', 'lvl7_slots_total', 'lvl8_slots_total', 'lvl9_slots_total' ], v => {

      //failsafe
      const c_class = v.class.trim();
      set_npc_spellslots(c_class);

      settings={};
      settings["lvl1_slots_expended"] = parseInt(v.lvl1_slots_total) || 0;
      settings["lvl2_slots_expended"] = parseInt(v.lvl2_slots_total) || 0;
      settings["lvl3_slots_expended"] = parseInt(v.lvl3_slots_total) || 0;
      settings["lvl4_slots_expended"] = parseInt(v.lvl4_slots_total) || 0;
      settings["lvl5_slots_expended"] = parseInt(v.lvl5_slots_total) || 0;
      settings["lvl6_slots_expended"] = parseInt(v.lvl6_slots_total) || 0;
      settings["lvl7_slots_expended"] = parseInt(v.lvl7_slots_total) || 0;
      settings["lvl8_slots_expended"] = parseInt(v.lvl8_slots_total) || 0;
      settings["lvl9_slots_expended"] = parseInt(v.lvl9_slots_total) || 0;

      setAttrs(settings);
    });
  }

  on("clicked:spellrest", () => { npc_spellrest(); });

  // Checks for Skills, are they overspent? Have they underspent? Exceeded max bonus for a skill?
  const coreSkills = ['arcana_skill', 'architect_skill', 'armory_skill', 'athletics_skill', 'bushcraft_skill',
                      'languages_skill', 'open_door_skill', 'search_skill', 'sleight_skill', 'sneak_attack_skill',
                      'stealth_skill', 'social_skill', 'theology_skill', 'tinker_skill'];

  coreSkills.forEach(core_skill => {
    on(`change:${core_skill} change:level change:level2 change:intelligence_mod change:repeating_skills remove:repeating_skills change:perk_skill_points`, () => {
      // find total skill points spent
       var skill_point_total = 0;
       var max_skill_value = 0;

       getSectionIDs('repeating_skills', function (ids) {

         // gather up other_skills from repeating_skills
         const other_skills = [];
         ids.forEach(id => {
           other_skills.push('repeating_skills_' + id + '_skillvalue');
         });

         // find skills value total
         getAttrs([...coreSkills, ...other_skills], v => {
            skill_point_total = Object.values(v).reduce((m, w) => (m + (parseInt(w) || 0)), 0);
            max_skill_value = Object.values(v).reduce((m, w) => (m > (parseInt(w) || 0) ? m : (parseInt(w) || 0)), 0);
            // cache values
            setAttrs({skill_points_used: skill_point_total});
         });

         // Now lets check on our spending of skill points
         // did we 1) overspend the total allowed? 2) exceed the maxium value for a skill?
         getAttrs(['skill_points', 'level', 'level2', 'intelligence_mod'], v => {
           var skill_points_available = parseInt(v['skill_points']);
           var level = parseInt(v['level']) || 0;
           var level2 = parseInt(v['level2']) || 0;
           var intelligence_mod = parseInt(v['intelligence_mod']) || 0;

           // maximum skill value is betweeen 2 and 10 + int mod as modified by total level
           // check for max value being exceeded
           var max_value_allowed = 2 + level + level2 + intelligence_mod;
           if (max_value_allowed < 2) { max_value_allowed = 2; }
           if (max_value_allowed > 10 + intelligence_mod) { max_value_allowed = 10 + intelligence_mod; }
           const max_value_exceeded = max_skill_value > max_value_allowed ? 0 : 1;

           // check if we exceeded the sum of spending
           const skill_underspent = skill_point_total < skill_points_available ? 0 : 1;
           const skill_overspent = skill_point_total > skill_points_available ? 0 : 1;

           // update
           setAttrs({ skill_points_underspent: skill_underspent, skill_points_overspent: skill_overspent,
             max_skill_value_allowed: max_value_allowed, max_skill_value_exceeded: max_value_exceeded});
         });

       });

    });
  });

  // Keep spells up to date
  const spell_levels= [1,2,3,4,5,6,7,8,9];
  spell_levels.forEach( splvl => {
    on(`change:repeating_spells-${splvl}`, function (eventinfo, splvl) {

       if(eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {return;}

       console.log("SPELLS change event:"+JSON.stringify(eventinfo));

       // argh, this is ugly but it works...
       var workstr = eventinfo.triggerName.split("repeating_spells-");
       workstr.shift();
       workstr = workstr.join("");
       workstr = workstr.split("-");
       var splvl = workstr.shift();
       splvl = splvl.split('_')[0];
       workstr = workstr.join("-");
       workstr = '-' + workstr;

       update_spells(workstr, `repeating_spells-${splvl}`);
    });
  });

  spell_levels.forEach( splvl => {
    on(`remove:repeating_spells-${splvl}`, function (eventinfo, splvl) {

      const repeating_source_id = eventinfo['sourceAttribute'];
      const spellattackid_fld = repeating_source_id + "_spellattackid";

      const spellattackid = eventinfo['removedInfo'][spellattackid_fld];
      if (spellattackid && spellattackid !== "") {
         remove_attack(spellattackid);
      }
    });
  });

  on(`change:arcana_skill change:arcana_bonus change:class change:class2`, function () {
      // global changes to spells
      update_spells('all');
  });

  function update_spells (update_id, src) {

    console.debug("Update spells update_id:"+update_id+ " src:"+src);

    if (update_id && update_id.substring(0,1) === "-" && update_id.length === 20) {
        const splvl = update_id.substring(17,18);

        // passed single id for a row
	      do_update_spells([update_id], src);

    } else {

        // update everything
        spell_levels.forEach( splvl=> {
	        getSectionIDs(`repeating_spells-${splvl}`, function (idarray) {
		        do_update_spells(idarray, `repeating_spells-${splvl}`);
	        });
	      });
    }
  };

  function do_update_spells (ids, repeating_source) {

    // console.debug("DO update spells src:"+repeating_source+" ids:"+JSON.stringify(ids));

    const fieldnames = [];
    ids.forEach(id => {
      fieldnames.push(repeating_source + '_' + id + '_spelllevel');
      fieldnames.push(repeating_source + '_' + id + '_spelldamage');
      fieldnames.push(repeating_source + '_' + id + '_spelloutput');
      fieldnames.push(repeating_source + '_' + id + '_spellattackid');
    });

    getAttrs([...fieldnames, 'class', 'class2', 'arcana_skill', 'arcana_bonus', 'spellcasting_mod', 'character_id'], function (values) {
      const c_class = values.class.trim();
      const c_class2 = values.class2.trim();
      const character_id = values.character_id;
      const arcana_skill = parseInt(values.arcana_skill) || 0;
      const arcana_bonus = parseInt(values.arcana_bonus) || 0;
      const spellcasting_mod = parseInt(values.spellcasting_mod) || 0;

      const arcana_adj = parseInt((arcana_skill + arcana_bonus) / 4);
      const is_wizard = (c_class === 'wizard' || c_class2 === 'wizard') ? 1 : 0;

      var settings = {};
      var callbacks = [];
      ids.forEach(id => {

        const spelllevel = parseInt(values[repeating_source + '_' + id + '_spelllevel']) || 0;
        const spelldamage = values[repeating_source + '_' + id + '_spelldamage'];
        const spelloutput = values[repeating_source + '_' + id + '_spelloutput'];
        const spellattackid = values[repeating_source + '_' + id + '_spellattackid'];

        // handle sync between attack and spell
        if (spelloutput === "ATTACK")
        {
            if (!spellattackid || spellattackid === "") {
                // undefined attack?? add one
		            create_attack_from_spell();
                callbacks.push( function() { create_attack_from_spell(spelllevel, id, character_id); });
            }
            else
            {
                // sync spell to the changed spell
                callbacks.push( function() { update_attack_from_spell(spelllevel, id, spellattackid, false); });
            }
        }

        // handle ADHOC
        const is_dice_enabled = (spelldamage === "") ? 0 : 1;
        var adhoc_dc = 10 + spelllevel - spellcasting_mod - arcana_adj;
        if (adhoc_dc < 2) { adhoc_dc = 2; } // never lower than 2

        settings[repeating_source + '_' + id + '_adhoc_dc'] = adhoc_dc;

      });
      setAttrs(settings, {silent: true}, function() {callbacks.forEach(function(callback) {callback(); })} );

    });
  };

  // update need for query for higher level casting and/or spelloutput
  spell_levels.forEach( splvl=> {
      on(`change:repeating_spells-${splvl}:spellathigherlevels change:repeating_spells-${splvl}:spelloutput`, (eventinfo) => {
          if(eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {return;}

          const spellid = eventinfo.sourceAttribute.split("_")[2], repeating_source = `repeating_spells-${splvl}_${spellid}`;
          getAttrs(['licensedsheet', `${repeating_source}_spelllevel`, `${repeating_source}_spelloutput`], function(v) {
              const higherlevels = eventinfo.newValue;
              const lvl          = parseInt(v[repeating_source + "_spelllevel"], 10);
              const spelloutput  = v[repeating_source + "_spelloutput"];
              const licensedsheet = parseInt(v.licensedsheet) || 0;

              if (spelloutput) {
                  update_spelloutput(higherlevels, lvl, spellid, repeating_source, spelloutput, licensedsheet);
              }
          });
      });
  });

  const update_spelloutput = (higherlevels, lvl, spellid, repeating_source, spelloutput, licensedsheet)  => {
      let spelllevel = "@{spelllevel}";
      let update = {};
      var callbacks = [];

      // console.log("UPDATE SPELLOUTPUT");
     /*
      if (higherlevels && higherlevels !== "") {
          for(i = 0; i < 10-lvl; i++) {
              let tot = parseInt(i, 10) + parseInt(lvl, 10);
              spelllevel = spelllevel + "|Level " + tot + "," + tot;
          }
          spelllevel = `?{Cast at what level? ${spelllevel}}`;
      }
      */

      getAttrs([`${repeating_source}_spellattackid`, "character_id"], (v) => {
	const character_id = v.character_id;
	const spellattackid = v[repeating_source + "_spellattackid"];
        if (spelloutput === "SPELLCARD") {

          // default rollcontent for spellcard
          update[repeating_source + "_rollcontent"] = `@{wtype}&{template:spell} {{name=@{character_name}}} {{level=@{spellschool} ${spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}`;

	  // see if we already had a spellattackid, if so delete the attack
	  if (spellattackid !== "") {
             console.log("UPDATE SPELLOUTPUT -- ATTACK  attck_id: "+ spellattackid);
	     console.log("UNLINK and delete attack for spell with preexisting attack id:"+repeating_source);

             // erase spell attack id
             update[repeating_source + "_spellattackid"] = "";
             callbacks.push( function() { remove_attack(spellattackid); });

	  }

        } else {

           // spelloutput ATTACK
	   // make a new attack
	   console.log("CREATE new attack for spell ");
           callbacks.push( function() { create_attack_from_spell(lvl, spellid, character_id); });

        }

        console.log("ROLLCONTENT (before set attrs): "+update[repeating_source + "_rollcontent"]);
        setAttrs(update, {silent: true}, function() {callbacks.forEach(function(callback) {callback(); })} );
      });
  };

  // Keep status up to date
  on(`change:perk_status_points change:level change:level2` , function () {
      getAttrs(['level', 'level2', 'perk_status_points', 'starting_status'], v => {

        var setting = {};

        const level = parseInt(v.level) || 0;
        const level2 = parseInt(v.level2) || 0;

        const perk_status_points = parseInt(v.perk_status_points) || 0;
        var starting_status = parseInt(v.starting_status) || 0;

        const total_level = level + level2;

        starting_status = total_level == 0 ? starting_status - 1 : starting_status; // 0 level are 'beggar'

        // set status and related fields
        var status = starting_status + perk_status_points + parseInt(total_level / 3);
        setting["status_title"] = status_title[status];
        setting["buy_percent"] = status_buy_percent[status];
        setting["sell_percent"] = status_sell_percent[status].toString();
        setting["max_savings"] = status_max_saving[status].toString();
        setting["status_other"] = status_other[status];

        setAttrs(setting);

      });
    });

  // Keep perks up to date
  on(`change:repeating_perks remove:repeating_perks change:class change:class2 change:level change:level2` , function () {

    getSectionIDs('repeating_perks', function (ids) {
      const fieldnames = [];
      var perks_used = 0;

      ids.forEach(id => {
        fieldnames.push('repeating_perks_' + id + '_perk_type');
        perks_used += 1;
      });

      getAttrs([...fieldnames, 'class', 'class2', 'max_perks_allowed'], function (values) {
        settings = {};
        const max_perks = parseInt(values.max_perks_allowed) || 0;

        settings['perks_overspent'] = perks_used > max_perks ? 0 : 1;
        settings['perks_underspent'] = perks_used < max_perks ? 0 : 1;

        var extra_dodge = 0;
        var extra_fortitude = 0;
        var extra_health = 0;
        var extra_perception = 0;
        var extra_willpower = 0;
        var extra_ego = 0;

        var extra_known_languages = 0;
        var extra_inventory = 0;
        var extra_skill_points = 0;
        var extra_status_points = 0;
        var sneak_attack_enabled = 0;

        ids.forEach(id => {
          const type = values['repeating_perks_' + id + '_perk_type'];

          // add up additional perk-based skill points
          if (type === 'assassin')
          {
             sneak_attack_enabled = 1;
             extra_skill_points += 1;
          }
          else if (type === 'packer')
          {
             extra_inventory += 1;
             extra_skill_points += 1;
          }
          else if (type === 'status')
          {
             extra_status_points += 1;
             extra_skill_points += 1;
          }
          else if (type === 'acrobat')
          {
            extra_dodge += 2;
            extra_skill_points += 1;
          }
          else if (type === 'bodybuilder')
          {
            extra_fortitude += 2;
            extra_skill_points += 1;
          }
          else if (type === 'healthy')
          {
            extra_health += 2;
            extra_skill_points += 1;
          }
          else if (type === 'perceptive')
          {
            extra_perception += 2;
            extra_skill_points += 1;
          }
          else if (type === 'strong_will')
          {
            extra_willpower += 2;
            extra_skill_points += 1;
          }
          else if (type === 'strong_personality')
          {
            extra_ego += 2;
            extra_skill_points += 1;
          }
          else if (type === 'skilled')
          {
            extra_skill_points += 4;
          }
          else if (type === 'scholar')
          {
            extra_known_languages += 2;
            extra_skill_points += 2;
          }
          else
          {
            console.log("ERROR: Unimplemented Perk! "+type);
          }

        });


        settings['perk_dodge'] = extra_dodge;
        settings['perk_fortitude'] = extra_fortitude;
        settings['perk_health'] = extra_health;
        settings['perk_perception'] = extra_perception;
        settings['perk_willpower'] = extra_willpower;
        settings['perk_ego'] = extra_ego;

        settings['perk_skill_points'] = extra_skill_points;
        settings['perk_status_points'] = extra_status_points;
        settings['perk_languages'] = extra_known_languages;
        settings['perk_inventory_mod'] = extra_inventory;

        settings['sneak_attack_enabled'] = sneak_attack_enabled;
        settings['sneak_attack_checkbox'] = sneak_attack_enabled;

        setAttrs(settings);
      });
    });
  });

  // npc actions
  on(`change:repeating_npcactions remove:repeating_npcactions` , function () {
    getSectionIDs('repeating_npcactions', function (ids) {
      const fieldnames = [];
      ids.forEach(id => {
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_desc1');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_desc2');
        fieldnames.push('repeating_npcactions_' + id + '_action_is_an_attack');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_type');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_tohit');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_range');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damage');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damage2');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damagetype');
        fieldnames.push('repeating_npcactions_' + id + '_action_attack_damage2type');
      });
      getAttrs([...fieldnames], function (v) {
        settings = {};
        ids.forEach(id => {
          const is_attack = parseInt(v['repeating_npcactions_' + id + '_action_is_an_attack']) || 0;

          // set whether its an attack action or not
          settings['repeating_npcactions_'+id+'_action_show_attack'] = is_attack;

          if (is_attack == 1) {
             const to_hit = v['repeating_npcactions_' + id + '_action_attack_tohit'];
             const range = v['repeating_npcactions_' + id + '_action_attack_range'];
             const attack_type = v['repeating_npcactions_' + id + '_action_attack_type'];
             const damage = v['repeating_npcactions_' + id + '_action_attack_damage'];
             const damagetype = v['repeating_npcactions_' + id + '_action_attack_damagetype'];

             settings['repeating_npcactions_'+id+'_action_attack_desc1'] = attack_type + " " + range + ".";
             settings['repeating_npcactions_'+id+'_action_attack_desc2'] = "Hit: +" + to_hit + ' (' + damage + ') ' + damagetype + '.';
          }


        });
        setAttrs(settings);
      });
    });
  });

  const weapon_damage_msg = ["", "Slightly Damaged Weapon", "Damaged Weapon", "Badly Damaged Weapon"];

  // Keep attacks up to date
  const combatOpts = ['charge_attack', 'press_attack', 'defensive_attack', 'berserk_attack', 'cleave_attack', 'disarm_attack', 'feint_attack',
                      'great_cleave_attack', 'lightning_attack', 'rapid_strike_attack1', 'rapid_strike_attack2', 'rapid_shot_attack1', 'rapid_shot_attack2',
                      'shield_bash_attack', 'strong_attack', 'stun_attack', 'two_attack_attack', 'two_attack_master_attack' ];

  var combatOptChangeStr = "";
  combatOpts.forEach(combat_opt => {
      combatOptChangeStr = combatOptChangeStr + `change:${combat_opt} `;
  });


  // global changes which effect all attacks
  on(`:${combatOptChangeStr} change:sneak_attack_dice change:sneak_attack_enabled change:c_class change:c_class2 change:level change:level2`,
      function (eventinfo) {
         update_attacks('all');
  });

  function rowid_from_trigger (triggerName) {
      var id = "";
      if (triggerName.indexOf("-") > -1) {
          var data = triggerName.split("-");
          data.shift();
          id = data.join('-');
          id = '-' + id;
      }
      console.log("EVENT row id:"+id);
      return id;
  };

  function rowsrc_from_trigger (triggerName) {
      console.log("got src input:"+triggerName);
      var src = "";
      if (triggerName.indexOf("-") > -1) {
          var data = triggerName.split("-");
          data.pop();
          src = data.join('-');
      }
      console.log("EVENT row src:"+src);
      return src;
  };

  on(`change:repeating_attacks`, function(eventinfo) {
      if(eventinfo.sourceType && eventinfo.sourceType === "sheetworker") {return;}

      console.log("REP ATTACK CHANGE:"+JSON.stringify(eventinfo));

      const row_id = rowid_from_trigger(eventinfo.triggerName);
      update_attacks(row_id);

      /*
      // not needed? update_attacks will auto check for spell attack and update
      const repeating_attack_row = eventinfo.triggerName;
      if (repeating_attack_row && repeating_attack_row !== "") {

        console.log("change_repeating_attacks id:" + repeating_attack_row );

        const fieldnames = [];
	      fieldnames.push(repeating_attack_row + "_spellid");
	      fieldnames.push(repeating_attack_row + "_spelllevel");

        var callbacks = [];
	      getAttrs([...fieldnames], function (v) {
	         var spell_id = v[repeating_attack_row + "_spellid"];
	         var spell_level = v[repeating_attack_row + "_spelllevel"];

	         if (spell_id && spell_id != "" && spell_id && spell_id != "") {
              callbacks.push(() => { update_spell_from_attack(spell_level, spell_id, repeating_attack_row); });
	         }
	         setAttrs({}, {silent: true}, () => { callbacks.forEach((callback) => { callback(); }); });
	      });

      }
      */
  });

  function update_attacks2 () {
      // console.debug("UPDATE ATTACKS2");

      getSectionIDs('repeating_attacks', function (ids) {

        console.debug("Repeating attacks update called");

        const fieldnames = [];
        ids.forEach(id => {
              fieldnames.push('repeating_attacks_' + id + '_atkname');
              fieldnames.push('repeating_attacks_' + id + '_sneak_attack_dam');
              fieldnames.push('repeating_attacks_' + id + '_dmgbase');
              fieldnames.push('repeating_attacks_' + id + '_dmgtype');
              fieldnames.push('repeating_attacks_' + id + '_attack_form');
              fieldnames.push('repeating_attacks_' + id + '_atkmagic');
              fieldnames.push('repeating_attacks_' + id + '_attack_notches');
              fieldnames.push('repeating_attacks_' + id + '_attack_proficiency_level');
              fieldnames.push('repeating_attacks_' + id + '_spellid');
              fieldnames.push('repeating_attacks_' + id + '_spelllevel');
          });

          getAttrs([...fieldnames, ...combatOpts, 'melee_ab', 'melee_base_ab', 'unarmed_ab', 'unarmed_base_ab',
                    'ranged_ab', 'ranged_base_ab', 'max_cmbt_opts_allowed', 'max_prof_allowed', 'max_prof_level_allowed',
                    'spellcasting_mod', 'sneak_attack_enabled', 'sneak_attack_dice'], function (values) {

              var output = {};

              const melee_ab = parseInt(values.melee_ab) || 0;
              const melee_base_ab = parseInt(values.melee_base_ab) || 0;
              const ranged_ab = parseInt(values.ranged_ab) || 0;
              const ranged_base_ab = parseInt(values.ranged_base_ab) || 0;
              const unarmed_ab = parseInt(values.unarmed_ab) || 0;
              const unarmed_base_ab = parseInt(values.unarmed_base_ab) || 0;

              const spellcasting_mod = parseInt(values.spellcasting_mod) || 0;

              const max_cmbt_opts_allowed = parseInt(values.max_cmbt_opts_allowed) || 0;
              const max_prof_allowed = parseInt(values.max_prof_allowed) || 0;
              const max_prof_level_allowed = parseInt(values.max_prof_level_allowed) || 0;

              const sneak_dice = parseInt(values.sneak_attack_dice) || 0;
              const berserk_attack = parseInt(values.berserk_attack) || 0;
              const cleave_attack = parseInt(values.cleave_attack) || 0;
              const defensive_attack = parseInt(values.defensive_attack) || 0;
              const disarm_attack = parseInt(values.disarm_attack) || 0;
              const feint_attack = parseInt(values.feint_attack) || 0;
              const great_cleave_attack = parseInt(values.great_cleave_attack) || 0;
              const lightning_attack = parseInt(values.lightning_attack) || 0;

              const charge_attack = parseInt(values.charge_attack) || 0;
              const press_attack = parseInt(values.press_attack) || 0;
              const rapid_strike_attack1 = parseInt(values.rapid_strike_attack1) || 0;
              const rapid_strike_attack2 = parseInt(values.rapid_strike_attack2) || 0;
              const rapid_shot_attack1 = parseInt(values.rapid_shot_attack1) || 0;
              const rapid_shot_attack2 = parseInt(values.rapid_shot_attack2) || 0;
              const shield_bash_attack = parseInt(values.shield_bash_attack) || 0;
              const strong_attack = parseInt(values.strong_attack) || 0;
              const stun_attack = parseInt(values.stun_attack) || 0;
              const sneak_attack = parseInt(values.sneak_attack_enabled) || 0;
              const two_attack_attack = parseInt(values.two_attack_attack) || 0;
              const two_attack_master_attack = parseInt(values.two_attack_master_attack) || 0;

              // record state so we know if we should render buttons for these special combat options
              // or not
              output['berserk_attack_enabled'] = berserk_attack;
              output['charge_attack_enabled'] = charge_attack;
              output['cleave_attack_enabled'] = cleave_attack && !great_cleave_attack;
              output['cleave_attack_enabled2'] = cleave_attack;
              output['disarm_attack_enabled'] = disarm_attack;
              output['great_cleave_attack_enabled'] = great_cleave_attack && cleave_attack;
              output['feint_attack_enabled'] = feint_attack;
              output['lightning_attack_enabled'] = lightning_attack;
              output['press_attack_enabled'] = press_attack;
              output['strong_attack_enabled'] = strong_attack;
              output['stun_attack_enabled'] = stun_attack;
              output['two_attack_attack_enabled'] = two_attack_attack;
              output['two_attack_master_attack_enabled'] = two_attack_master_attack;

              // 2 + press_attack + charge_attack + defensive_attack
              var cmbt_opts_used = berserk_attack + cleave_attack + great_cleave_attack + disarm_attack + feint_attack + lightning_attack
                                       + rapid_shot_attack1 + rapid_shot_attack2 + rapid_strike_attack1 + rapid_strike_attack2
                                       + shield_bash_attack + strong_attack + stun_attack + two_attack_attack + two_attack_master_attack;

              output['cmbt_opts_used'] = cmbt_opts_used;
              output['max_cmbt_opts_exceeded'] = cmbt_opts_used > max_cmbt_opts_allowed ? 0 : 1;
              output['cmbt_opts_underspent'] = cmbt_opts_used < max_cmbt_opts_allowed ? 0 : 1;

              var max_prof_level_used = 0;
              var proficiencies_used = 0;
              var callbacks = [];
              ids.forEach(id => {

                  const attack_name = values['repeating_attacks_' + id + '_atkname'];
                  const attack_magic = parseInt(values['repeating_attacks_' + id + '_atkmagic']);
                  const attack_dambase = values['repeating_attacks_' + id + '_dmgbase'];
                  const dmgtype = values['repeating_attacks_' + id + '_dmgtype'];
                  const attack_notches = parseInt(values['repeating_attacks_' + id + '_attack_notches']);
                  const attack_form = values['repeating_attacks_' + id + '_attack_form'];
                  var attack_proficiency_level = parseInt(values['repeating_attacks_' + id + '_attack_proficiency_level']) || 0;
                  const spellid = values['repeating_attacks_' + id + '_spellid'];
                  const spell_level = parseInt(values['repeating_attacks_' + id + '_spelllevel']) || 0;

                  if (attack_proficiency_level > max_prof_level_used) {
                    max_prof_level_used = attack_proficiency_level;
                  }

                  proficiencies_used += attack_proficiency_level;

                  const is_ranged = (attack_form === 'ranged' || 0);
                  const is_spell = (attack_form === 'spell' || 0);
                  const is_not_spell = is_spell ? 0 : 1;

                  const is_not_grapple = attack_name === 'Grapple' ? 0 : 1;
                  const is_not_spell_or_grapple = is_not_spell && is_not_grapple;

                  // weapn attack bonus depends on attack_proficiency and type of attack
                  var attack_form_ab = melee_ab;
                  var attack_form_base_ab = melee_base_ab;

                  if (attack_form === 'unarmed') {
                    attack_form_ab = unarmed_ab;
                    attack_form_base_ab = unarmed_base_ab;
                  }

                  if (is_ranged) {
                    attack_form_ab = ranged_ab;
                    attack_form_base_ab = ranged_base_ab;
                  }

                  if (is_spell) {
                    attack_form_ab = spellcasting_mod;
                    attack_form_base_ab = spellcasting_mod;
                    // only non-spells may have different proficiencies
                    attack_proficiency_level = 0;
                    output['repeating_attacks_' + id + '_attack_proficiency_level'] = 0;
                  }

		  /*
                  console.log("spell id: "+spellid+" spell level:"+spell_level);
                  if (spellid && spell_level) {
                    callbacks.push(() => { update_spell_from_attack(spell_level, spellid, attack_row_id); });
	          }
		  */

                  // based on proficiency we get AB for attack
                  const is_proficient = attack_proficiency_level > 0 ? 1 : 0;
                  var atkbonus = is_proficient ? attack_form_ab : attack_form_base_ab;

                  // tack in magic bonus
		  atkbonus += attack_magic;

                  // increased proficiency provides benefits
                  var proficiency_dam_bonus = 0;
                  var cmbt_opt_ac_penalty = -4;
                  var crit_range_adj = 0;

                  if (attack_proficiency_level > 3)
                  {
                    // grand master
                    atkbonus += 1;
                    proficiency_dam_bonus = 2;
                    cmbt_opt_ac_penalty = 0;
                    crit_range_adj = 2; // Crit 18-20
                  }
                  else if (attack_proficiency_level > 2)
                  {
                    // master
                    atkbonus += 1;
                    proficiency_dam_bonus = 1;
                    cmbt_opt_ac_penalty = -1;
                    crit_range_adj = 1; // Crit 19-20
                  }
                  else if (attack_proficiency_level > 1)
                  {
                    // proficient
                    atkbonus += 1;
                    cmbt_opt_ac_penalty = -2;
                  }

                  // damaged weapons reduce attack bonus
                  atkbonus -= attack_notches;

                  // damaged weapon message
                  const damage_msg = weapon_damage_msg[attack_notches];

                  const num_dam_die = parseInt(attack_dambase.substring(0,1));
                  const attack_dam_die_type = parseInt(attack_dambase.substring(2)) - (2 * (attack_notches));

                  // safety for low die attacks with lots of notches
                  if (attack_dam_die_type < 0) {
                    attack_dam_die_type = 0;
                  }

                  // final calculations
                  const sneak_dam = (sneak_dice * num_dam_die ) + 'd' + attack_dam_die_type;
                  var attack_dam = attack_dambase; // num_dam_die + 'd' + attack_dam_die_type;

	          // add magic bonus to damage
	          if (attack_magic != 0) {
		          attack_dam = attack_dambase + '+' + attack_magic;
	          }

                  // apply new properties to attack
                  output['repeating_attacks_' + id + '_attack_berserk_attack_enabled'] = berserk_attack;
                  output['repeating_attacks_' + id + '_attack_charge_attack_enabled'] = charge_attack;
                  output['repeating_attacks_' + id + '_attack_cleave_attack_enabled'] = cleave_attack && !great_cleave_attack;
                  output['repeating_attacks_' + id + '_attack_disarm_attack_enabled'] = disarm_attack;
                  output['repeating_attacks_' + id + '_attack_feint_attack_enabled'] = feint_attack;
                  output['repeating_attacks_' + id + '_attack_great_cleave_attack_enabled'] = great_cleave_attack && cleave_attack;
                  output['repeating_attacks_' + id + '_attack_lightning_attack_enabled'] = lightning_attack;
                  output['repeating_attacks_' + id + '_attack_press_attack_enabled'] = press_attack;
                  output['repeating_attacks_' + id + '_attack_strong_attack_enabled'] = strong_attack;
                  output['repeating_attacks_' + id + '_attack_stun_attack_enabled'] = stun_attack;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_enabled'] = sneak_attack;
                  output['repeating_attacks_' + id + '_sneak_attack_dam'] = sneak_dam;

                  output['repeating_attacks_' + id + '_atkbonus'] = atkbonus;
                  output['repeating_attacks_' + id + '_attack_dam'] = attack_dam;
                  output['repeating_attacks_' + id + '_attack_is_weapon_attack'] = is_not_spell;
                  output['repeating_attacks_' + id + '_attack_proficiency_dam_bonus'] = proficiency_dam_bonus;
                  output['repeating_attacks_' + id + '_attack_cmbt_option_ac_penalty'] = cmbt_opt_ac_penalty;
                  output['repeating_attacks_' + id + '_attack_crit_number'] = 20 - crit_range_adj;
                  output['repeating_attacks_' + id + '_attack_crit_range_adj'] = crit_range_adj;


                  // damage status of our weapon
                  output['repeating_attacks_' + id + '_attack_damage_msg'] = damage_msg;

                  // even though we have the attack option, we still may not be able to use it because of the
                  // type of attack we have in hand and/or we lack proficiency

                  output['repeating_attacks_' + id + '_attack_disarm_attack_button_show'] = is_proficient && is_not_spell;
                  output['repeating_attacks_' + id + '_attack_feint_attack_button_show'] = is_proficient; // allow spells to be aimed if held
                  output['repeating_attacks_' + id + '_attack_lightning_attack_button_show'] = is_proficient && is_not_spell;
                  output['repeating_attacks_' + id + '_attack_sneak_attack_button_show'] = is_proficient && is_not_spell_or_grapple;
                  output['repeating_attacks_' + id + '_attack_strong_attack_button_show'] = is_proficient && is_not_spell_or_grapple;

                  // Only slashing / force attacks may 'cleave'
                  output['repeating_attacks_' + id + '_attack_cleave_attack_button_show'] = is_proficient && is_not_spell_or_grapple
                         && (dmgtype === 'Slashing' || dmgtype === 'Force') ? 1 : 0;
                  output['repeating_attacks_' + id + '_attack_great_cleave_attack_button_show'] = is_proficient && is_not_spell_or_grapple
                         && (dmgtype === 'Slashing' || dmgtype === 'Force') ? 1 : 0;

                  // Only bashing / force 'attacks' may 'stun'
                  output['repeating_attacks_' + id + '_attack_stun_attack_button_show'] = is_proficient && is_not_spell_or_grapple
                         && (dmgtype === 'Bludgeoning' || dmgtype === 'Force') ? 1 : 0;

                  // NO charge or press attacks with ranged attacks
                  output['repeating_attacks_' + id + '_attack_charge_attack_button_show'] = is_proficient && (is_ranged == 0) && is_not_spell_or_grapple;
                  output['repeating_attacks_' + id + '_attack_press_attack_button_show'] = is_proficient && (is_ranged == 0) && is_not_spell_or_grapple;

                  // NO ranged attack berserk attacks. Require too much concentration
                  // conversely, we CAN berserk w/o proficiency in a attack.
                  output['repeating_attacks_' + id + '_attack_berserk_attack_button_show'] = is_ranged || is_not_spell;

              });

              // do proficiency warning now
              output['prof_used'] = proficiencies_used;
              output['max_prof_level_exceeded'] = max_prof_level_used > max_prof_level_allowed ? 0 : 1;
              output['max_prof_numb_exceeded'] = proficiencies_used > max_prof_allowed ? 0 : 1;
              output['prof_underspent'] = proficiencies_used < max_prof_allowed ? 0 : 1;

              setAttrs(output, {silent: true}, () => { callbacks.forEach((callback) => { callback(); }); });
            });
         });
  };

  // Update basic attack information we expect to have
  // DONT do this on change:repeating_attacks. Its very slow..
  on(`sheet:opened change:c_class change:c_class2`, () => {

    // Basic HTH attacks for everyone
     add_attack_if_missing({name: "Punch", attk_type: "unarmed", dam_die: "1d2", dam_type: "Bludgeoning"});
     // add_attack_if_missing({name: "Kick", attk_type: "unarmed", dam_die: "1d4", dam_type: "Bludgeoning"});
     add_attack_if_missing({name: "Grapple", attk_type: "unarmed", dam_die: "0d0", dam_type: "Bludgeoning"});

  });

  function create_attack_obj (attack) {

    var newrowid = generateRowID();
    var settings = {};

    settings["repeating_attacks_" + newrowid + "_atkname"] = attack["name"];
    settings["repeating_attacks_" + newrowid + "_attack_form"] = attack["attk_type"];
    settings["repeating_attacks_" + newrowid + "_dmgtype"] = attack["dam_type"];
    settings["repeating_attacks_" + newrowid + "_dmgbase"] = attack["dam_die"];
    settings["repeating_attacks_" + newrowid + "_options-flag"] = "0";

    return settings;
  }

  function add_attack_if_missing (attack) {

    var name = attack["name"];

    // SO we cannot pass stuff out of getSectionIDs or getAttrs for whatever reason.
    // We need to cache our result in the chracter attribute (bah)
    getSectionIDs('repeating_attacks', function (ids) {
      // build list of attack name references
      const fieldnames = [];
      ids.forEach(id => {
         fieldnames.push('repeating_attacks_' + id + '_atkname');
      });

      getAttrs([...fieldnames ], function (values) {
        // set default
        var has_attack = false;
        ids.forEach(id => {
            const attack_name = values['repeating_attacks_' + id + '_atkname'];
            // NO need to add it if we already have it in the list
            if (attack_name.localeCompare(name) == 0) {
              has_attack = true;
            }
        });

        if (has_attack == false) {
          var settings = create_attack_obj(attack);
          setAttrs(settings);
        }
      });
    });
  }

  const armor_enc = { 'scale': 1, 'chain' : 1, 'half_plate': 1, 'plate': 2 }
  const shield_enc = { 'tower_shield' : 1 }

  // Check various inventory slots and the encumberance
  const islots9  = [ 'islot-9-1', 'islot-9-2', 'islot-9-3', 'islot-9-4', 'islot-9-5'];
  const islots13 = [ 'islot-13-1', 'islot-13-2', 'islot-13-3', 'islot-13-4', 'islot-13-5'];
  const islots16 = [ 'islot-16-1', 'islot-16-2', 'islot-16-3', 'islot-16-4', 'islot-16-5'];
  const islots18 = [ 'islot-18-1', 'islot-18-2', 'islot-18-3', 'islot-18-4', 'islot-18-5'];
  const readySlots = islots9.concat(islots13.concat(islots16.concat(islots18)));

  readySlots.forEach(ready_slot => {
    on(`change:${ready_slot} change:race change:encumbrance_mod change:armor change:shield change:container_1_type change:container_2_type change:container_3_type`, () => {
      getAttrs(readySlots.concat(['encumbrance_mod', 'race', 'armor', 'shield', 'container_1_type',
                                  'container_2_type', 'container_3_type']), v => {
        // ugh. seems like there should be a better way to do this
        const enc_points9 = islots9.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points13 = islots13.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points16 = islots16.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;
        const enc_points18 = islots18.reduce((m, w) => (m + (v[w] !== "" ? 1 : 0 )), 0) > 0 ? 1 : 0;

        // Containers
        const container_1_enc_pts = v.container_1_type === 'large_pack' ? 1 : 0;
        const container_2_enc_pts = v.container_2_type === 'small_pack' ? 1 : 0;
        const container_3_enc_pts = v.container_3_type === 'sack' ? 1 : 0;

        // armor
        const armor_enc_pts = armor_enc[v.armor] || 0;
        const shield_enc_pts = shield_enc[v.shield] || 0;

        // calculate encumbrance points
        const enc_points = enc_points9 + enc_points13 + enc_points16 + enc_points18
                           + container_1_enc_pts + container_2_enc_pts + container_3_enc_pts
                           + armor_enc_pts + shield_enc_pts;

        // calculate encumbrance
        var enc = enc_points - parseInt(v['encumbrance_mod']);
        enc = enc > 0 ? enc : 0;

        // TODO: Calculate movement
        const enc_move_factor = enc > 1 ? enc : 0;
        const base_move_rate = (v.race === 'Dwarf' || v.race === 'Halfling') ? 35 : 40;
        var move_rate = base_move_rate;
        move_rate -= enc_move_factor > 0 ? (enc_move_factor -1) * 10 : 0;
        move_rate = move_rate > 0 ? move_rate : 0;

        const move_rate_light_enc = (move_rate < base_move_rate) &&  (move_rate >= 30 ) ? 0 : 1;
        const move_rate_med_enc = (move_rate < 30 ) &&  (move_rate >= 20 ) ? 0 : 1;
        const move_rate_heavy_enc = (move_rate < 20 ) &&  (move_rate >= 10 ) ? 0 : 1;
        const move_rate_stop = (move_rate < 10 ) ? 0 : 1;

        setAttrs( { encumbrance_points: enc_points, encumbrance: enc,
                    base_movement_rate: base_move_rate, movement_rate: move_rate,
                    move_rate_light_enc: move_rate_light_enc, move_rate_med_enc: move_rate_med_enc,
                    move_rate_heavy_enc: move_rate_heavy_enc, move_rate_stop: move_rate_stop
                  });
      });
    });
  });

  on(`sheet:opened change:npc change:name`, () => {
    getAttrs(['npc', 'level', 'hp', 'character_name'], v => {
       const is_pc = parseInt(v.npc) ? 0 : 1;

       settings = {};

       settings['npc_header_enabled'] = v.npc;
       settings['pc_header_enabled'] = is_pc;
       settings['pc_main_enabled'] = is_pc;

       if (v.npc) {
         settings['npc_name'] = v.character_name;
         console.debug("Is NPC reached: "+v.character_name)
         // settings['class'] = 'fighter';
         settings['npc_hpformula'] = v.level + 'd8';
       } else {
         settings['npc_hpformula'] = v.hp;
         settings['npc_name'] = '';
       }

       setAttrs(settings);
    });
  });

  on(`change:is_multiclass`, () => {
    getAttrs(['is_multiclass'], v=> {
      setAttrs( {multiclass_enabled: v.is_multiclass });
     });
  });

  // implement for NPC dropped tokens, see page: https://gist.github.com/SteveKoontz/7dce834b2285734d8f557f03489531c2
  // for original code from 5e ogl char sheet.

on("sheet:compendium-drop", function() {
   getAttrs(["hp_max","npc_senses","token_size","cd_bar1_v","cd_bar1_m","cd_bar1_l","cd_bar2_v","cd_bar2_m","cd_bar2_l","cd_bar3_v","cd_bar3_m","cd_bar3_l"], function(v) {
       var default_attr = {};
       default_attr["width"] = 70;
       default_attr["height"] = 70;
       if(v["npc_senses"].toLowerCase().match(/(darkvision|blindsight|tremorsense|truesight)/)) {
           default_attr["light_radius"] = Math.max.apply(Math, v["npc_senses"].match(/\d+/g));
       }
       if(v["token_size"]) {
           var squarelength = 70;
           if(v["token_size"].indexOf(",") > -1) {
               var setwidth = !isNaN(v["token_size"].split(",")[0]) ? v["token_size"].split(",")[0] : 1;
               var setheight = !isNaN(v["token_size"].split(",")[1]) ? v["token_size"].split(",")[1] : 1;
               default_attr["width"] = setwidth * squarelength;
               default_attr["height"] = setheight * squarelength;
           }
           else {
               default_attr["width"] = squarelength * v["token_size"]
               default_attr["height"] = squarelength * v["token_size"]
           };
       }

       if(v["cd_bar1_l"]) {
           default_attr["bar1_link"] = v["cd_bar1_l"];
       }
       else if(v["cd_bar1_v"] || v["cd_bar1_m"]) {
           if(v["cd_bar1_v"]) {
               default_attr["bar1_value"] = v["cd_bar1_v"];
           }
           if(v["cd_bar1_m"]) {
               default_attr["bar1_max"] = v["cd_bar1_m"];
           }
       }
       else {
           default_attr["bar1_value"] = v["hp_max"];
           default_attr["bar1_max"] = v["hp_max"];
       }

       if(v["cd_bar2_l"]) {
           default_attr["bar2_link"] = v["cd_bar2_l"];
       }
       else if(v["cd_bar2_v"] || v["cd_bar2_m"]) {
           if(v["cd_bar2_v"]) {
               default_attr["bar2_value"] = v["cd_bar2_v"];
           }
           if(v["cd_bar2_m"]) {
               default_attr["bar2_max"] = v["cd_bar2_m"];
           }
       }
       else {
           default_attr["bar2_link"] = "npc_ac";
       }

       if(v["cd_bar3_l"]) {
           default_attr["bar3_link"] = v["cd_bar3_l"];
       }
       else if(v["cd_bar3_v"] || v["cd_bar3_m"]) {
           if(v["cd_bar3_v"]) {
               default_attr["bar3_value"] = v["cd_bar3_v"];
           }
           if(v["cd_bar3_m"]) {
               default_attr["bar3_max"] = v["cd_bar3_m"];
           }
       }

       setDefaultToken(default_attr);
   });
});

const drop_monster_attrs = ["drop_name","drop_weight","drop_properties",
               "drop_modifiers","drop_data", "drop_content","drop_itemtype",
               "drop_damage","drop_damagetype","drop_damage1",
               "drop_damagetype1","drop_range","drop_ac",
               "drop_speed", "drop_str", "drop_dex", "drop_con",
               "drop_int", "drop_wis", "drop_cha",
               "drop_vulnerabilities", "drop_resistances",
               "drop_immunities", "drop_condition_immunities",
               "drop_languages", "drop_challenge_rating", "drop_size",
               "drop_type", "drop_alignment", "drop_hp",
               "drop_saving_throws", "drop_senses",
               "drop_passive_perception", "drop_skills",
//                    "drop_spellcasting_ability",
               "drop_token_size", "character_id"];

on("change:drop_category", function(eventinfo)
{
    console.debug("Drop category reached:"+eventinfo+"\n event_new_val:"+eventinfo.newValue);

    if(eventinfo.newValue === "Monsters") {
      console.debug("Drop monster reached")
      getAttrs(["drop_data", "drop_name", "npc"], function(vals) {
          if (vals.npc == "0") {
            console.log("CANNOT overwrite PC with NPC creature, ignoring drop");
          } else {
            var results = handle_drop_monster(vals);
            setAttrs(results.update, {silent: true}, function() { results.callbacks.forEach(function(callback) {callback(); })} );
          }
      });
    }
    else
    if(eventinfo.newValue === "Items") {
      getAttrs(["drop_data", "drop_name"], function(vals) {
          var results = handle_drop_item(vals);
          setAttrs(results.update, {silent: true}, function() { results.callbacks.forEach(function(callback) {callback(); })} );
      });
    }
    else
    if(eventinfo.newValue === "Spells") {
      console.debug("Drop spells (to spellbook) reached")
      handle_drop_spell(eventinfo.newValue);
    }

});

var removeDuplicatedPageData = function(data) {
   if(!Array.isArray(data)) return data;
   const getPageName = function(item) {
     let category = "";
     if("data" in item && "Category" in item.data) category += item.data["Category"] + ": ";
     return category+item.name;
   }
   let seen = {};
   return data.filter(function(item) {
       let pageName = getPageName(item);
       return seen.hasOwnProperty(pageName) ? false : (seen[pageName] = true);
   })
};

var handle_drop_monster = function(v) {
   // var id = generateRowID();

   var callbacks = [];
   var update = {};
   const data = JSON.parse(v.drop_data);
   // console.log(" Monster Data: "+v.drop_data);

   update["npc"] = "1";
   if(v["drop_name"] && v.drop_name != "") {
     update["character_name"] = v.drop_name;
   }

   // token size
   update["token_size"] = data["Token Size"] ? data["Token Size"] : "1";

   // default class
   update['class'] = 'fighter';

   // core stats
   update["strength"]     = data["STR"] ? data["STR"] : "";
   update["dexterity"]    = data["DEX"] ? data["DEX"] : "";
   update["constitution"] = data["CON"] ? data["CON"] : "";
   update["intelligence"] = data["INT"] ? data["INT"] : "";
   update["wisdom"]       = data["WIS"] ? data["WIS"] : "";
   update["charisma"]     = data["CHA"] ? data["CHA"] : "";

   // figure out 'level' (hit_dice) from challenge Rating
   var cr = data["Challenge Rating"];
   if (cr) {
      if (cr === '1/4') {
        update["level"] = 1;
      } else if (cr === '1/2') {
        update["level"] = 2;
      } else {
         update["level"] = parseInt(cr) + 2;
      }
      // default, using d8s
      update["npc_hpformula"] = update["level"].toString() + 'd8';
   }

   //right side of core stats, top to bottom
   update["npc_size"]      = data["Size"] ? data["Size"] : "";
   update["npc_type"]      = data["Type"] ? data["Type"] : "";
   if (data["Alignment"]) {
     update["npc_type"]  = update["npc_type"] + ", " + data["Alignment"];
   }

  //AC handling
  if(data["AC"]) {
       const ac = data["AC"];
       if(ac.indexOf("(") > -1) {
           update["npc_ac"] = ac.split(" (")[0];
           update["npc_ac_note"] = ac.split(" (")[1].slice(0, -1);
       }
       else {
           update["npc_ac"] = ac;
           update["npc_ac_note"] = "";
       };
  }
  else {
       update["npc_ac"] = 10;
       update["npc_ac_note"] = "";
  };

  //HP handling
  if(data["HP"]) {
       const hp = data["HP"];
       if(hp.indexOf("(") > -1) {
            update["hp"] = hp.split(" (")[0];
            update["hp_max"] = update["hp"]
            update["npc_hpformula"] = hp.split(" (")[1].slice(0, -1);

            // try to update our level based on the npc_hpformula
            if (update["npc_hpformula"].indexOf("d") > -1) {
                update["level"] = parseInt(update["npc_hpformula"].split("d")[0]) || update["level"];
            }
       }
       else {
            update["hp"] = hp;
            update["hp_max"] = hp;
       };
  }
  else {
        update["hp"] = 1;
        update["hp_max"] = 1;
  };

    update["npc_speed"]  = data["Speed"] ? data["Speed"] + '/rnd' : "";
    update["npc_senses"] = data["Senses"] ? data["Senses"] : "";
    update["known_lang"] = data["Languages"] ? data["Languages"] : "";

    //Traits/Background
    update["npc_damage_resistance"]    = data["Resistances"] ? data["Resistances"] : "";
    update["npc_damage_vulnerability"] = data["Vulnerabilities"] ? data["Vulnerabilities"] : "";
    update["npc_damage_immunity"]      = data["Immunities"] ? data["Immunities"] : "";
    update["npc_condition_immunity"]   = data["Condition Immunities"] ? data["Condition Immunities"] : "";
    update["notes"] = "";

     /*
     //Skills
     update["npc_acrobatics_bonus"] = 0;
     update["npc_animal_handling_bonus"] = 0;
     update["npc_arcana_bonus"] = 0;
     update["npc_athletics_bonus"] = 0;
     update["npc_deception_bonus"] = 0;
     update["npc_history_bonus"] = 0;
     update["npc_insight_bonus"] = 0;
     update["npc_intimidation_bonus"] = 0;
     update["npc_investigation_bonus"] = 0;
     update["npc_medicine_bonus"] = 0;
     update["npc_nature_bonus"] = 0;
     update["npc_perception_bonus"] = 0;
     update["npc_performance_bonus"] = 0;
     update["npc_persuasion_bonus"] = 0;
     update["npc_religion_bonus"] = 0;
     update["npc_sleight_of_hand_bonus"] = 0;
     update["npc_stealth_bonus"] = 0;
     update["npc_survival_bonus"] = 0;
     */

    // NPC Skills
    if(data["Skills"] && data["Skills"] != "") {
           skillarray = data["Skills"].split(", ");
           _.each(skillarray, function(skill) {
               kv = skill.indexOf("-") > -1 ? skill.split(" ") : skill.split(" +");
               //update["npc_" + kv[0].toLowerCase().replace(/ /g, '_') + "_bonus"] = parseInt(kv[1], 10);
               newrowid = generateRowID();
               update["repeating_skills_" + newrowid + "_skillname"] = kv[0].trim();
               update["repeating_skills_" + newrowid + "_skillvalue"] = parseInt(kv[1]) || 0;
           });
    }

     if (data['data-Traits']) {
       let traitsobj     = {};
       JSON.parse(data["data-Traits"]).forEach((val) => {
           traitsobj[val.Name] = (val.Name && val.Desc) ? val.Desc : "";
           if (val.Name && val.Desc) {
               traitsobj[val.Name] = val.Desc;
           } else if (val.Name) {
               traitsobj[val.Name] = "";
           } else {
               console.log(`%c Traits JSON is lacking a Name key`, "color: orange;")
           };
       });
       _.each(traitsobj, function(desc, name) {
            newrowid = generateRowID();
            update["repeating_npctrait_" + newrowid + "_trait_name"] = name;
            if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                desc = desc.substring(2);
            }
            update["repeating_npctrait_" + newrowid + "_trait_desc"] = desc.trim();

            // SPELLCASTING NPCS
            if(name === "Spellcasting") {
                var lvl = parseInt(desc.substring(desc.indexOf("-level")-4, desc.indexOf("-level")-2).trim(), 10);
                lvl = !isNaN(lvl) ? lvl : update["level"]; // if we can parse it from spellcasting description, use the level as the caster level

                var ability = desc.match(/casting ability is (.*?) /);
                    ability = ability && ability.length > 1 ? ability[1] : "";

                update["spellcasting_type"] = ability.toLowerCase() === "wisdom" ? "Divine" : "Arcane";
                update["class"]             = ability.toLowerCase() === "wisdom" ? "cleric" : "wizard";
                update["level"]             = lvl;

                var dc = desc.match(/spell save DC (.*?)[,\)]/);
                if (dc) {
                  update["spellcasting_dc"] = parseInt(dc[1]) || -1;
                }
                else {
                  update["spellcasting_dc"] = 8;
                }

                var mod = desc.match(/ \+?(\d+?) to hit with spell attacks/);
                if (mod) {
                  update["spellcasting_mod"] = parseInt(mod[1]) || -1;
                } else {
                  update["spellcasting_mod"] = 0;
                }

                callbacks.push( function() { npc_spellrest(); });
                callbacks.push( function() { update_spells('all');} );
            }

        });
    }

    //REACTIONS
    if (data["data-Reactions"]) {
        update["npcreactionsflag"] = 1;
        let reactionsobj = {};
        JSON.parse(data["data-Reactions"]).forEach((val) => { reactionsobj[val.Name] = val.Desc; });

        _.each(reactionsobj, (desc, name) => {
            newrowid = generateRowID();
            update[`repeating_npcreaction_${newrowid}_name`] = name + ".";
            if(desc.substring(0,2) === ": " || encodeURI(desc.substring(0,2)) === ":%C2%A0") {
                desc = desc.substring(2);
            };
            update[`repeating_npcreaction_${newrowid}_desc`] = desc.trim();
        });
    }

    // ACTIONS & LEGENDARY ACTIONS
    ["Actions", "Legendary Actions"].forEach((attr) => {
        if (data[`data-${attr}`]) {
            const npcaction = (attr === "Actions") ? "npcactions" : "npcactions-l";
            let actionsobj = {};
            JSON.parse(data[`data-${attr}`]).forEach((val) => { actionsobj[val.Name] = val; });

            _.each(actionsobj, (action, name) => {
                const repeating_npcaction = "repeating_" + npcaction + "_" + generateRowID();

                // update[`repeating_${npcaction}_${newrowid}_npc_options-flag`] = "0";
                update[repeating_npcaction + "_action_name"]             = name;
                (action["Desc"]) ? update[repeating_npcaction + "_action_desc"] = action["Desc"] : "";
                update[repeating_npcaction + "_show_action_editor"]      = 0;
                update[repeating_npcaction + "_action_is_an_attack"]     = 0;

                if ( action["Type Attack"] ) {

                    update[repeating_npcaction + "_action_attack_type"]    = action['Type Attack'] === "Weapon Attack" ? action["Type"] + "Weapon" : action["Type"] + "Spell";
                    update[repeating_npcaction + "_action_is_an_attack"]  = 1;
                    update[repeating_npcaction + "_attack_options"]       = "{{attack=1}}";
                    update[repeating_npcaction + "_action_attack_type"]   = "Spell";

                    ["Damage Type", "Damage", "Damage 2", "Damage 2 Type", "Hit Bonus", "Reach", "Target", "Type"].forEach((attr) => {
                        if(action[attr]) {
                            var attributeName = (attr === "Hit Bonus") ? "tohit" : (attr === "Reach") ? "range" : attr.toLowerCase().replace(" ", "");
                            const fld_name = `${repeating_npcaction}_action_attack_${attributeName}`;
                            update[fld_name] = action[attr];
                        };
                    });
                }

            });

            // (attr === "Actions") ? callbacks.push(() => {update_npc_action("all");} ) : false;
        }

    });

  if (data["data-Spells"]) {
    //console.log("SPELL DATA: " + JSON.stringify(data["data-Spells"]));

    let spellsobj = [];
    //Put together a list of spells to get from the Comepndium
    ["spells", "innate"].forEach((type) => {
        let spellList = JSON.parse(data["data-Spells"])[`${type}`];
        if (spellList) {
            Object.keys(spellList).map((objectKey, index) => {
                spellList[objectKey].forEach((spell) => {
                    spellsobj.push(spell);
                });
            });
        };
    });

    // now look them up
    getCompendiumPage(spellsobj, (compendiumPages) => {

      compendiumPages = removeDuplicatedPageData(compendiumPages);
      const spellData = (compendiumPages.length === undefined || compendiumPages.length === 1) ? [compendiumPages] : compendiumPages;
      const innate = (JSON.parse(data["data-Spells"])[`innate`]) ? JSON.parse(data["data-Spells"])[`innate`] : false;
      let update   = [], callbacks = [];

      spellData.forEach( (page) => {
            const spell        = page.data;
            const lvl          = spell["Level"] && spell["Level"] > 0 ? spell["Level"] : 1; // "cantrip" is level 1 for us;
            const newrowid     = generateRowID();
            const repeatingRow = "repeating_spells-"+lvl+"_"+newrowid;

            //console.log("ADDING SPELL row:" + repeatingRow);
            //console.log("ADDING SPELL data:"+JSON.stringify(spell));

            update[ repeatingRow + "_spelllevel"]               = lvl;
            // update[`${repeatingRow}_spell_ability`]            = (update["spellcasting_ability"]) ? update["spellcasting_ability"] : "spell";
            (spell.Name) ? update[repeatingRow + "_spellname"] = spell.Name : console.log(`%c ${JSON.stringify(page.name)} is incorrect. Update compendium data.`, "color: orange;");
            update[ repeatingRow + "_spelloutput"]              = (page.data["Damage"] || page.data["Healing"]) ? "ATTACK" : "SPELLCARD";

            ["spellclass", "spellsource", "data-description"].forEach((attr) => {
                const suffix = (attr.includes("description")) ? "spelldescription" : attr;
                (spell[`${attr}`]) ? update[repeatingRow + "_" + suffix] = spell[`${attr}`] : false;
            });

            // ["Add Casting Modifier", "Casting Time", "Concentration", "Damage Type", "Damage", "Duration", "Healing", "Material", "Range", "Ritual", "Save", "Save Success", "School", "Secondary Damage", "Secondary Damage Type", "Spell Attack", "Target"].forEach((attr) => {
            ["Casting Time", "Concentration", "Damage Type", "Damage", "Duration", "Healing", "Material", "Range", "Ritual", "Save", "Save Success", "School", "Spell Attack", "Target"].forEach((attr) => {
                if (spell[`${attr}`]) {
                    //Adjust the array entry to match the attribute name in the HTML
                    const name =
                        (attr === "Add Casting Modifier") ? "dmgmod" :
                        (attr === "Material") ? `comp_materials` :
                        (attr === "Spell Attack") ? `attack` :
                        (attr.includes("Secondary Damage")) ? attr.split("Secondary ")[0] + "2" :
                        attr;

                    const spellattribute = name.toLowerCase().replace(" ", "");
                    //Concentration, Ritual, and School are exceptions to norm
                    const updateValue =
                        (attr === "Concentration" || attr === "Ritual") ? `{{${spellattribute}=1}}` :
                        (attr === "School") ? spell["School"].toLowerCase() : spell[`${attr}`];

                    update[`${repeatingRow}_spell${spellattribute}`] = updateValue;
                };
            });

           ["Higher Spell Slot Bonus", "Higher Spell Slot Desc", "Higher Spell Slot Dice", "Higher Spell Slot Die"].forEach((attr) => {
                if (spell[`${attr}`]) {
                    const spellattribute = (attr.includes("Bonus")) ? "hlbonus" : (attr.includes("Desc")) ? "athigherlevels" : (attr.includes("Dice")) ? "hldie" : "hldietype";
                    update[`${repeatingRow}_spell${spellattribute}`] = spell[`${attr}`];
                };
            });

            if (spell["Components"]) {
                ["v", "s", "m"].forEach((comp) => {
                    if (spell["Components"].toLowerCase().indexOf(comp) === -1) {update[`${repeatingRow}_spellcomp_${comp}`] = "0"};
                });
            };

            if(data["Damage"] || data["Healing"]) {
                //This needs to run the create_attack_from_spell
                callbacks.push(() => { create_attack_from_spell(lvl, newrowid, currentData.character_id); });
            } else if (page.data["Higher Spell Slot Desc"] && page.data["Higher Spell Slot Desc"] != "") {
                //This needs to run the update_spelloutput
                console.debug("MISSING HIGHER LEVEL SLOT FOR NPC SPELLS");
            };

            /*
            if (spell["data-Cantrip Scaling"] && lvl == "cantrip") {
                update[`${repeatingRow}_spell_damage_progression`] = "Cantrip " + spell["data-Cantrip Scaling"].charAt(0).toUpperCase() + spell["data-Cantrip Scaling"].slice(1);
            };
            */

            if (innate) {
                const spellName = (spell.Name).toLowerCase();
                //Search each keys in INNATE to see if spell name === one of the Values
                Object.keys(innate).map((objectKey, index) => {
                    innate[objectKey].forEach((spell) => {
                        (spell === spellName) ? update[`${repeatingRow}_innate`] = objectKey : false;
                    });
                });
            };

            update[repeatingRow + "_options-flag"] = "0";
            update[repeatingRow + "_details-flag"] = "0";
        });

        setAttrs(update, {silent: true}, () => {
            callbacks.forEach((callback) => {
                callback();
            })
        });

        return {
            callbacks: callbacks
        };

    });

  }

  // cleanup
  callbacks.push( function() { cleanup_drop_fields();} );

  return { update: update, callbacks: callbacks }
};


  const drop_item_attrs = ["drop_name", "drop_level", "drop_properties",
                           "drop_content", "drop_data"];


  /*{"Damage":"1d6","Weight":"2","Category":"Items","Expansion":"7583",
  "Item Type":"Weapon","Modifiers":"Melee Attacks +1, Melee Damage +1","data-List":"false",
  "Properties":"Finesse, Light","Damage Type":"piercing","Item Rarity":"uncommon",
  "data-description":"You have a bonus to attack and damage rolls made with this magic weapon. The bonus is determined by the weapons rarity.",
  "blobs":{},"expansion":7583}
  */

  var handle_drop_item = function(v) {
    var callbacks = [];
    var update = {};

    const name = v.drop_name;
    const data = JSON.parse(v.drop_data);
    const item_type = data['Item Type'];

    console.log("Handle Drop Item called (UNFINISHED!): "+name + " (" + item_type + ")");
    console.log("   DATA: "+JSON.stringify(data));

    // TODO: Add item to inventory if we have room

    // TODO: Other actions we may do based on item type
    if (item_type == 'Melee Weapon') {
      // add an attack if not present already
      var attack = {name: name, attk_type: "melee", dam_die: data["Damage"], dam_type: data["Damage Type"]};
      // callbacks.push( function () { add_attack_if_missing({name: name, attk_type: "melee", dam_die: data["Damage"], dam_type: data["Damage Type"]}); });
    }


    // clean up
    callbacks.push( function() {cleanup_drop_fields();} );

    return { update: update, callbacks: callbacks }

  };

  const drop_spell_attrs = ["drop_name","drop_level","drop_properties",
                    "drop_damage", "drop_damagetype",
                    // "drop_damage2", "drop_damagetype2",
//                    "drop_spellcasting_ability",
                    "drop_content", "drop_data",
                    "drop_spell_castingtime", "drop_spell_concentration",
                    "drop_spell_components", "drop_spell_duration",
                    "drop_spell_healamount", "drop_spell_range",
                    "drop_spell_ritual", "drop_spell_savestat",
                    "drop_spell_savesuccess", "drop_spell_school",
                    "drop_spell_target"];

  var handle_drop_spell = function(category, eventinfo) {
    var callbacks = [];
    var update = {};

    if(category === "Spells") {
      getAttrs([...drop_spell_attrs, "character_id"], function(v) {

        //console.log(`%c SPELL: ${page.name} dropped`, "color: purple; font-weight:14px;");
        console.log("Handle Drop Spell called:"+v.drop_name+ " char:"+v.character_id);
        // console.log(" data:"+v.drop_data);
        // console.debug("content: "+v.drop_content);
        //console.log(" properites:"+v.drop_properties);

        var data = {};
        try {
            data = JSON.parse(v.drop_data);
        } catch(e) {
            data = v.drop_data;
        }

        // Workaround: we treat cantrips as (cruddy) level 1 spells
        var lvl = parseInt(data["Level"]) || 0;
        const is_cantrip = lvl == 0 ? true : false;
        lvl  = lvl > 0 ? lvl : 1;

        const spell_name = v.drop_name;
        const spell_level = parseInt(v.drop_level) || 0;

        const id = generateRowID();
        const repeating_source = `repeating_spells-${lvl}_${id}`;

        update[repeating_source + "_spellname"] = data["Name"];
        update[repeating_source + "_spelllevel"] = lvl;
        update[repeating_source + "_spelloutput"] = "SPELLCARD";
        update[repeating_source + "_spelldescription"] = data["data-description"] ? data["data-description"] : v.drop_content;

        update[repeating_source + "_includedesc"] = "on";

        if (is_cantrip) {
           update[repeating_source + "_innate"] = "at-will";
        }

        if(data["Ritual"]) {
          update[repeating_source + "_spellritual"] = "{{ritual=1}}"};
        if(data["School"]) {
          update[repeating_source + "_spellschool"] = data["School"].toLowerCase()};
        if(data["Casting Time"]) {
          update[repeating_source + "_spellcastingtime"] = data["Casting Time"]};
        if(data["Range"]) {
          update[repeating_source + "_spellrange"] = data["Range"]};
        if(data["Target"]) {
          update[repeating_source + "_spelltarget"] = data["Target"]};

        if(data["Components"]) {
            ["v", "s", "m"].forEach((comp) => {
              if(data["Components"].toLowerCase().indexOf(comp) === -1) {update[repeating_source + `_spellcomp_${comp}`] = "0"};
            });
        };

        if(data["Material"]) {
          update[repeating_source + "_spellcomp_materials"] = data["Material"]};
        if(data["Concentration"]) {
          update[repeating_source + "_spellconcentration"] = "{{concentration=1}}"};
        if(data["Duration"]) {
          update[repeating_source + "_spellduration"] = data["Duration"]};

        if(data["Damage"] || data["Healing"]) {
            update[repeating_source + "_spelloutput"] = "ATTACK";
            callbacks.push( function() { create_attack_from_spell(lvl, id, v.character_id); });
        }
        else if(data["Higher Spell Slot Desc"] && data["Higher Spell Slot Desc"] != "") {
            var spelllevel = "?{Cast at what level?";
            for(i = 0; i < 10-lvl; i++) {
                spelllevel = spelllevel + "|Level " + (parseInt(i, 10) + parseInt(lvl, 10)) + "," + (parseInt(i, 10) + parseInt(lvl, 10));
            }
            spelllevel = spelllevel + "}";

	          // console.log("Using rollcontent 1(higher spellslot)\n");
            update[repeating_source + "_rollcontent"] = `@{wtype}&{template:spell} {{level=@{spellschool} ${spelllevel}}} {{name=@{spellname}}} {{castingtime=@{spellcastingtime}}} {{range=@{spellrange}}} {{target=@{spelltarget}}} @{spellcomp_v} @{spellcomp_s} @{spellcomp_m} {{material=@{spellcomp_materials}}} {{duration=@{spellduration}}} {{description=@{spelldescription}}} {{athigherlevels=@{spellathigherlevels}}} {{innate=@{innate}}} @{spellconcentration} @{charname_output} {{licensedsheet=@{licensedsheet}}}`;
        };

        if(data["Spell Attack"]) {
          update[repeating_source + "_spellattack"] = data["Spell Attack"]};
        if(data["Damage"]) {
          update[repeating_source + "_spelldamage"] = data["Damage"]};
        if(data["Damage Type"]) {
          update[repeating_source + "_dmgtype"] = data["Damage Type"]};
        if(data["Secondary Damage"]) {
          update[repeating_source + "_spelldamage2"] = data["Secondary Damage"]};
        if(data["Secondary Damage Type"]) {
          update[repeating_source + "_dmgtype2"] = data["Secondary Damage Type"]};
        if(data["Healing"]) {
          update[repeating_source + "_spellhealing"] = data["Healing"];
        };
        // if(data["Add Casting Modifier"]) {
        //  update[repeating_source + "_spelldmgmod"] = data["Add Casting Modifier"]};
        if(data["Save"]) {
          update[repeating_source + "_spellsave"] = data["Save"]};
        if(data["Save Success"]) {
          update[repeating_source + "_spellsavesuccess"] = data["Save Success"]};
        if(data["Higher Spell Slot Dice"]) {
          update[repeating_source + "_spellhldie"] = data["Higher Spell Slot Dice"]};
        if(data["Higher Spell Slot Die"]) {
          update[repeating_source + "_spellhldietype"] = data["Higher Spell Slot Die"]};
        if(data["Higher Spell Slot Bonus"]) {
          update[repeating_source + "_spellhlbonus"] = data["Higher Spell Slot Bonus"]};
        if(data["Higher Spell Slot Desc"]) {
          update[repeating_source + "_spellathigherlevels"] = data["Higher Spell Slot Desc"]};
        /*
        if(data["data-Cantrip Scaling"] && lvl == "cantrip") {update[repeating_source + "_spell_damage_progression"] = "Cantrip " + data["data-Cantrip Scaling"].charAt(0).toUpperCase() + data["data-Cantrip Scaling"].slice(1);};
        */

        update[repeating_source + "_details-flag"] = "0";
        update[repeating_source + "_options-flag"] = "0";

        // set callbacks to update new spells and clean up
        callbacks.push( function() { update_spells('all');} );
        callbacks.push( function() { cleanup_drop_fields();} );

        // persist new attributes
        setAttrs(update, {silent: true}, function() {callbacks.forEach(function(callback) {callback(); })} );

      });
    }
  };

  const create_attack_from_spell = function(lvl, spellid, character_id) {

      console.log("CREATE ATTACK FROM SPELL");
      let update   = {};
      const newrowid = generateRowID();
      update[`repeating_spells-${lvl}_${spellid}_spellattackid`] = newrowid;
      update[`repeating_spells-${lvl}_${spellid}_rollcontent`] = `%{${character_id}|repeating_attacks_${newrowid}_attack}`;

      let rollcontent = `%{${character_id}|repeating_attacks_${newrowid}_attack}`;
      console.log("SET rollcontent (attack) to:"+rollcontent);

      console.log("Create_attack_from_spell lvl:"+lvl+" spellid:"+spellid+" charid:"+character_id);
      setAttrs(update, {}, update_attack_from_spell(lvl, spellid, newrowid, true));
  }

  const update_attack_from_spell = (lvl, spellid, attackid, newattack) => {

      console.log("update_attack_from_spell lvl:"+lvl+" spellid:"+spellid+" attackid:"+attackid+" new:"+newattack);

      const repeating_spell  = `repeating_spells-${lvl}_${spellid}`;
      const repeating_attacks = `repeating_attacks_${attackid}`;

      getAttrs([`${repeating_spell}_spellname`, `${repeating_spell}_spellrange`, `${repeating_spell}_spelltarget`, `${repeating_spell}_spellattack`, `${repeating_spell}_spelldamage`, `${repeating_spell}_spelldamage2`,`${repeating_spell}_dmgtype`,`${repeating_spell}_dmgtype2`,`${repeating_spell}_spellhealing`,`${repeating_spell}_spellsave`,`${repeating_spell}_spellsavesuccess`,`${repeating_spell}_spellhldie`,`${repeating_spell}_spellhldietype`,`${repeating_spell}_spellhlbonus`,`${repeating_spell}_spelllevel`,`${repeating_spell}_includedesc`,`${repeating_spell}_spelldescription`,`${repeating_spell}_spellathigherlevels`,`${repeating_spell}_spell_damage_progression`,`${repeating_spell}_innate`], (v) => {

          let update = {};
          let description = "";

          // const spellAbility = (v[`${repeating_spell}_spell_ability`] != "spell") ? v[`${repeating_spell}_spell_ability`].slice(0, -1) : "spell";
          // update[`${repeating_attacks}_atkattr_base`] = spellAbility;

          if (newattack) {
              update[`${repeating_attacks}_options-flag`] = "0";
              update[`${repeating_attacks}_spellid`]      = spellid;
              update[`${repeating_attacks}_spelllevel`]   = lvl;
          }

          /*
          if (v[`${repeating_spell}_spell_ability`] == "spell") {
              update[`${repeating_attacks}_savedc`] = "(@{spell_save_dc})";
          } else if (v[`${repeating_spell}_spell_ability`]) {
	      // TODO: We dont calc as 5e
              // update[`${repeating_attacks}_savedc`] = `(${spellAbility}+8+@{spell_dc_mod}+@{pb})`;
              update[`${repeating_attacks}_savedc`] = `(${spellAbility}+8+@{spell_dc_mod})`;
          }
          */

          if (v[`${repeating_spell}_spellname`] && v[`${repeating_spell}_spellname`] != "") {
              update[`${repeating_attacks}_atkname`] = v[`${repeating_spell}_spellname`];
          }

          update[`${repeating_attacks}_atkflag`] = (!v[`${repeating_spell}_spellattack`] || v[`${repeating_spell}_spellattack`] === "None") ? "0" : "{{attack=1}}";

          if (v[`${repeating_spell}_spellattack`] || !v[`${repeating_spell}_spellattack`] === "None") {
              description = description + v[`${repeating_spell}_spellattack`] + " Spell Attack. ";
          };

          if (v[`${repeating_spell}_spelldamage`] && v[`${repeating_spell}_spelldamage`] != "") {
              update[`${repeating_attacks}_dmgbase`] =
                  (v[`${repeating_spell}_spell_damage_progression`] && v[`${repeating_spell}_spell_damage_progression`] === "Cantrip Dice") ? "[[round((@{level} + 1) / 6 + 0.5)]]" + v[`${repeating_spell}_spelldamage`].substring(1) :
                  v[`${repeating_spell}_spelldamage`];
          };

          update[`${repeating_attacks}_attack_form`] = "spell";
          update[`${repeating_attacks}_dmgflag`] = (v[`${repeating_spell}_spelldamage`] && v[`${repeating_spell}_spelldamage`] != "") ? "{{damage=1}} {{dmg1flag=1}}" : "0";
          // update[`${repeating_attacks}_dmgattr`] = (v[`${repeating_spell}_spelldmgmod`] && v[`${repeating_spell}_spelldmgmod`] === "Yes") ? spellAbility : "0";
          update[`${repeating_attacks}_dmgtype`] = (v[`${repeating_spell}_dmgtype`]) ? v[`${repeating_spell}_dmgtype`] : "";

          // update[`${repeating_attacks}_dmg2base`] = (v[`${repeating_spell}_spelldamage2`]) ? v[`${repeating_spell}_spelldamage2`] : "";
          // update[`${repeating_attacks}_dmg2attr`] = "0";
          // update[`${repeating_attacks}_dmg2flag`] = (v[`${repeating_spell}_spelldamage2`]) ? "{{damage=1}} {{dmg2flag=1}}" : 0;
          // update[`${repeating_attacks}_dmg2type`] = (v[`${repeating_spell}_dmgtype2`]) ? v[`${repeating_spell}_dmgtype2`] : "";

          update[`${repeating_attacks}_atkrange`] = (v[`${repeating_spell}_spellrange`]) ? v[`${repeating_spell}_spellrange`] : "";
          update[`${repeating_attacks}_saveflag`] = (v[`${repeating_spell}_spellsave`]) ? "{{save=1}} {{saveattr=@{saveattr}}} {{savedesc=@{saveeffect}}} {{savedc=[[[[@{savedc}]][SAVE]]]}}" : "0";
          update[`${repeating_attacks}_saveeffect`] = (v[`${repeating_spell}_spellsavesuccess`]) ? v[`${repeating_spell}_spellsavesuccess`] : "";

          if(v[`${repeating_spell}_spellsave`]) {
              update[`${repeating_attacks}_saveattr`] = v[`${repeating_spell}_spellsave`];
          };

          if(v[`${repeating_spell}_spellhldie`] && v[`${repeating_spell}_spellhldie`] != "" && v[`${repeating_spell}_spellhldietype`] && v[`${repeating_spell}_spellhldietype`] != "") {
              let bonus = "";
              const spelllevel = v[`${repeating_spell}_spelllevel`];
              let query = "?{Cast at what level?";
              for(i = 0; i < 10-spelllevel; i++) {
                  query = query + "|Level " + (parseInt(i, 10) + parseInt(spelllevel, 10)) + "," + i;
              }
              query = query + "}";
              if(v[`${repeating_spell}_spellhlbonus`] && v[`${repeating_spell}_spellhlbonus`] != "") {
                  bonus = "+(" + v[`${repeating_spell}_spellhlbonus`] + "*" + query + ")";
              }
              update[`${repeating_attacks}_hldmg`] = `{{hldmg=[[(${v[`${repeating_spell}_spellhldie`]}*${query})${v[`${repeating_spell}_spellhldietype`]}${bonus}]]}}`;
          } else {
              update[`${repeating_attacks}_hldmg`] = "";
          }

          if (v[`${repeating_spell}_spellhealing`] && v[`${repeating_spell}_spellhealing`] != "") {
              if(!v[`${repeating_spell}_spelldamage`] || v[`${repeating_spell}_spelldamage`] === "") {
                  update[`${repeating_attacks}_dmgbase`] = v[`${repeating_spell}_spellhealing`];
                  update[`${repeating_attacks}_dmgflag`] = "{{damage=1}} {{dmg1flag=1}}";
                  update[`${repeating_attacks}_dmgtype`] = "Healing";
             //  } else if (!v[`${repeating_spell}_spelldamage2`] || v[`${repeating_spell}_spelldamage2`] === "") {
             //     update[`${repeating_attacks}_dmg2base`] = v[`${repeating_spell}_spellhealing`];
             //     update[`${repeating_attacks}_dmg2flag`] = "{{damage=1}} {{dmg2flag=1}}";
             //     update[`${repeating_attacks}_dmg2type`] = "Healing";
              }
          }

          update[`${repeating_attacks}_spell_innate`] = (v[`${repeating_spell}_innate`]) ? v[`${repeating_spell}_innate`] : "";

          if(v[`${repeating_spell}_spelltarget`]) {
              description = description + v[`${repeating_spell}_spelltarget`] + ". ";
          }
          if(v[`${repeating_spell}_includedesc`] && v[`${repeating_spell}_includedesc`] === "on") {
              description = v[`${repeating_spell}_spelldescription`];
              if(v[`${repeating_spell}_spellathigherlevels`] && v[`${repeating_spell}_spellathigherlevels`] != "") {
                  description = description + "\n\nAt Higher Levels: " + v[`${repeating_spell}_spellathigherlevels`];
              }
          } else if(v[`${repeating_spell}_includedesc`] && v[`${repeating_spell}_includedesc`] === "off") {
              description = "";
          };
          update[`${repeating_attacks}_atk_desc`] = description;

          var callback = () => { update_attacks(attackid, "spell") };
          setAttrs(update, {silent: true}, callback);
      });
  };

  const update_attacks = (update_id, source) => {

      console.debug("UPDATE ATTACKS id:"+update_id+" src:"+source);

      // passed a attack row id, update single attack
      if (update_id && update_id.substring(0,1) === "-" && update_id.length === 20) {
          do_update_attack([update_id], source);

      } else if (["strength","dexterity","constitution","intelligence","wisdom","charisma","spells","all"].indexOf(update_id) > -1) {
          getSectionIDs("repeating_attacks", (idarray) => {
              if (update_id === "all") {
                  // check everything
                  do_update_attack(idarray);

              } else if (update_id === "spells") {
                  // check spell-related attacks

                  let attack_attribs = [];
                  _.each(idarray, (id) => {
                      attack_attribs.push(`repeating_attacks_${id}_spellid`, `repeating_attacks_${id}_spelllevel`);
                  });
                  getAttrs(attack_attribs, (v) => {
                      const filteredIds = _.filter(idarray, (id) => {
                          return v[`repeating_attacks_${id}_spellid`] && v[`repeating_attacks_${id}_spellid`] != "";
                      });
                      let spell_attacks = {};
                      _.each(filteredIds, (attack_id) => {
                          spell_attacks[attack_id] = {
                              spell_id: v[`repeating_attacks_${attack_id}_spellid`],
                              spell_lvl: v[`repeating_attacks_${attack_id}_spelllevel`]
                          };
                      });
                      _.each(spell_attacks, (data, attack_id) => { update_attack_from_spell(data.spell_lvl, data.spell_id, attack_id); });
                  });

              } else {

	          // attribute-based
                  getAttrs(attack_attribs, (v) => {
                      let attr_attack_ids = [];
                      _.each(idarray, (id) => {
			                    if ((v[`repeating_attacks_${id}_atkattr_base`] && v[`repeating_attacks_${id}_atkattr_base`].indexOf(update_id) > -1) || (v[`repeating_attacks_${id}_savedc`] && v[`repeating_attacks_${id}_savedc`].indexOf(update_id) > -1) || (v[`repeating_attacks_${id}_savedc`] && v[`repeating_attacks_${id}_savedc`] === "(@{spell_save_dc})")) {
                              attr_attack_ids.push(id);
                          }
                      });
                      if (attr_attack_ids.length > 0) {
                          do_update_attack(attr_attack_ids);
                      }
                  });
              };
          });
      };
      update_attacks2();
  };

  const do_update_attack = (attack_array, source) => {

      console.log("DO UPDATE ATTACK array:"+attack_array);

      let attack_attribs = ["level","d20","pb","pb_type","pbd_safe","strength_mod","dexterity_mod","constitution_mod","intelligence_mod","wisdom_mod","charisma_mod","spell_save_dc","spell_attack_mod", "spell_dc_mod" ];
      _.each(attack_array, (attackid) => {
          ["attack_form", "atkflag", "atkattr_base","atkmod","atkprofflag","atkmagic","dmgflag","dmgbase","dmgtype","dmg2flag","dmg2base","dmg2type","dmgcustcrit","dmg2custcrit","saveflag","savedc","saveeffect","saveflat","hldmg","spellid","spelllevel","atkrange","itemid","ammo",].forEach((attr) => {
              attack_attribs.push(`repeating_attacks_${attackid}_${attr}`)
          });
      });

      getAttrs([...attack_attribs, 'character_name'], (v) => {
          _.each(attack_array, (attackid) => {
              const repeating_attacks = `repeating_attacks_${attackid}`;
              let callbacks          = [];
              let update             = {};
              let hbonus             = "";
              let hdmg1              = "";
              let hdmg2              = "";
              let dmg                = "";
              let dmg2               = "";
              let rollbase           = "";
              let spellattack        = false;
              let magicattackmod     = 0;
              let magicsavemod       = 0;
              let atkattr_abrev      = "";
              //let dmg2attr_abrev     = "";
              //PROFICIENCY BONUS select in Settings.
              const pbd_safe = v["pbd_safe"] || "";

              const character_name     = v.character_name;
	      const attack_form        = v[repeating_attacks + "_attack_form"];

	      console.log("ATTACK FORM:"+attack_form);

              //HIGHER LVL CAST DMG found in Spells for spells like Fireball
              const hldmgcrit = (v[`${repeating_attacks}_hldmg`] && v[`${repeating_attacks}_hldmg`] != "") ? v[`${repeating_attacks}_hldmg`].slice(0, 7) + "crit" + v[`${repeating_attacks}_hldmg`].slice(7) : "";

              if (v[`${repeating_attacks}_spellid`] && v[`${repeating_attacks}_spellid`] != "") {
                  spellattack    = true;
                  //GLOBAL MAGIC ATTACK MODIFIER in Settings
                  magicattackmod = parseInt(v["spell_attack_mod"],10) || 0;
                  //SPELL SAVE DC MOD in Settings
                  magicsavemod   = parseInt(v["spell_dc_mod"],10) || 0;
              };

              //ATTACK select inside settings for the repeating attack
              if (!v[`${repeating_attacks}_atkattr_base`] || v[`${repeating_attacks}_atkattr_base`] === "0") {
                  atkattr_base = 0
              } else if (v[`${repeating_attacks}_atkattr_base`] && v[`${repeating_attacks}_atkattr_base`] === "spell") {
	          // TODO
                  // atkattr_base  = 0; // parseInt(v[v["spellcasting_ability"].substring(2, v["spellcasting_ability"].length - 2)], 10);
                  // atkattr_abrev = ""; // v["spellcasting_ability"].substring(2, 5).toUpperCase();
              } else {
                  // atkattr_base = parseInt(v[v[`${repeating_attacks}_atkattr_base`].substring(2, v[`${repeating_attacks}_atkattr_base`].length - 1)], 10);
                  // atkattr_abrev = v[`${repeating_attacks}_atkattr_base`].substring(2, 5).toUpperCase();
              };

              //DAMAGE 1 ability select inside settings for the repeating attack
              //if (!v[`${repeating_attacks}_dmgattr`] || v[`${repeating_attacks}_dmgattr`] === "0") {
              //    dmgattr = 0;
              //} else if (v[`${repeating_attacks}_dmgattr`] && v[`${repeating_attacks}_dmgattr`] === "spell") {
              //    dmgattr = parseInt(v[v["spellcasting_ability"].substring(2, v["spellcasting_ability"].length - 2)], 10);
              //    dmgattr_abrev = v["spellcasting_ability"].substring(2, 5).toUpperCase();
              // } else {
              //    dmgattr = parseInt(v[v[`${repeating_attacks}_dmgattr`].substring(2, v[`${repeating_attacks}_dmgattr`].length - 1)], 10);
              //    dmgattr_abrev = v[`${repeating_attacks}_dmgattr`].substring(2, 5).toUpperCase();
              // };

              //DAMAGE 2 ability select inside settings for the repeating attack
              //if (!v[`${repeating_attacks}_dmg2attr`] || v[`${repeating_attacks}_dmg2attr`] === "0") {
              //    dmg2attr = 0;
              //} else if (v[`${repeating_attacks}_dmg2attr`] && v[`${repeating_attacks}_dmg2attr`] === "spell") {
              //    dmg2attr = parseInt(v[v["spellcasting_ability"].substring(2, v["spellcasting_ability"].length - 2)], 10);
              //    dmg2attr_abrev = v["spellcasting_ability"].substring(2, 5).toUpperCase();
              //} else {
              //    dmg2attr = parseInt(v[v[`${repeating_attacks}_dmg2attr`].substring(2, v[`${repeating_attacks}_dmg2attr`].length - 1)], 10);
              //    dmg2attr_abrev =v[`${repeating_attacks}_dmg2attr`].substring(2, 5).toUpperCase();
              //};

              //DAMAGE first input inside settings for the repeating attack
              let dmgbase  = v[`${repeating_attacks}_dmgbase`] || 0;
              let dmg2base = v[`${repeating_attacks}_dmg2base`] || 0;

	      // TODO: remove dmgmod, dmg2mod
              const dmgmod  = parseInt(v[`${repeating_attacks}_dmgmod`],10) || 0;
              //DAMAGE 2 second input inside settings for the repeating attack
              const dmg2mod = parseInt(v[`${repeating_attacks}_dmg2mod`],10) || 0;
              //DAMAGE 1 TYPE input inside settings for the repeating attack
              const dmgtype  = v[`${repeating_attacks}_dmgtype`] || "";
              //DAMAGE 2 TYPE input inside settings for the repeating attack
              const dmg2type = v[`${repeating_attacks}_dmg2type`] || "";

              //PROFICIENT flag inside settings for the repeating attack && PROFICIENCY BONUS from Settings
	      // TODO
              //const atkprofflag = v[`${repeating_attacks}_atkprofflag`] || 0;
              //const pb          = (atkprofflag != 0 && v.pb) ? v.pb : 0;
              const pb          = 0;

              //ATTACK input inside settings for the repeating attack
              const atkmod = parseInt(v[`${repeating_attacks}_atkmod`],10) || 0;
              //MAGIC BONUS input inside settings for the repeating attack
              const atkmag = parseInt(v[`${repeating_attacks}_atkmagic`],10) || 0;

              //used in _atkdmgtype display
              const dmgmag = (isNaN(atkmag) === false && atkmag != 0 && ((v[`${repeating_attacks}_dmgflag`] && v[`${repeating_attacks}_dmgflag`] != 0) || (v[`${repeating_attacks}_dmg2flag`] && v[`${repeating_attacks}_dmg2flag`] != 0))) ? `+ ${atkmag} Magic Bonus` : "";

             //ATTACK checkbox inside settings for the repeating attack
              const atkflag = v[`${repeating_attacks}_atkflag`] || 0;
              if (atkflag != 0) {
                  bonus_mod  = atkattr_base + atkmod + atkmag + magicattackmod;
                  plus_minus = (bonus_mod > -1) ? "+" : "";
                  //pb_type is PROFICIENCY BONUS select in Settings
                  if (v["pb_type"] && v["pb_type"] === "die") {
                      bonus  = `${bonus_mod}+${pb}`;
                  } else {
                      bonus_mod  = bonus_mod + parseInt(pb, 10);
                      bonus      = plus_minus + bonus_mod;
                  };

              //SAVING THROW checkbox inside settings for the repeating attack
              } else if (v[`${repeating_attacks}_saveflag`] && v[`${repeating_attacks}_saveflag`] != 0) {
                  const saveDC = v[`${repeating_attacks}_savedc`] || "";
                  //SAVING THROW VS DC select "Spell" inside settings for the repeating attack
                  if (!saveDC || saveDC === "(@{spell_save_dc})") {
                      const tempdc = v["spell_save_dc"];
                      bonus = "DC" + tempdc;
                  //SAVING THROW VS DC select "FLAT" inside settings for the repeating attack
                  } else if (saveDC === "(@{saveflat})") {
                      const tempdc = parseInt(v[`${repeating_attacks}_saveflat`]) || 0;
                      bonus = "DC" + tempdc;
                  //SAVING THROW VS DC select ability score inside settings for the repeating attack
                  } else {
                      const savedcattr = v[`${repeating_attacks}_savedc`].split("_mod")[0].slice(3);
		      // TODO
                      // const safe_pb    = v["pb_type"] && v["pb_type"] === "die" ? parseInt(pb.substring(1), 10) / 2 : parseInt(pb,10);
		      const save_pb = 0;
                      const safe_attr  = v[`${savedcattr}_mod`] ? parseInt(v[`${savedcattr}_mod`],10) : 0;
                      const tempdc     = 8 + safe_attr + safe_pb + magicsavemod;
                      bonus = "DC" + tempdc;
                  };
              } else {
                  bonus = "-";
              }

              //DAMAGE checkbox inside settings for the repeating attack
              const dmgflag1 = v[`${repeating_attacks}_dmgflag`] || 0;
              // const dmgflag2 = v[`${repeating_attacks}_dmg2flag`] || 0;
              if (dmgflag1 != 0) {
                  if (spellattack === true && dmgbase.indexOf("[[round((@{level} + 1) / 6 + 0.5)]]") > -1) {
                      // SPECIAL CANTRIP DAMAGE
                      dmgdiestring = Math.round(((parseInt(v["level"], 10) + 1) / 6) + 0.5).toString();
                      dmg = dmgdiestring + dmgbase.substring(dmgbase.lastIndexOf("d"));

                      //select & input to the right of damage
                      //if (dmgattr + dmgmod != 0) {
                      //    dmg += `+${(dmgattr + dmgmod)}`;
                      //}
                      dmg += ` ${dmgtype}`;
                  } else {
                      //if (dmgbase === 0 && (dmgattr + dmgmod === 0)) {
                          dmg = 0;
                      //}
                      if (dmgbase != 0) {
                          dmg = dmgbase;
                      }
                      //if (dmgbase != 0 && (dmgattr + dmgmod != 0)) {
                      //    dmg = (dmgattr + dmgmod > 0) ? dmg + "+" : dmg;
                      // }
                      //if (dmgattr + dmgmod != 0) {
                      //    dmg = dmg + (dmgattr + dmgmod);
                      //}
                      dmg = dmg + " " + dmgtype;
                  }
              };
	      /*
              if (dmgflag2 != 0) {
                  //if (dmg2base === 0 && (dmg2attr + dmg2mod === 0)) {
                      dmg2 = 0;
                  //}
                  if (dmg2base != 0) {
                      dmg2 = dmg2base;
                  }
                  //if (dmg2base != 0 && (dmg2attr + dmg2mod != 0)) {
                  //    dmg2 = (dmg2attr + dmg2mod > 0) ? dmg2 + "+" : dmg2;
                  //}
                  //if (dmg2attr + dmg2mod != 0) {
                  //    dmg2 = dmg2 + (dmg2attr + dmg2mod);
                  // }
                  dmg2 = dmg2 + " " + dmg2type;
              };
              update[`${repeating_attacks}_atkdmgtype`] = (dmgflag1 != 0 && dmgflag2 != 0) ? `${dmg} + ${dmg2}${dmgmag} `:`${dmg}${dmg2}${dmgmag} `;
	      */
              update[`${repeating_attacks}_atkdmgtype`] = (dmgflag1 != 0) ? `${dmg} + ${dmgmag} `:`${dmg}${dmgmag} `;

              //Build ROLL TEMPLATE with below variables
              //ATTACK checkbox inside settings for the repeating attack
              if (atkflag != 0) {
	          // TODO
                  // if (atkattr_base   != 0) {hbonus += ` + ${atkattr_base}[${atkattr_abrev}]`};
                  if (atkmod         != 0) {hbonus += ` + ${atkmod}[MOD]`};
                  if (pb             != 0) {hbonus += ` + ${pb}${pbd_safe}[PROF]`};
                  if (atkmag         != 0) {hbonus += ` + ${atkmag}[MAGIC]`};
                  if (magicattackmod != 0) {hbonus += ` + ${magicattackmod}[SPELLATK]`};
              }
              //DAMAGE 1 checkbox inside settings for the repeating attack
              if (dmgflag1 != 0) {
                  hdmg1 += dmgbase;
                  // if (dmgattr != 0) {hdmg1 += ` + ${dmgattr}[${dmgattr_abrev}]`};
                  // if (dmgmod  != 0) {hdmg1 += ` + ${dmgmod}[MOD]`};
                  if (atkmag  != 0) {hdmg1 += ` + ${atkmag}[MAGIC]`};
              } else {
                  hdmg1 += "0";
              }
              //DAMAGE 2 checkbox inside settings for the repeating attack
	      /*
              if (dmgflag2 != 0) {
                  hdmg2 += dmg2base
                  // if (dmg2attr != 0) {hdmg2 += ` + ${dmg2attr}[${dmg2attr_abrev}]`};
                  if (dmg2mod  != 0) {hdmg2 += ` + ${dmg2mod}[MOD]`};
              } else {
                  hdmg2 += "0";
              }
	      */
              //CRIT input inside settings for the repeating attack
              let crit1 = v[`${repeating_attacks}_dmgcustcrit`] || 0;
              let crit2 = v[`${repeating_attacks}_dmg2custcrit`] || 0;
              crit1 = (crit1 != 0) ? v[`${repeating_attacks}_dmgcustcrit`] : dmgbase;
              crit2 = (crit2 != 0) ? v[`${repeating_attacks}_dmg2custcrit`] : dmg2base;
              r1    = (atkflag != 0) ? "@{d20}" : "0d20";
              r2    = (atkflag != 0) ? "@{rtype}" : "{{r2=[[0d20";
              //set in the GLOBAL DAMAGE MODIFIER section

              //Assemble Roll Templates
	      if (attack_form == "spell") {
	          rollbase = `@{wtype}&{template:atkdmg} {{mod=@{atkbonus}}} {{name=@{character_name}}} {{rname=@{atkname}}} {{r1=[[${r1}cs>@{atkcritrange}${hbonus}]]}} ${r2}cs>@{atkcritrange}${hbonus}]]}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[${hdmg1}]]}} {{dmg1type=${dmgtype}}} {{crit1=[[${crit1}[CRIT]]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg} ${hldmgcrit} {{spelllevel=@{spelllevel}}} {{innate=@{spell_innate}}} ammo=@{ammo} @{charname_output} {{licensedsheet=@{licensedsheet}}}`;
	      } else {
	          rollbase =`@{wtype}&{template:roll_check} {{character_name=@{character_name}}} ammo=@{ammo} {{name=@{atkname}}} {{innate=}} {{spelllevel={@spelllevel}}} {{title=@{atkname} <b>Attack</b>}} {{subheader=@{character_name}}} {{subheader2=@{attack_damage_msg}}} {{attack=1}} {{attack=[[1d20cs>@{attack_crit_number} + [[@{atkbonus}]] ]]}} {{critical=[[19 + @{atkbonus} - @{attack_crit_range_adj}]]}} {{fumble=[[2+@{atkbonus}]] }} {{damage=[[@{attack_dam} + @{attack_dam_bonus} ]]}} {{damagetype=@{dmgtype}}} {{critdamage=[[@{attack_dam} + @{attack_dam} + @{attack_dam_bonus} ]]}} {{math=1d20 + [[@{atkbonus}]] [Attack], @{attack_dam} + @{attack_dam_bonus} [@{dmgtype} Damage] }} {{description=}}`;
	      }

              update[`${repeating_attacks}_rollbase_dmg`]  = `@{wtype}&{template:dmg} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[${hdmg1}]]}} {{dmg1type=${dmgtype}}} @{dmg2flag} {{dmg2=[[${hdmg2}]]}} {{dmg2type=${dmg2type}}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg} {{spelllevel=@{spelllevel}}} {{innate=@{spell_innate}}} @{charname_output} {{licensedsheet=@{licensedsheet}}}`;

              update[`${repeating_attacks}_rollbase_crit`] = `@{wtype}&{template:dmg} {{crit=1}} {{rname=@{atkname}}} @{atkflag} {{range=@{atkrange}}} @{dmgflag} {{dmg1=[[${hdmg1}]]}} {{dmg1type=${dmgtype}}} @{dmg2flag} {{dmg2=[[${hdmg2}]]}} {{dmg2type=${dmg2type}}} {{crit1=[[${crit1}]]}} {{crit2=[[${crit2}]]}} @{saveflag} {{desc=@{atk_desc}}} @{hldmg} ${hldmgcrit} {{spelllevel=@{spelllevel}}} {{innate=@{spell_innate}}} @{charname_output} {{licensedsheet=@{licensedsheet}}}`;

              update[`${repeating_attacks}_atkbonus`]      = bonus;
              update[`${repeating_attacks}_rollbase`]      = rollbase;

              if (v[`${repeating_attacks}_spellid`] && v[`${repeating_attacks}_spellid`] != "" && (!source || source && source != "spell") && v[`${repeating_attacks}_spellid`].length == 20) {
                  const spellid = v[`${repeating_attacks}_spellid`];
                  const lvl     = v[`${repeating_attacks}_spelllevel`];

		              // console.debug("UPDATE ATTACKS updating spell from attack calling");
		              // console.debug("  spellid:"+spellid+" attack_id:"+attackid);
                  callbacks.push(() => { update_spell_from_attack(lvl, spellid, 'repeating_attacks_'+attackid); });
              }

              if (v[`${repeating_attacks}_itemid`] && v[`${repeating_attacks}_itemid`] != "" && (!source || source && source != "item")) {
                  const itemid = v[`${repeating_attacks}_itemid`];
                  callbacks.push(() => {
                      update_item_from_attack(itemid, attackid);
                  });
              }
              setAttrs(update, {silent: true}, () => { callbacks.forEach((callback) => { callback(); }); });
          });
      });
  };

  // attack properties to use
  const attack_properties = ["atkname", "atkrange", "atkflag", "atkattr_base", "dmgbase", "dmgtype", "dmg2base", "dmg2type",
                             "saveflag", "saveattr", "saveeffect"];

  //Update spells in the attack section
  const update_spell_from_attack = (lvl, spellid, attack_id) => {

      console.debug("Update spell from attack splvl:"+lvl+" sp_id:"+spellid+" attk_id:"+attack_id);

      // const repeating_attacks = `repeating_attacks_${attack_id}`;
      const repeating_attacks = attack_id;
      const repeating_spell = `repeating_spell-${lvl}_${spellid}`;

      var attk_attribs = [];
      attack_properties.forEach( prop => {
	       attk_attribs.push(repeating_attacks + "_" + prop);
      });

      let update = {};
      getAttrs([...attk_attribs], (v) => {

          var dmgbase = v[`${repeating_attacks}_dmgbase`];
          // var dmg2base = v[`${repeating_attacks}_dmg2base`] || "";
          var dmgtype = v[`${repeating_attacks}_dmgtype`] || "Bludgeoning";
          // var dmg2type = v[`${repeating_attacks}_dmg2type`] || "";

          update[`${repeating_spell}_spellname`]        = v[`${repeating_attacks}_atkname`];
          update[`${repeating_spell}_spellrange`]       = v[`${repeating_attacks}_atkrange`] || "";
          update[`${repeating_spell}_spellsavesuccess`] = v[`${repeating_attacks}_saveeffect`] || "";

          // check for healing or attack damage
	        if (dmgbase) {

              update[`${repeating_spell}_spelldamage`] = dmgbase;
              if (dmgtype.toLowerCase() == "healing") {
                  update[`${repeating_spell}_spellhealing`] = dmgbase;
              } else {
                  update[`${repeating_spell}_spelldamage`] = dmgbase;
                  update[`${repeating_spell}_dmgtype`] = dmgtype;
	            }
          };

	  // pick up healing on 2nd type of damage(?)
	  //if (dmg2type && dmg2base) {
          //    if (dmg2type.toLowerCase() == "healing") {
          //        update[`${repeating_spell}_spellhealing`] = dmg2base;
    	  //    } else {
          //        update[`${repeating_spell}_spelldamage2`] = dmg2base;
          //        update[`${repeating_spell}_dmgtype2`] = dmg2type;
	  //    }
          // };

          //SAVING THROW checkbox inside settings for the repeating attack
          update[`${repeating_spell}_spellsave`] =
	      (v[`${repeating_attacks}_saveflag`] && v[`${repeating_attacks}_saveflag`] != "0") ? v[`${repeating_attacks}_saveattr`] : "";

	        //console.log("UPDATE Spell from attack using:"+JSON.stringify(update));
          setAttrs(update);
      });
  };

  var update_item_from_attack = function(itemid, attackid) {
      getAttrs(["repeating_attacks_" + attackid + "_atkname", "repeating_attacks_" + attackid + "_dmgbase", "repeating_attacks_" + attackid + "_dmg2base", "repeating_attacks_" + attackid + "_dmgtype", "repeating_attacks_" + attackid + "_dmg2type", "repeating_attacks_" + attackid + "_atkrange", "repeating_attacks_" + attackid + "_atkmod", "repeating_attacks_" + attackid + "repeating_inventory_" + itemid + "_itemmodifiers", "repeating_attacks_" + attackid + "_versatile_alt", "repeating_inventory_" + itemid + "_itemproperties", "repeating_attacks_" + attackid + "_atkmagic"], function(v) {
          var update = {};
          var mods = v["repeating_inventory_" + itemid + "_itemmodifiers"];
          var damage = v["repeating_attacks_" + attackid + "_dmgbase"] ? v["repeating_attacks_" + attackid + "_dmgbase"] : 0;
          var damage2 = v["repeating_attacks_" + attackid + "_dmg2base"] ? v["repeating_attacks_" + attackid + "_dmg2base"] : 0;
          var damagetype = v["repeating_attacks_" + attackid + "_dmgtype"] ? v["repeating_attacks_" + attackid + "_dmgtype"] : 0;
          var damagetype2 = v["repeating_attacks_" + attackid + "_dmg2type"] ? v["repeating_attacks_" + attackid + "_dmg2type"] : 0;
          var range = v["repeating_attacks_" + attackid + "_atkrange"] ? v["repeating_attacks_" + attackid + "_atkrange"] : 0;
          var attackmod = v["repeating_attacks_" + attackid + "_atkmod"] ? v["repeating_attacks_" + attackid + "_atkmod"] : 0;
          // var damagemod = v["repeating_attacks_" + attackid + "_dmgmod"] ? v["repeating_attacks_" + attackid + "_dmgmod"] : 0;
          var magicmod = v["repeating_attacks_" + attackid + "_atkmagic"] ? v["repeating_attacks_" + attackid + "_atkmagic"] : 0;
          var atktype = "";
          var altprefix = v["repeating_attacks_" + attackid + "_versatile_alt"] === "1" ? "Alternate " : "";

          if(/Alternate Damage:/i.test(v["repeating_inventory_" + itemid + "_itemmodifiers"])) {
              update["repeating_inventory_" + itemid + "_itemname"] = v["repeating_attacks_" + attackid + "_atkname"].replace(/\s*(?:\(One-Handed\)|\(Two-Handed\))/, "");
          } else {
              update["repeating_inventory_" + itemid + "_itemname"] = v["repeating_attacks_" + attackid + "_atkname"];
          }

          var attack_type_regex = /(?:^|,)\s*Item Type: (Melee|Ranged) Weapon(?:,|$)/i;
          var attack_type_results = attack_type_regex.exec(v["repeating_inventory_" + itemid + "_itemmodifiers"]);
          atktype = attack_type_results ? attack_type_results[1] : "";
          if(mods) {
              mods = mods.split(",");
          } else {
              mods = [];
          }

          var damage_regex = new RegExp("^\\s*" + altprefix + "Damage:\\s*(.+)$", "i");
          var damage_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(damage_found = damage_regex.exec(mods[i])) {
                  if(damage !== 0) {
                      mods[i] = mods[i].replace(damage_found[1], damage);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!damage_found && damage !== 0) {
              mods.push(altprefix + "Damage: " + damage);
          }

          var damage2_regex = new RegExp("^\\s*" + altprefix + "Secondary Damage:\\s*(.+)$", "i");
          var damage2_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(damage2_found = damage2_regex.exec(mods[i])) {
                  if(damage2 !== 0) {
                      mods[i] = mods[i].replace(damage2_found[1], damage2);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!damage2_found && damage2 !== 0) {
              mods.push(altprefix + "Secondary Damage: " + damage2);
          }

          var dmgtype_regex = new RegExp("^\\s*" + altprefix + "Damage Type:\\s*(.+)$", "i");
          var dmgtype_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(dmgtype_found = dmgtype_regex.exec(mods[i])) {
                  if(damagetype !== 0) {
                      mods[i] = mods[i].replace(dmgtype_found[1], damagetype);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!dmgtype_found && damagetype !== 0) {
              mods.push(altprefix + "Damage Type: " + damagetype);
          }

          var dmgtype2_regex = new RegExp("^\\s*" + altprefix + "Secondary Damage Type:\\s*(.+)$", "i");
          var dmgtype2_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(dmgtype2_found = dmgtype2_regex.exec(mods[i])) {
                  if(damagetype2 !== 0) {
                      mods[i] = mods[i].replace(dmgtype_found[1], damagetype);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!dmgtype2_found && damagetype2 !== 0) {
              mods.push(altprefix + "Secondary Damage Type: " + damagetype2);
          }

          var range_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(range_found = /^\s*Range:\s*(.+)$/i.exec(mods[i])) {
                  if(range !== 0) {
                      mods[i] = mods[i].replace(range_found[1], range);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!range_found && range !== 0) {
              mods.push("Range: " + range);
          }

          var attackmod_regex = new RegExp("^\\s*(?:" + (atktype !== "" ? atktype + "|" : "") + "Weapon) Attacks \\+?(.+)$", "i");
          var attackmod_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(attackmod_found = attackmod_regex.exec(mods[i])) {
                  if(magicmod !== 0 || attackmod !== 0) {
                      mods[i] = mods[i].replace(attackmod_found[1], magicmod !== 0 ? magicmod : attackmod);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!attackmod_found && (magicmod !== 0 || attackmod !== 0)) {
              var properties = v["repeating_inventory_" + itemid + "_itemproperties"];
              if(properties && /Thrown/i.test(properties)) {
                  mods.push("Weapon Attacks: " + (magicmod !== 0 ? magicmod : attackmod));
              }
              else {
                  mods.push(atktype + " Attacks: " + (magicmod !== 0 ? magicmod : attackmod));
              }
          }

	/*
	  // TODO: we may not be parsing all of the damage right
          var damagemod_regex = new RegExp("^\\s*(?:" + (atktype !== "" ? atktype + "|" : "") + "Weapon) Damage \\+?(.+)$", "i");
          var damagemod_found = false;
          for(var i = 0; i < mods.length; i++) {
              if(damagemod_found = damagemod_regex.exec(mods[i])) {
                  if(magicmod !== 0 || damagemod !== 0) {
                      mods[i] = mods[i].replace(damagemod_found[1], magicmod !== 0 ? magicmod : attackmod);
                  } else {
                      mods.splice(i, 1);
                  }
                  break;
              }
          }
          if(!damagemod_found && (magicmod !== 0 || damagemod !== 0)) {
              var properties = v["repeating_inventory_" + itemid + "_itemproperties"];
              if(properties && /Thrown/i.test(properties)) {
                  mods.push("Weapon Damage: " + (magicmod !== 0 ? magicmod : damagemod));
              }
              else {
                  mods.push(atktype + " Damage: " + (magicmod !== 0 ? magicmod : damagemod));
              }
          }
	*/

          update["repeating_inventory_" + itemid + "_itemmodifiers"] = mods.join(",");

          setAttrs(update, {silent: true});
      });
  };

  var remove_attack = function(attackid) {
      removeRepeatingRow("repeating_attacks_" + attackid);
  };

  var cleanup_drop_fields = function() {

    // console.log("DROP FIELD CLEANUP Called");

    var update = {};
    drop_item_attrs.forEach((key, i) => update[key] = "");
    drop_monster_attrs.forEach((key, i) => update[key] = "");
    drop_spell_attrs.forEach((key, i) => update[key] = "");

    // clear this so next drop will trigger
    update["drop_category"] = "";

    setAttrs(update, {silent: true});
  };

</script>
